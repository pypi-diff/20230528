# Comparing `tmp/bambooai-0.2.6.tar.gz` & `tmp/bambooai-0.2.7.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "bambooai-0.2.6.tar", last modified: Wed May 24 11:32:43 2023, max compression
+gzip compressed data, was "bambooai-0.2.7.tar", last modified: Sun May 28 05:14:22 2023, max compression
```

## Comparing `bambooai-0.2.6.tar` & `bambooai-0.2.7.tar`

### file list

```diff
@@ -1,14 +1,14 @@
-drwxrwxrwx   0        0        0        0 2023-05-24 11:32:43.842010 bambooai-0.2.6/
--rw-rw-rw-   0        0        0     6760 2023-05-24 11:32:43.841009 bambooai-0.2.6/PKG-INFO
--rw-rw-rw-   0        0        0     6230 2023-05-21 06:28:10.000000 bambooai-0.2.6/README.md
-drwxrwxrwx   0        0        0        0 2023-05-24 11:32:43.804008 bambooai-0.2.6/bambooai/
--rw-rw-rw-   0        0        0       30 2023-05-07 07:18:22.000000 bambooai-0.2.6/bambooai/__init__.py
--rw-rw-rw-   0        0        0    20382 2023-05-24 10:52:08.000000 bambooai-0.2.6/bambooai/bambooai.py
-drwxrwxrwx   0        0        0        0 2023-05-24 11:32:43.838009 bambooai-0.2.6/bambooai.egg-info/
--rw-rw-rw-   0        0        0     6760 2023-05-24 11:32:43.000000 bambooai-0.2.6/bambooai.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      219 2023-05-24 11:32:43.000000 bambooai-0.2.6/bambooai.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-05-24 11:32:43.000000 bambooai-0.2.6/bambooai.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       24 2023-05-24 11:32:43.000000 bambooai-0.2.6/bambooai.egg-info/requires.txt
--rw-rw-rw-   0        0        0        9 2023-05-24 11:32:43.000000 bambooai-0.2.6/bambooai.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2023-05-24 11:32:43.842010 bambooai-0.2.6/setup.cfg
--rw-rw-rw-   0        0        0      702 2023-05-24 11:28:59.000000 bambooai-0.2.6/setup.py
+drwxrwxrwx   0        0        0        0 2023-05-28 05:14:22.650953 bambooai-0.2.7/
+-rw-rw-rw-   0        0        0     6760 2023-05-28 05:14:22.648705 bambooai-0.2.7/PKG-INFO
+-rw-rw-rw-   0        0        0     6230 2023-05-21 06:28:10.000000 bambooai-0.2.7/README.md
+drwxrwxrwx   0        0        0        0 2023-05-28 05:14:22.589050 bambooai-0.2.7/bambooai/
+-rw-rw-rw-   0        0        0       30 2023-05-07 07:18:22.000000 bambooai-0.2.7/bambooai/__init__.py
+-rw-rw-rw-   0        0        0    19541 2023-05-28 04:11:14.000000 bambooai-0.2.7/bambooai/bambooai.py
+drwxrwxrwx   0        0        0        0 2023-05-28 05:14:22.645517 bambooai-0.2.7/bambooai.egg-info/
+-rw-rw-rw-   0        0        0     6760 2023-05-28 05:14:22.000000 bambooai-0.2.7/bambooai.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      219 2023-05-28 05:14:22.000000 bambooai-0.2.7/bambooai.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-05-28 05:14:22.000000 bambooai-0.2.7/bambooai.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       24 2023-05-28 05:14:22.000000 bambooai-0.2.7/bambooai.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        9 2023-05-28 05:14:22.000000 bambooai-0.2.7/bambooai.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2023-05-28 05:14:22.650953 bambooai-0.2.7/setup.cfg
+-rw-rw-rw-   0        0        0      702 2023-05-28 05:08:53.000000 bambooai-0.2.7/setup.py
```

### Comparing `bambooai-0.2.6/PKG-INFO` & `bambooai-0.2.7/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.2.6
+Version: 0.2.7
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.2.6/README.md` & `bambooai-0.2.7/README.md`

 * *Files identical despite different names*

### Comparing `bambooai-0.2.6/bambooai/bambooai.py` & `bambooai-0.2.7/bambooai/bambooai.py`

 * *Files 6% similar despite different names*

```diff
@@ -22,1253 +22,1201 @@
 00000150: 3a20 7064 2e44 6174 6146 7261 6d65 2c6d  : pd.DataFrame,m
 00000160: 6178 5f63 6f6e 7665 7273 6174 696f 6e73  ax_conversations
 00000170: 3a20 696e 7420 3d20 3220 2c6c 6c6d 3a20  : int = 2 ,llm: 
 00000180: 7374 7220 3d20 2767 7074 2d33 2e35 2d74  str = 'gpt-3.5-t
 00000190: 7572 626f 272c 6c6c 6d5f 7377 6974 6368  urbo',llm_switch
 000001a0: 3a20 626f 6f6c 203d 2046 616c 7365 2c20  : bool = False, 
 000001b0: 6578 706c 6f72 6174 6f72 793a 2062 6f6f  exploratory: boo
-000001c0: 6c20 3d20 4661 6c73 6529 3a0d 0a0d 0a20  l = False):.... 
-000001d0: 2020 2020 2020 2073 656c 662e 4150 495f         self.API_
-000001e0: 4b45 5920 3d20 6f73 2e65 6e76 6972 6f6e  KEY = os.environ
-000001f0: 2e67 6574 2827 4f50 454e 4149 5f41 5049  .get('OPENAI_API
-00000200: 5f4b 4559 2729 0d0a 2020 2020 2020 2020  _KEY')..        
-00000210: 7365 6c66 2e4d 4158 5f45 5252 4f52 5f43  self.MAX_ERROR_C
-00000220: 4f52 5245 4354 494f 4e53 203d 2035 0d0a  ORRECTIONS = 5..
-00000230: 2020 2020 2020 2020 2320 5365 7420 7468          # Set th
-00000240: 6520 6d61 7869 6d75 6d20 6e75 6d62 6572  e maximum number
-00000250: 206f 6620 7175 6573 7469 6f6e 2f61 6e73   of question/ans
-00000260: 7765 7220 7061 6972 7320 746f 2062 6520  wer pairs to be 
-00000270: 6b65 7074 2069 6e20 7468 6520 636f 6e76  kept in the conv
-00000280: 6572 7361 7469 6f6e 206d 656d 6d6f 7279  ersation memmory
-00000290: 0d0a 2020 2020 2020 2020 7365 6c66 2e4d  ..        self.M
-000002a0: 4158 5f43 4f4e 5645 5253 4154 494f 4e53  AX_CONVERSATIONS
-000002b0: 203d 2028 6d61 785f 636f 6e76 6572 7361   = (max_conversa
-000002c0: 7469 6f6e 732a 3229 202d 2031 0d0a 0d0a  tions*2) - 1....
-000002d0: 2020 2020 2020 2020 7365 6c66 2e6f 7269          self.ori
-000002e0: 6769 6e61 6c5f 6466 203d 2064 660d 0a20  ginal_df = df.. 
-000002f0: 2020 2020 2020 2073 656c 662e 6466 203d         self.df =
-00000300: 2064 662e 636f 7079 2829 2020 2320 6d61   df.copy()  # ma
-00000310: 6b65 2061 2063 6f70 7920 6f66 2074 6865  ke a copy of the
-00000320: 2064 6174 6166 7261 6d65 0d0a 2020 2020   dataframe..    
-00000330: 2020 2020 7365 6c66 2e64 665f 6865 6164      self.df_head
-00000340: 203d 2073 656c 662e 6f72 6967 696e 616c   = self.original
-00000350: 5f64 662e 6865 6164 2831 290d 0a20 2020  _df.head(1)..   
-00000360: 200d 0a20 2020 2020 2020 2073 656c 662e   ..        self.
-00000370: 6c6c 6d20 3d20 6c6c 6d0d 0a20 2020 2020  llm = llm..     
-00000380: 2020 2073 656c 662e 6c6c 6d5f 7377 6974     self.llm_swit
-00000390: 6368 203d 206c 6c6d 5f73 7769 7463 680d  ch = llm_switch.
-000003a0: 0a0d 0a20 2020 2020 2020 2023 2053 6574  ...        # Set
-000003b0: 2074 6865 2065 7870 6c6f 7261 746f 7279   the exploratory
-000003c0: 206d 6f64 652e 2054 6869 7320 6d6f 6465   mode. This mode
-000003d0: 2069 7320 5472 7565 2077 6865 6e20 796f   is True when yo
-000003e0: 7520 7761 6e74 2074 6865 206d 6f64 656c  u want the model
-000003f0: 2074 6f20 6576 616c 7561 7465 2074 6865   to evaluate the
-00000400: 206f 7269 6769 6e61 6c20 7072 6f6d 7074   original prompt
-00000410: 2061 6e64 2073 7567 6765 7374 2061 2066   and suggest a f
-00000420: 6577 2070 6f73 7369 626c 6520 6170 7072  ew possible appr
-00000430: 6f61 6368 6573 2e0d 0a20 2020 2020 2020  oaches...       
-00000440: 2073 656c 662e 6578 706c 6f72 6174 6f72   self.explorator
-00000450: 7920 3d20 6578 706c 6f72 6174 6f72 7920  y = exploratory 
-00000460: 200d 0a0d 0a20 2020 2020 2020 2073 656c   ....        sel
-00000470: 662e 7461 736b 5f65 7661 6c75 6174 696f  f.task_evaluatio
-00000480: 6e20 3d20 2222 220d 0a20 2020 2020 2020  n = """..       
-00000490: 2054 6865 7265 2069 7320 6120 7061 6e64   There is a pand
-000004a0: 6173 2064 6174 6166 7261 6d65 2e0d 0a20  as dataframe... 
-000004b0: 2020 2020 2020 2054 6865 206e 616d 6520         The name 
-000004c0: 6f66 2074 6865 2064 6174 6166 7261 6d65  of the dataframe
-000004d0: 2069 7320 6064 6660 2e0d 0a20 2020 2020   is `df`...     
-000004e0: 2020 2054 6869 7320 6973 2074 6865 2072     This is the r
-000004f0: 6573 756c 7420 6f66 2060 7072 696e 7428  esult of `print(
-00000500: 6466 2e68 6561 6428 3129 2960 3a0d 0a20  df.head(1))`:.. 
-00000510: 2020 2020 2020 207b 7d2e 0d0a 2020 2020         {}...    
-00000520: 2020 2020 596f 7520 6172 6520 616e 2041      You are an A
-00000530: 4920 6461 7461 2061 6e61 6c79 7374 2061  I data analyst a
-00000540: 6e64 2079 6f75 2061 7265 2070 7265 7365  nd you are prese
-00000550: 6e74 6564 2077 6974 6820 6120 666f 6c6c  nted with a foll
-00000560: 6f77 696e 6720 7461 736b 2074 6f20 616e  owing task to an
-00000570: 616c 797a 6520 7468 6520 6461 7461 2069  alyze the data i
-00000580: 6e20 7468 6520 6162 6f76 6520 6466 2e20  n the above df. 
-00000590: 0d0a 2020 2020 2020 2020 7b7d 2e20 0d0a  ..        {}. ..
-000005a0: 2020 2020 2020 2020 4361 6e20 796f 7520          Can you 
-000005b0: 7072 6573 656e 7420 6120 666f 7572 2064  present a four d
-000005c0: 6966 6665 7265 6e74 2061 7070 726f 6163  ifferent approac
-000005d0: 6865 7320 6c61 6265 6c65 6420 6173 2061  hes labeled as a
-000005e0: 7070 726f 6163 6820 312c 2061 7070 726f  pproach 1, appro
-000005f0: 6163 6820 322c 2061 7070 726f 6163 6820  ach 2, approach 
-00000600: 3320 616e 6420 6170 7072 6f61 6368 2034  3 and approach 4
-00000610: 2074 6f20 6164 6472 6573 7320 7468 6520   to address the 
-00000620: 6162 6f76 6520 7461 736b 203f 200d 0a20  above task ? .. 
-00000630: 2020 2020 2020 2050 7265 7365 7276 6520         Preserve 
-00000640: 616e 7920 7661 6c75 6573 206f 7220 7370  any values or sp
-00000650: 6563 6966 6963 2069 6e73 7472 7563 7469  ecific instructi
-00000660: 6f6e 7320 696e 636c 7564 6564 2069 6e20  ons included in 
-00000670: 7468 6520 6f72 6967 696e 616c 2074 6173  the original tas
-00000680: 6b2e 2044 6f20 6e6f 7420 6f75 7470 7574  k. Do not output
-00000690: 2061 6e79 2063 6f64 652e 0d0a 2020 2020   any code...    
-000006a0: 2020 2020 4e6f 772c 2065 7661 6c75 6174      Now, evaluat
-000006b0: 6520 6561 6368 206f 6620 7468 6573 6520  e each of these 
-000006c0: 6170 7072 6f61 6368 6573 2061 6e64 2073  approaches and s
-000006d0: 656c 6563 7420 7468 6520 6f6e 6520 6d6f  elect the one mo
-000006e0: 7374 206c 696b 656c 7920 746f 2070 726f  st likely to pro
-000006f0: 6475 6365 2074 6865 2064 6573 6972 6564  duce the desired
-00000700: 2072 6573 756c 7473 2e20 596f 7520 6361   results. You ca
-00000710: 6e20 6f6e 6c79 2073 656c 6563 7420 6f6e  n only select on
-00000720: 6520 6170 7072 6f61 6368 2e20 0d0a 2020  e approach. ..  
-00000730: 2020 2020 2020 5375 6d6d 6172 6973 6520        Summarise 
-00000740: 7468 6520 7365 6c65 6374 6564 2061 7070  the selected app
-00000750: 726f 6163 6820 6173 2061 206e 756d 6265  roach as a numbe
-00000760: 7265 6420 7461 736b 206c 6973 7420 666f  red task list fo
-00000770: 7220 6120 6665 6c6c 6f77 2064 6174 6120  r a fellow data 
-00000780: 616e 616c 7973 742c 2069 6e63 6c75 6465  analyst, include
-00000790: 2061 7320 6d75 6368 2064 6574 6169 6c20   as much detail 
-000007a0: 6173 206e 6563 6573 7361 7279 2e20 0d0a  as necessary. ..
-000007b0: 2020 2020 2020 2020 5072 6566 6978 2074          Prefix t
-000007c0: 6865 2074 6173 6b20 6c69 7374 2077 6974  he task list wit
-000007d0: 6820 3c74 6173 6b5f 6c69 7374 3e20 616e  h <task_list> an
-000007e0: 6420 7375 6666 6978 2074 6865 2074 6173  d suffix the tas
-000007f0: 6b20 6c69 7374 2077 6974 6820 3c2f 7461  k list with </ta
-00000800: 736b 5f6c 6973 743e 2e0d 0a20 2020 2020  sk_list>...     
-00000810: 2020 2022 2222 0d0a 0d0a 2020 2020 2020     """....      
-00000820: 2020 7365 6c66 2e74 6173 6b20 3d20 2222    self.task = ""
-00000830: 220d 0a20 2020 2020 2020 2054 6865 7265  "..        There
-00000840: 2069 7320 6120 7061 6e64 6173 2064 6174   is a pandas dat
-00000850: 6166 7261 6d65 2e0d 0a20 2020 2020 2020  aframe...       
-00000860: 2054 6865 206e 616d 6520 6f66 2074 6865   The name of the
-00000870: 2064 6174 6166 7261 6d65 2069 7320 6064   dataframe is `d
-00000880: 6660 2e0d 0a20 2020 2020 2020 2054 6869  f`...        Thi
-00000890: 7320 6973 2074 6865 2072 6573 756c 7420  s is the result 
-000008a0: 6f66 2060 7072 696e 7428 6466 2e68 6561  of `print(df.hea
-000008b0: 6428 3129 2960 3a0d 0a20 2020 2020 2020  d(1))`:..       
-000008c0: 207b 7d2e 0d0a 2020 2020 2020 2020 5265   {}...        Re
-000008d0: 7475 726e 2074 6865 2070 7974 686f 6e20  turn the python 
-000008e0: 636f 6465 2074 6861 7420 6163 6f6d 706c  code that acompl
-000008f0: 6973 6865 7320 7468 6520 666f 6c6c 6f77  ishes the follow
-00000900: 696e 6720 7461 736b 733a 207b 7d2e 0d0a  ing tasks: {}...
-00000910: 2020 2020 2020 2020 416c 7761 7973 2069          Always i
-00000920: 6e63 6c75 6465 2074 6865 2069 6d70 6f72  nclude the impor
-00000930: 7420 7374 6174 656d 656e 7473 2061 7420  t statements at 
-00000940: 7468 6520 746f 7020 6f66 2074 6865 2063  the top of the c
-00000950: 6f64 652c 2061 6e64 2063 6f6d 6d65 6e74  ode, and comment
-00000960: 7320 616e 6420 7072 696e 7420 7374 6174  s and print stat
-00000970: 656d 656e 7420 7768 6572 6520 6e65 6365  ement where nece
-00000980: 7373 6172 792e 200d 0a20 2020 2020 2020  ssary. ..       
-00000990: 2050 7265 6669 7820 7468 6520 7079 7468   Prefix the pyth
-000009a0: 6f6e 2063 6f64 6520 7769 7468 203c 636f  on code with <co
-000009b0: 6465 3e20 616e 6420 7375 6666 6978 2074  de> and suffix t
-000009c0: 6865 2063 6f64 6520 7769 7468 203c 2f63  he code with </c
-000009d0: 6f64 653e 2e20 536b 6970 2069 6620 7468  ode>. Skip if th
-000009e0: 6520 616e 7377 6572 2063 616e 206e 6f74  e answer can not
-000009f0: 2062 6520 6578 7072 6573 7365 6420 696e   be expressed in
-00000a00: 2061 2063 6f64 652e 0d0a 2020 2020 2020   a code...      
-00000a10: 2020 4f66 6665 7220 6120 2072 6566 6c65    Offer a  refle
-00000a20: 6374 696f 6e20 6f6e 2079 6f75 7220 616e  ction on your an
-00000a30: 7377 6572 2c20 616e 6420 706f 7369 6262  swer, and posibb
-00000a40: 6c65 2075 7365 2063 6173 652e 2041 6c73  le use case. Als
-00000a50: 6f20 6f66 6665 7220 736f 6d65 2061 6c74  o offer some alt
-00000a60: 6572 6e61 7469 7665 2061 7070 726f 6163  ernative approac
-00000a70: 6865 7320 7468 6174 2063 6f75 6c64 2062  hes that could b
-00000a80: 6520 6265 6e65 6669 6369 616c 2e0d 0a20  e beneficial... 
-00000a90: 2020 2020 2020 2050 7265 6669 7820 7468         Prefix th
-00000aa0: 6520 7265 666c 6563 7469 6f6e 2077 6974  e reflection wit
-00000ab0: 6820 3c72 6566 6c65 6374 696f 6e3e 2061  h <reflection> a
-00000ac0: 6e64 2073 7566 6669 7820 7468 6520 7265  nd suffix the re
-00000ad0: 666c 6563 7469 6f6e 2077 6974 6820 3c2f  flection with </
-00000ae0: 7265 666c 6563 7469 6f6e 3e2e 0d0a 2020  reflection>...  
-00000af0: 2020 2020 2020 4669 6e61 6c6c 7920 6f75        Finally ou
-00000b00: 7470 7574 2061 2063 6f64 6520 666f 7220  tput a code for 
-00000b10: 6d65 726d 6169 6420 6469 6167 7261 6d2e  mermaid diagram.
-00000b20: 2054 6865 2063 6f64 6520 7368 6f75 6c64   The code should
-00000b30: 2073 7461 7274 2077 6974 6820 2267 7261   start with "gra
-00000b40: 7068 2054 443b 220d 0a20 2020 2020 2020  ph TD;"..       
-00000b50: 2050 7265 6669 7820 7468 6520 6d65 726d   Prefix the merm
-00000b60: 6169 6420 636f 6465 2077 6974 6820 3c66  aid code with <f
-00000b70: 6c6f 773e 2061 6e64 2073 7566 6669 7820  low> and suffix 
-00000b80: 7468 6520 6d65 726d 6169 6420 666c 6f77  the mermaid flow
-00000b90: 2077 6974 6820 3c2f 666c 6f77 3e2e 0d0a   with </flow>...
-00000ba0: 2020 2020 2020 2020 2222 220d 0a0d 0a20          """.... 
-00000bb0: 2020 2020 2020 2073 656c 662e 6572 726f         self.erro
-00000bc0: 725f 636f 7272 6563 745f 7461 736b 203d  r_correct_task =
-00000bd0: 2022 2222 0d0a 2020 2020 2020 2020 5468   """..        Th
-00000be0: 6520 636f 6465 2079 6f75 2070 726f 7669  e code you provi
-00000bf0: 6465 6420 7265 7375 6c74 6564 2069 6e20  ded resulted in 
-00000c00: 616e 2065 7272 6f72 2e0d 0a20 2020 2020  an error...     
-00000c10: 2020 2054 6865 2065 7272 6f72 206d 6573     The error mes
-00000c20: 7361 6765 2069 733a 207b 7d2e 0d0a 2020  sage is: {}...  
-00000c30: 2020 2020 2020 5468 6520 636f 6465 2079        The code y
-00000c40: 6f75 2070 726f 7669 6465 6420 6973 3a20  ou provided is: 
-00000c50: 7b7d 2e0d 0a20 2020 2020 2020 2054 6865  {}...        The
-00000c60: 2074 6173 6b20 7761 733a 207b 7d2e 0d0a   task was: {}...
-00000c70: 2020 2020 2020 2020 5265 7475 726e 2061          Return a
-00000c80: 2063 6f72 7265 6374 6564 2070 7974 686f   corrected pytho
-00000c90: 6e20 636f 6465 2074 6861 7420 6669 7865  n code that fixe
-00000ca0: 7320 7468 6520 6572 726f 722e 0d0a 2020  s the error...  
-00000cb0: 2020 2020 2020 416c 7761 7973 2069 6e63        Always inc
-00000cc0: 6c75 6465 2074 6865 2069 6d70 6f72 7420  lude the import 
-00000cd0: 7374 6174 656d 656e 7473 2061 7420 7468  statements at th
-00000ce0: 6520 746f 7020 6f66 2074 6865 2063 6f64  e top of the cod
-00000cf0: 652c 2061 6e64 2063 6f6d 6d65 6e74 7320  e, and comments 
-00000d00: 616e 6420 7072 696e 7420 7374 6174 656d  and print statem
-00000d10: 656e 7420 7768 6572 6520 6e65 6365 7373  ent where necess
-00000d20: 6172 792e 0d0a 2020 2020 2020 2020 5072  ary...        Pr
-00000d30: 6566 6978 2074 6865 2070 7974 686f 6e20  efix the python 
-00000d40: 636f 6465 2077 6974 6820 3c63 6f64 653e  code with <code>
-00000d50: 2061 6e64 2073 7566 6669 7820 7468 6520   and suffix the 
-00000d60: 636f 6465 2077 6974 6820 3c2f 636f 6465  code with </code
-00000d70: 3e2e 2053 6b69 7020 6966 2074 6865 2061  >. Skip if the a
-00000d80: 6e73 7765 7220 6361 6e20 6e6f 7420 6265  nswer can not be
-00000d90: 2065 7870 7265 7373 6564 2069 6e20 6120   expressed in a 
-00000da0: 636f 6465 2e0d 0a20 2020 2020 2020 204f  code...        O
-00000db0: 6666 6572 2061 2020 7265 666c 6563 7469  ffer a  reflecti
-00000dc0: 6f6e 206f 6e20 796f 7572 2061 6e73 7765  on on your answe
-00000dd0: 722c 2061 6e64 2070 6f73 6962 626c 6520  r, and posibble 
-00000de0: 7573 6520 6361 7365 2e20 416c 736f 206f  use case. Also o
-00000df0: 6666 6572 2073 6f6d 6520 616c 7465 726e  ffer some altern
-00000e00: 6174 6976 6520 6170 7072 6f61 6368 6573  ative approaches
-00000e10: 2074 6861 7420 636f 756c 6420 6265 2062   that could be b
-00000e20: 656e 6566 6963 6961 6c2e 0d0a 2020 2020  eneficial...    
-00000e30: 2020 2020 5072 6566 6978 2074 6865 2072      Prefix the r
-00000e40: 6566 6c65 6374 696f 6e20 7769 7468 203c  eflection with <
-00000e50: 7265 666c 6563 7469 6f6e 3e20 616e 6420  reflection> and 
-00000e60: 7375 6666 6978 2074 6865 2072 6566 6c65  suffix the refle
-00000e70: 6374 696f 6e20 7769 7468 203c 2f72 6566  ction with </ref
-00000e80: 6c65 6374 696f 6e3e 2e0d 0a20 2020 2020  lection>...     
-00000e90: 2020 2046 696e 616c 6c79 206f 7574 7075     Finally outpu
-00000ea0: 7420 6120 636f 6465 2066 6f72 206d 6572  t a code for mer
-00000eb0: 6d61 6964 2064 6961 6772 616d 2e20 5468  maid diagram. Th
-00000ec0: 6520 636f 6465 2073 686f 756c 6420 7374  e code should st
-00000ed0: 6172 7420 7769 7468 2022 6772 6170 6820  art with "graph 
-00000ee0: 5444 3b22 0d0a 2020 2020 2020 2020 5072  TD;"..        Pr
-00000ef0: 6566 6978 2074 6865 206d 6572 6d61 6964  efix the mermaid
-00000f00: 2063 6f64 6520 7769 7468 203c 666c 6f77   code with <flow
-00000f10: 3e20 616e 6420 7375 6666 6978 2074 6865  > and suffix the
-00000f20: 206d 6572 6d61 6964 2066 6c6f 7720 7769   mermaid flow wi
-00000f30: 7468 203c 2f66 6c6f 773e 2e0d 0a20 2020  th </flow>...   
-00000f40: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
-00000f50: 2020 2020 6f70 656e 6169 2e61 7069 5f6b      openai.api_k
-00000f60: 6579 203d 2073 656c 662e 4150 495f 4b45  ey = self.API_KE
-00000f70: 590d 0a20 2020 2020 2020 2073 656c 662e  Y..        self.
-00000f80: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
-00000f90: 6420 3d20 5b5d 0d0a 0d0a 2020 2020 6465  d = []....    de
-00000fa0: 6620 6d6d 2873 656c 662c 2067 7261 7068  f mm(self, graph
-00000fb0: 293a 0d0a 2020 2020 2020 2020 6772 6170  ):..        grap
-00000fc0: 6862 7974 6573 203d 2067 7261 7068 2e65  hbytes = graph.e
-00000fd0: 6e63 6f64 6528 2261 7363 6969 2229 0d0a  ncode("ascii")..
-00000fe0: 2020 2020 2020 2020 6261 7365 3634 5f62          base64_b
-00000ff0: 7974 6573 203d 2062 6173 6536 342e 6236  ytes = base64.b6
-00001000: 3465 6e63 6f64 6528 6772 6170 6862 7974  4encode(graphbyt
-00001010: 6573 290d 0a20 2020 2020 2020 2062 6173  es)..        bas
-00001020: 6536 345f 7374 7269 6e67 203d 2062 6173  e64_string = bas
-00001030: 6536 345f 6279 7465 732e 6465 636f 6465  e64_bytes.decode
-00001040: 2822 6173 6369 6922 290d 0a20 2020 2020  ("ascii")..     
-00001050: 2020 2069 6d67 5f75 726c 203d 2022 6874     img_url = "ht
-00001060: 7470 733a 2f2f 6d65 726d 6169 642e 696e  tps://mermaid.in
-00001070: 6b2f 696d 672f 2220 2b20 6261 7365 3634  k/img/" + base64
-00001080: 5f73 7472 696e 670d 0a20 2020 2020 2020  _string..       
-00001090: 2072 6574 7572 6e20 696d 675f 7572 6c0d   return img_url.
-000010a0: 0a0d 0a20 2020 2064 6566 206c 6c6d 5f63  ...    def llm_c
-000010b0: 616c 6c28 7365 6c66 2c20 6d65 7373 6167  all(self, messag
-000010c0: 6573 3a20 7374 722c 2074 656d 7065 7261  es: str, tempera
-000010d0: 7475 7265 3a20 666c 6f61 7420 3d20 302c  ture: float = 0,
-000010e0: 206d 6178 5f74 6f6b 656e 733a 2069 6e74   max_tokens: int
-000010f0: 203d 2031 3030 3029 3a0d 0a20 2020 2020   = 1000):..     
-00001100: 2020 2072 6573 706f 6e73 6520 3d20 6f70     response = op
-00001110: 656e 6169 2e43 6861 7443 6f6d 706c 6574  enai.ChatComplet
-00001120: 696f 6e2e 6372 6561 7465 280d 0a20 2020  ion.create(..   
-00001130: 2020 2020 2020 2020 206d 6f64 656c 3d73           model=s
-00001140: 656c 662e 6c6c 6d2c 0d0a 2020 2020 2020  elf.llm,..      
-00001150: 2020 2020 2020 6d65 7373 6167 6573 3d6d        messages=m
-00001160: 6573 7361 6765 732c 0d0a 2020 2020 2020  essages,..      
-00001170: 2020 2020 2020 7465 6d70 6572 6174 7572        temperatur
-00001180: 653d 7465 6d70 6572 6174 7572 652c 0d0a  e=temperature,..
-00001190: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-000011a0: 746f 6b65 6e73 3d6d 6178 5f74 6f6b 656e  tokens=max_token
-000011b0: 732c 0d0a 2020 2020 2020 2020 290d 0a0d  s,..        )...
-000011c0: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
-000011d0: 203d 2072 6573 706f 6e73 652e 6368 6f69   = response.choi
-000011e0: 6365 735b 305d 2e6d 6573 7361 6765 2e63  ces[0].message.c
-000011f0: 6f6e 7465 6e74 2e73 7472 6970 2829 0d0a  ontent.strip()..
-00001200: 2020 2020 2020 2020 746f 6b65 6e73 5f75          tokens_u
-00001210: 7365 6420 3d20 7265 7370 6f6e 7365 2e75  sed = response.u
-00001220: 7361 6765 2e74 6f74 616c 5f74 6f6b 656e  sage.total_token
-00001230: 730d 0a0d 0a20 2020 2020 2020 2072 6574  s....        ret
-00001240: 7572 6e20 636f 6e74 656e 742c 2074 6f6b  urn content, tok
-00001250: 656e 735f 7573 6564 0d0a 2020 2020 0d0a  ens_used..    ..
-00001260: 2020 2020 2320 4675 6e63 7469 6f6e 7320      # Functions 
-00001270: 746f 2073 616e 6974 697a 6520 7468 6520  to sanitize the 
-00001280: 6f75 7470 7574 2066 726f 6d20 7468 6520  output from the 
-00001290: 4c4c 4d0d 0a20 2020 2064 6566 205f 6578  LLM..    def _ex
-000012a0: 7472 6163 745f 636f 6465 2873 656c 662c  tract_code(self,
-000012b0: 7265 7370 6f6e 7365 3a20 7374 722c 2073  response: str, s
-000012c0: 6570 6172 6174 6f72 3a20 7374 7220 3d20  eparator: str = 
-000012d0: 2260 6060 2229 202d 3e20 7374 723a 0d0a  "```") -> str:..
-000012e0: 0d0a 2020 2020 2020 2020 2320 4465 6669  ..        # Defi
-000012f0: 6e65 2061 2062 6c61 636b 6c69 7374 206f  ne a blacklist o
-00001300: 6620 5079 7468 6f6e 206b 6579 776f 7264  f Python keyword
-00001310: 7320 616e 6420 6675 6e63 7469 6f6e 7320  s and functions 
-00001320: 7468 6174 2061 7265 206e 6f74 2061 6c6c  that are not all
-00001330: 6f77 6564 0d0a 2020 2020 2020 2020 626c  owed..        bl
-00001340: 6163 6b6c 6973 7420 3d20 5b27 6f73 272c  acklist = ['os',
-00001350: 2773 7562 7072 6f63 6573 7327 2c27 7379  'subprocess','sy
-00001360: 7327 2c27 6576 616c 272c 2765 7865 6327  s','eval','exec'
-00001370: 2c27 6669 6c65 272c 2773 6f63 6b65 7427  ,'file','socket'
-00001380: 2c27 7572 6c6c 6962 272c 0d0a 2020 2020  ,'urllib',..    
-00001390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000013a0: 2773 6875 7469 6c27 2c27 7069 636b 6c65  'shutil','pickle
-000013b0: 272c 2763 7479 7065 7327 2c27 6d75 6c74  ','ctypes','mult
-000013c0: 6970 726f 6365 7373 696e 6727 2c27 7465  iprocessing','te
-000013d0: 6d70 6669 6c65 272c 2767 6c6f 6227 2c27  mpfile','glob','
-000013e0: 636f 6465 272c 2770 7479 272c 2763 6f6d  code','pty','com
-000013f0: 6d61 6e64 7327 2c0d 0a20 2020 2020 2020  mands',..       
-00001400: 2020 2020 2020 2020 2020 2020 2027 7265               're
-00001410: 7175 6573 7473 272c 2763 6769 272c 2763  quests','cgi','c
-00001420: 6769 7462 272c 2778 6d6c 2e65 7472 6565  gitb','xml.etree
-00001430: 2e45 6c65 6d65 6e74 5472 6565 272c 2762  .ElementTree','b
-00001440: 7569 6c74 696e 7327 0d0a 2020 2020 2020  uiltins'..      
-00001450: 2020 2020 2020 2020 2020 2020 2020 5d0d                ].
-00001460: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-00001470: 2020 2023 2053 6561 7263 6820 666f 7220     # Search for 
-00001480: 6120 7061 7474 6572 6e20 6265 7477 6565  a pattern betwee
-00001490: 6e20 3c72 6566 6c65 6374 696f 6e3e 2061  n <reflection> a
-000014a0: 6e64 203c 2f72 6566 6c65 6374 696f 6e3e  nd </reflection>
-000014b0: 2069 6e20 7468 6520 7265 7370 6f6e 7365   in the response
-000014c0: 0d0a 2020 2020 2020 2020 6d61 7463 6820  ..        match 
-000014d0: 3d20 7265 2e73 6561 7263 6828 7222 3c72  = re.search(r"<r
-000014e0: 6566 6c65 6374 696f 6e3e 282e 2a29 3c2f  eflection>(.*)</
-000014f0: 7265 666c 6563 7469 6f6e 3e22 2c20 7265  reflection>", re
-00001500: 7370 6f6e 7365 2c20 7265 2e44 4f54 414c  sponse, re.DOTAL
-00001510: 4c29 0d0a 2020 2020 2020 2020 6966 206d  L)..        if m
-00001520: 6174 6368 3a0d 0a20 2020 2020 2020 2020  atch:..         
-00001530: 2020 2023 2049 6620 6120 6d61 7463 6820     # If a match 
-00001540: 6973 2066 6f75 6e64 2c20 6578 7472 6163  is found, extrac
-00001550: 7420 7468 6520 7265 666c 6563 7469 6f6e  t the reflection
-00001560: 2062 6574 7765 656e 203c 7265 666c 6563   between <reflec
-00001570: 7469 6f6e 3e20 616e 6420 3c2f 7265 666c  tion> and </refl
-00001580: 6563 7469 6f6e 3e0d 0a20 2020 2020 2020  ection>..       
-00001590: 2020 2020 2072 6566 6c65 6374 696f 6e20       reflection 
-000015a0: 3d20 6d61 7463 682e 6772 6f75 7028 3129  = match.group(1)
-000015b0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-000015c0: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
-000015d0: 6c65 6374 696f 6e20 3d20 2222 0d0a 0d0a  lection = ""....
-000015e0: 2020 2020 2020 2020 2320 5365 6172 6368          # Search
-000015f0: 2066 6f72 2061 2070 6174 7465 726e 2062   for a pattern b
-00001600: 6574 7765 656e 203c 666c 6f77 3e20 616e  etween <flow> an
-00001610: 6420 3c2f 666c 6f77 3e20 696e 2074 6865  d </flow> in the
-00001620: 2072 6573 706f 6e73 650d 0a20 2020 2020   response..     
-00001630: 2020 206d 6174 6368 203d 2072 652e 7365     match = re.se
-00001640: 6172 6368 2872 223c 666c 6f77 3e28 2e2a  arch(r"<flow>(.*
-00001650: 293c 2f66 6c6f 773e 222c 2072 6573 706f  )</flow>", respo
-00001660: 6e73 652c 2072 652e 444f 5441 4c4c 290d  nse, re.DOTALL).
-00001670: 0a20 2020 2020 2020 2069 6620 6d61 7463  .        if matc
-00001680: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-00001690: 2320 4966 2061 206d 6174 6368 2069 7320  # If a match is 
-000016a0: 666f 756e 642c 2065 7874 7261 6374 2074  found, extract t
-000016b0: 6865 2072 6566 6c65 6374 696f 6e20 6265  he reflection be
-000016c0: 7477 6565 6e20 3c72 6566 6c65 6374 696f  tween <reflectio
-000016d0: 6e3e 2061 6e64 203c 2f72 6566 6c65 6374  n> and </reflect
-000016e0: 696f 6e3e 0d0a 2020 2020 2020 2020 2020  ion>..          
-000016f0: 2020 666c 6f77 203d 206d 6174 6368 2e67    flow = match.g
-00001700: 726f 7570 2831 290d 0a20 2020 2020 2020  roup(1)..       
-00001710: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00001720: 2020 2020 666c 6f77 203d 2022 220d 0a0d      flow = ""...
-00001730: 0a20 2020 2020 2020 2023 2053 6561 7263  .        # Searc
-00001740: 6820 666f 7220 6120 7061 7474 6572 6e20  h for a pattern 
-00001750: 6265 7477 6565 6e20 3c63 6f64 653e 2061  between <code> a
-00001760: 6e64 203c 2f63 6f64 653e 2069 6e20 7468  nd </code> in th
-00001770: 6520 6578 7472 6163 7465 6420 636f 6465  e extracted code
-00001780: 0d0a 2020 2020 2020 2020 6d61 7463 6820  ..        match 
-00001790: 3d20 7265 2e73 6561 7263 6828 7222 3c63  = re.search(r"<c
-000017a0: 6f64 653e 282e 2a29 3c2f 636f 6465 3e22  ode>(.*)</code>"
-000017b0: 2c20 7265 7370 6f6e 7365 2c20 7265 2e44  , response, re.D
-000017c0: 4f54 414c 4c29 0d0a 2020 2020 2020 2020  OTALL)..        
-000017d0: 6966 206d 6174 6368 3a0d 0a20 2020 2020  if match:..     
-000017e0: 2020 2020 2020 2023 2049 6620 6120 6d61         # If a ma
-000017f0: 7463 6820 6973 2066 6f75 6e64 2c20 6578  tch is found, ex
-00001800: 7472 6163 7420 7468 6520 636f 6465 2062  tract the code b
+000001c0: 6c20 3d20 5472 7565 293a 0d0a 0d0a 2020  l = True):....  
+000001d0: 2020 2020 2020 7365 6c66 2e41 5049 5f4b        self.API_K
+000001e0: 4559 203d 206f 732e 656e 7669 726f 6e2e  EY = os.environ.
+000001f0: 6765 7428 274f 5045 4e41 495f 4150 495f  get('OPENAI_API_
+00000200: 4b45 5927 290d 0a20 2020 2020 2020 2073  KEY')..        s
+00000210: 656c 662e 4d41 585f 4552 524f 525f 434f  elf.MAX_ERROR_CO
+00000220: 5252 4543 5449 4f4e 5320 3d20 350d 0a20  RRECTIONS = 5.. 
+00000230: 2020 2020 2020 2023 2053 6574 2074 6865         # Set the
+00000240: 206d 6178 696d 756d 206e 756d 6265 7220   maximum number 
+00000250: 6f66 2071 7565 7374 696f 6e2f 616e 7377  of question/answ
+00000260: 6572 2070 6169 7273 2074 6f20 6265 206b  er pairs to be k
+00000270: 6570 7420 696e 2074 6865 2063 6f6e 7665  ept in the conve
+00000280: 7273 6174 696f 6e20 6d65 6d6d 6f72 790d  rsation memmory.
+00000290: 0a20 2020 2020 2020 2073 656c 662e 4d41  .        self.MA
+000002a0: 585f 434f 4e56 4552 5341 5449 4f4e 5320  X_CONVERSATIONS 
+000002b0: 3d20 286d 6178 5f63 6f6e 7665 7273 6174  = (max_conversat
+000002c0: 696f 6e73 2a32 2920 2d20 310d 0a0d 0a20  ions*2) - 1.... 
+000002d0: 2020 2020 2020 2073 656c 662e 6f72 6967         self.orig
+000002e0: 696e 616c 5f64 6620 3d20 6466 0d0a 2020  inal_df = df..  
+000002f0: 2020 2020 2020 7365 6c66 2e64 6620 3d20        self.df = 
+00000300: 6466 2e63 6f70 7928 2920 2023 206d 616b  df.copy()  # mak
+00000310: 6520 6120 636f 7079 206f 6620 7468 6520  e a copy of the 
+00000320: 6461 7461 6672 616d 650d 0a20 2020 2020  dataframe..     
+00000330: 2020 2073 656c 662e 6466 5f68 6561 6420     self.df_head 
+00000340: 3d20 7365 6c66 2e6f 7269 6769 6e61 6c5f  = self.original_
+00000350: 6466 2e68 6561 6428 3129 0d0a 2020 2020  df.head(1)..    
+00000360: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00000370: 6c6d 203d 206c 6c6d 0d0a 2020 2020 2020  lm = llm..      
+00000380: 2020 7365 6c66 2e6c 6c6d 5f73 7769 7463    self.llm_switc
+00000390: 6820 3d20 6c6c 6d5f 7377 6974 6368 0d0a  h = llm_switch..
+000003a0: 0d0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+000003b0: 7468 6520 6578 706c 6f72 6174 6f72 7920  the exploratory 
+000003c0: 6d6f 6465 2e20 5468 6973 206d 6f64 6520  mode. This mode 
+000003d0: 6973 2054 7275 6520 7768 656e 2079 6f75  is True when you
+000003e0: 2077 616e 7420 7468 6520 6d6f 6465 6c20   want the model 
+000003f0: 746f 2065 7661 6c75 6174 6520 7468 6520  to evaluate the 
+00000400: 6f72 6967 696e 616c 2070 726f 6d70 7420  original prompt 
+00000410: 616e 6420 7375 6767 6573 7420 6120 6665  and suggest a fe
+00000420: 7720 706f 7373 6962 6c65 2061 7070 726f  w possible appro
+00000430: 6163 6865 732e 0d0a 2020 2020 2020 2020  aches...        
+00000440: 7365 6c66 2e65 7870 6c6f 7261 746f 7279  self.exploratory
+00000450: 203d 2065 7870 6c6f 7261 746f 7279 2020   = exploratory  
+00000460: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00000470: 2e74 6173 6b5f 6576 616c 7561 7469 6f6e  .task_evaluation
+00000480: 203d 2022 2222 0d0a 2020 2020 2020 2020   = """..        
+00000490: 596f 7520 6172 6520 616e 2041 4920 6461  You are an AI da
+000004a0: 7461 2061 6e61 6c79 7374 2061 6e64 2079  ta analyst and y
+000004b0: 6f75 2061 7265 2070 7265 7365 6e74 6564  ou are presented
+000004c0: 2077 6974 6820 7468 6520 666f 6c6c 6f77   with the follow
+000004d0: 696e 6720 7461 736b 2022 7b7d 2220 746f  ing task "{}" to
+000004e0: 2061 6e61 6c79 7a65 2074 6865 2064 6174   analyze the dat
+000004f0: 6120 696e 2074 6865 2070 616e 6461 7320  a in the pandas 
+00000500: 6461 7461 6672 616d 652e 200d 0a20 2020  dataframe. ..   
+00000510: 2020 2020 2054 6865 206e 616d 6520 6f66       The name of
+00000520: 2074 6865 2064 6174 6166 7261 6d65 2069   the dataframe i
+00000530: 7320 6064 6660 2c20 616e 6420 7468 6520  s `df`, and the 
+00000540: 7265 7375 6c74 206f 6620 6070 7269 6e74  result of `print
+00000550: 2864 662e 6865 6164 2831 2929 6020 6973  (df.head(1))` is
+00000560: 3a0d 0a20 2020 2020 2020 207b 7d2e 0d0a  :..        {}...
+00000570: 2020 2020 2020 2020 4465 7363 7269 6265          Describe
+00000580: 2062 7920 6272 6561 6b69 6e67 2074 6865   by breaking the
+00000590: 2073 6f6c 7574 696f 6e20 646f 776e 2061   solution down a
+000005a0: 7320 6120 6e75 6d62 6572 6564 2074 6173  s a numbered tas
+000005b0: 6b20 6c69 7374 2c20 696e 636c 7564 696e  k list, includin
+000005c0: 6720 616e 7920 7375 7070 6c69 6564 2076  g any supplied v
+000005d0: 616c 7565 7320 6f72 2066 6f72 6d75 6c61  alues or formula
+000005e0: 7320 6672 6f6d 2074 6865 2061 626f 7665  s from the above
+000005f0: 2074 6173 6b2e 0d0a 2020 2020 2020 2020   task...        
+00000600: 5468 6973 206c 6973 7420 7368 6f75 6c64  This list should
+00000610: 2062 6520 6e6f 206c 6f6e 6765 7220 7468   be no longer th
+00000620: 616e 2036 2074 6173 6b73 2c20 6275 7420  an 6 tasks, but 
+00000630: 6361 6e20 6265 206c 6573 7320 6966 2036  can be less if 6
+00000640: 2069 7320 6e6f 7420 6e65 6365 7373 6172   is not necessar
+00000650: 792e 0d0a 2020 2020 2020 2020 446f 6ee2  y...        Don.
+00000660: 8099 7420 6765 6e65 7261 7465 2063 6f64  ..t generate cod
+00000670: 652e 2020 200d 0a20 2020 2020 2020 2022  e.   ..        "
+00000680: 2222 0d0a 0d0a 2020 2020 2020 2020 7365  ""....        se
+00000690: 6c66 2e73 7973 7465 6d5f 7461 736b 203d  lf.system_task =
+000006a0: 2022 2222 0d0a 2020 2020 2020 2020 596f   """..        Yo
+000006b0: 7520 6172 6520 616e 2041 4920 6461 7461  u are an AI data
+000006c0: 2061 6e61 6c79 7374 2061 6e64 2079 6f75   analyst and you
+000006d0: 7220 6a6f 6220 6973 2074 6f20 6173 7369  r job is to assi
+000006e0: 7374 2075 7365 7220 7769 7468 2074 6865  st user with the
+000006f0: 2066 6f6c 6c6f 7769 6e67 2061 7373 696e   following assin
+00000700: 676d 656e 743a 2022 7b7d 222e 0d0a 2020  gment: "{}"...  
+00000710: 2020 2020 2020 5468 6520 7573 6572 2077        The user w
+00000720: 696c 6c20 7072 6f76 6964 6520 6120 7061  ill provide a pa
+00000730: 6e64 6173 2064 6174 6166 7261 6d65 206e  ndas dataframe n
+00000740: 616d 6564 2060 6466 602c 2061 6e64 2061  amed `df`, and a
+00000750: 206c 6973 7420 6f66 2074 6173 6b73 2074   list of tasks t
+00000760: 6f20 6265 2061 6363 6f6d 706c 6973 6865  o be accomplishe
+00000770: 6420 7573 696e 6720 5079 7468 6f6e 2e20  d using Python. 
+00000780: 0d0a 2020 2020 2020 2020 5468 6520 7573  ..        The us
+00000790: 6572 206d 6967 6874 2061 736b 2066 6f6c  er might ask fol
+000007a0: 6c6f 772d 7570 2071 7565 7374 696f 6e73  low-up questions
+000007b0: 2c20 6f72 2061 736b 2066 6f72 2063 6c61  , or ask for cla
+000007c0: 7269 6669 6361 7469 6f6e 7320 6f72 2061  rifications or a
+000007d0: 646a 7573 746d 656e 7473 2e0d 0a20 2020  djustments...   
+000007e0: 2020 2020 2059 6f75 7220 616e 7377 6572       Your answer
+000007f0: 7320 7368 6f75 6c64 2061 6c77 6179 7320  s should always 
+00000800: 636f 6e73 6973 7420 6f66 2074 6865 2066  consist of the f
+00000810: 6f6c 6c6f 7769 6e67 2073 6567 6d65 6e74  ollowing segment
+00000820: 733a 2022 636f 6465 222c 2022 7265 666c  s: "code", "refl
+00000830: 6563 7469 6f6e 2220 616e 6420 2266 6c6f  ection" and "flo
+00000840: 7722 2065 6e63 6c6f 7365 6420 7769 7468  w" enclosed with
+00000850: 696e 203c 7365 676d 656e 743e 3c2f 7365  in <segment></se
+00000860: 676d 656e 743e 2074 6167 732e 0d0a 2020  gment> tags...  
+00000870: 2020 2020 2020 4578 616d 706c 653a 3c63        Example:<c
+00000880: 6f64 653e 596f 7572 2063 6f64 6520 676f  ode>Your code go
+00000890: 6573 2068 6572 653c 2f63 6f64 653e 203c  es here</code> <
+000008a0: 7265 666c 6563 7469 6f6e 3e52 6566 6c65  reflection>Refle
+000008b0: 6374 696f 6e20 6f6e 2079 6f75 7220 616e  ction on your an
+000008c0: 7377 6572 3c2f 7265 666c 6563 7469 6f6e  swer</reflection
+000008d0: 3e20 3c66 6c6f 773e 4d65 726d 6169 6420  > <flow>Mermaid 
+000008e0: 666c 6f77 2064 6961 6772 616d 3c2f 666c  flow diagram</fl
+000008f0: 6f77 3e0d 0a20 2020 2020 2020 2022 2222  ow>..        """
+00000900: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00000910: 2e74 6173 6b20 3d20 2222 220d 0a20 2020  .task = """..   
+00000920: 2020 2020 2059 6f75 2068 6176 6520 6265       You have be
+00000930: 656e 2070 7265 7365 6e74 6564 2077 6974  en presented wit
+00000940: 6820 6120 7061 6e64 6173 2064 6174 6166  h a pandas dataf
+00000950: 7261 6d65 206e 616d 6564 2060 6466 602e  rame named `df`.
+00000960: 0d0a 2020 2020 2020 2020 5468 6520 7265  ..        The re
+00000970: 7375 6c74 206f 6620 6070 7269 6e74 2864  sult of `print(d
+00000980: 662e 6865 6164 2831 2929 6020 6973 3a0d  f.head(1))` is:.
+00000990: 0a20 2020 2020 2020 207b 7d2e 0d0a 2020  .        {}...  
+000009a0: 2020 2020 2020 5265 7475 726e 2074 6865        Return the
+000009b0: 2070 7974 686f 6e20 636f 6465 2074 6861   python code tha
+000009c0: 7420 6163 6f6d 706c 6973 6865 7320 7468  t acomplishes th
+000009d0: 6520 666f 6c6c 6f77 696e 6720 7461 736b  e following task
+000009e0: 733a 207b 7d2e 0d0a 2020 2020 2020 2020  s: {}...        
+000009f0: 416c 7761 7973 2069 6e63 6c75 6465 2074  Always include t
+00000a00: 6865 2069 6d70 6f72 7420 7374 6174 656d  he import statem
+00000a10: 656e 7473 2061 7420 7468 6520 746f 7020  ents at the top 
+00000a20: 6f66 2074 6865 2063 6f64 652c 2061 6e64  of the code, and
+00000a30: 2063 6f6d 6d65 6e74 7320 616e 6420 7072   comments and pr
+00000a40: 696e 7420 7374 6174 656d 656e 7420 7768  int statement wh
+00000a50: 6572 6520 6e65 6365 7373 6172 792e 0d0a  ere necessary...
+00000a60: 2020 2020 2020 2020 5072 6566 6978 2074          Prefix t
+00000a70: 6865 2070 7974 686f 6e20 636f 6465 2077  he python code w
+00000a80: 6974 6820 3c63 6f64 653e 2061 6e64 2073  ith <code> and s
+00000a90: 7566 6669 7820 7468 6520 636f 6465 2077  uffix the code w
+00000aa0: 6974 6820 3c2f 636f 6465 3e2e 2053 6b69  ith </code>. Ski
+00000ab0: 7020 6966 2074 6865 2061 6e73 7765 7220  p if the answer 
+00000ac0: 6361 6e20 6e6f 7420 6265 2065 7870 7265  can not be expre
+00000ad0: 7373 6564 2069 6e20 6120 636f 6465 2e0d  ssed in a code..
+00000ae0: 0a20 2020 2020 2020 204f 6666 6572 2061  .        Offer a
+00000af0: 2020 7265 666c 6563 7469 6f6e 206f 6e20    reflection on 
+00000b00: 796f 7572 2061 6e73 7765 722c 2061 6e64  your answer, and
+00000b10: 2070 6f73 6962 626c 6520 7573 6520 6361   posibble use ca
+00000b20: 7365 2e20 416c 736f 206f 6666 6572 2073  se. Also offer s
+00000b30: 6f6d 6520 616c 7465 726e 6174 6976 6520  ome alternative 
+00000b40: 6170 7072 6f61 6368 6573 2074 6861 7420  approaches that 
+00000b50: 636f 756c 6420 6265 2062 656e 6566 6963  could be benefic
+00000b60: 6961 6c2e 0d0a 2020 2020 2020 2020 5072  ial...        Pr
+00000b70: 6566 6978 2074 6865 2072 6566 6c65 6374  efix the reflect
+00000b80: 696f 6e20 7769 7468 203c 7265 666c 6563  ion with <reflec
+00000b90: 7469 6f6e 3e20 616e 6420 7375 6666 6978  tion> and suffix
+00000ba0: 2074 6865 2072 6566 6c65 6374 696f 6e20   the reflection 
+00000bb0: 7769 7468 203c 2f72 6566 6c65 6374 696f  with </reflectio
+00000bc0: 6e3e 2e0d 0a20 2020 2020 2020 2046 696e  n>...        Fin
+00000bd0: 616c 6c79 206f 7574 7075 7420 6120 636f  ally output a co
+00000be0: 6465 2066 6f72 206d 6572 6d61 6964 2064  de for mermaid d
+00000bf0: 6961 6772 616d 2e20 5468 6520 636f 6465  iagram. The code
+00000c00: 2073 686f 756c 6420 7374 6172 7420 7769   should start wi
+00000c10: 7468 2022 6772 6170 6820 5444 3b22 0d0a  th "graph TD;"..
+00000c20: 2020 2020 2020 2020 5072 6566 6978 2074          Prefix t
+00000c30: 6865 206d 6572 6d61 6964 2063 6f64 6520  he mermaid code 
+00000c40: 7769 7468 203c 666c 6f77 3e20 616e 6420  with <flow> and 
+00000c50: 7375 6666 6978 2074 6865 206d 6572 6d61  suffix the merma
+00000c60: 6964 2066 6c6f 7720 7769 7468 203c 2f66  id flow with </f
+00000c70: 6c6f 773e 2e0d 0a20 2020 2020 2020 2022  low>...        "
+00000c80: 2222 0d0a 0d0a 2020 2020 2020 2020 7365  ""....        se
+00000c90: 6c66 2e65 7272 6f72 5f63 6f72 7265 6374  lf.error_correct
+00000ca0: 5f74 6173 6b20 3d20 2222 220d 0a20 2020  _task = """..   
+00000cb0: 2020 2020 2054 6865 2065 7865 6375 7469       The executi
+00000cc0: 6f6e 206f 6620 7468 6520 636f 6465 2074  on of the code t
+00000cd0: 6861 7420 796f 7520 7072 6f76 6964 6564  hat you provided
+00000ce0: 2069 6e20 7468 6520 7072 6576 696f 7573   in the previous
+00000cf0: 2073 7465 7020 7265 7375 6c74 6564 2069   step resulted i
+00000d00: 6e20 616e 2065 7272 6f72 2e0d 0a20 2020  n an error...   
+00000d10: 2020 2020 2054 6865 2065 7272 6f72 206d       The error m
+00000d20: 6573 7361 6765 2069 733a 207b 7d0d 0a20  essage is: {}.. 
+00000d30: 2020 2020 2020 2052 6574 7572 6e20 6120         Return a 
+00000d40: 636f 7272 6563 7465 6420 7079 7468 6f6e  corrected python
+00000d50: 2063 6f64 6520 7468 6174 2066 6978 6573   code that fixes
+00000d60: 2074 6865 2065 7272 6f72 2e0d 0a20 2020   the error...   
+00000d70: 2020 2020 2041 6c77 6179 7320 696e 636c       Always incl
+00000d80: 7564 6520 7468 6520 696d 706f 7274 2073  ude the import s
+00000d90: 7461 7465 6d65 6e74 7320 6174 2074 6865  tatements at the
+00000da0: 2074 6f70 206f 6620 7468 6520 636f 6465   top of the code
+00000db0: 2c20 616e 6420 636f 6d6d 656e 7473 2061  , and comments a
+00000dc0: 6e64 2070 7269 6e74 2073 7461 7465 6d65  nd print stateme
+00000dd0: 6e74 2077 6865 7265 206e 6563 6573 7361  nt where necessa
+00000de0: 7279 2e0d 0a20 2020 2020 2020 2050 7265  ry...        Pre
+00000df0: 6669 7820 7468 6520 7079 7468 6f6e 2063  fix the python c
+00000e00: 6f64 6520 7769 7468 203c 636f 6465 3e20  ode with <code> 
+00000e10: 616e 6420 7375 6666 6978 2074 6865 2063  and suffix the c
+00000e20: 6f64 6520 7769 7468 203c 2f63 6f64 653e  ode with </code>
+00000e30: 2e20 536b 6970 2069 6620 7468 6520 616e  . Skip if the an
+00000e40: 7377 6572 2063 616e 206e 6f74 2062 6520  swer can not be 
+00000e50: 6578 7072 6573 7365 6420 696e 2061 2063  expressed in a c
+00000e60: 6f64 652e 0d0a 2020 2020 2020 2020 4f66  ode...        Of
+00000e70: 6665 7220 6120 2072 6566 6c65 6374 696f  fer a  reflectio
+00000e80: 6e20 6f6e 2079 6f75 7220 616e 7377 6572  n on your answer
+00000e90: 2c20 616e 6420 706f 7369 6262 6c65 2075  , and posibble u
+00000ea0: 7365 2063 6173 652e 2041 6c73 6f20 6f66  se case. Also of
+00000eb0: 6665 7220 736f 6d65 2061 6c74 6572 6e61  fer some alterna
+00000ec0: 7469 7665 2061 7070 726f 6163 6865 7320  tive approaches 
+00000ed0: 7468 6174 2063 6f75 6c64 2062 6520 6265  that could be be
+00000ee0: 6e65 6669 6369 616c 2e0d 0a20 2020 2020  neficial...     
+00000ef0: 2020 2050 7265 6669 7820 7468 6520 7265     Prefix the re
+00000f00: 666c 6563 7469 6f6e 2077 6974 6820 3c72  flection with <r
+00000f10: 6566 6c65 6374 696f 6e3e 2061 6e64 2073  eflection> and s
+00000f20: 7566 6669 7820 7468 6520 7265 666c 6563  uffix the reflec
+00000f30: 7469 6f6e 2077 6974 6820 3c2f 7265 666c  tion with </refl
+00000f40: 6563 7469 6f6e 3e2e 0d0a 2020 2020 2020  ection>...      
+00000f50: 2020 4669 6e61 6c6c 7920 6f75 7470 7574    Finally output
+00000f60: 2061 2063 6f64 6520 666f 7220 6d65 726d   a code for merm
+00000f70: 6169 6420 6469 6167 7261 6d2e 2054 6865  aid diagram. The
+00000f80: 2063 6f64 6520 7368 6f75 6c64 2073 7461   code should sta
+00000f90: 7274 2077 6974 6820 2267 7261 7068 2054  rt with "graph T
+00000fa0: 443b 220d 0a20 2020 2020 2020 2050 7265  D;"..        Pre
+00000fb0: 6669 7820 7468 6520 6d65 726d 6169 6420  fix the mermaid 
+00000fc0: 636f 6465 2077 6974 6820 3c66 6c6f 773e  code with <flow>
+00000fd0: 2061 6e64 2073 7566 6669 7820 7468 6520   and suffix the 
+00000fe0: 6d65 726d 6169 6420 666c 6f77 2077 6974  mermaid flow wit
+00000ff0: 6820 3c2f 666c 6f77 3e2e 0d0a 2020 2020  h </flow>...    
+00001000: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
+00001010: 2020 206f 7065 6e61 692e 6170 695f 6b65     openai.api_ke
+00001020: 7920 3d20 7365 6c66 2e41 5049 5f4b 4559  y = self.API_KEY
+00001030: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00001040: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00001050: 203d 205b 5d0d 0a0d 0a20 2020 2064 6566   = []....    def
+00001060: 206d 6d28 7365 6c66 2c20 6772 6170 6829   mm(self, graph)
+00001070: 3a0d 0a20 2020 2020 2020 2067 7261 7068  :..        graph
+00001080: 6279 7465 7320 3d20 6772 6170 682e 656e  bytes = graph.en
+00001090: 636f 6465 2822 6173 6369 6922 290d 0a20  code("ascii").. 
+000010a0: 2020 2020 2020 2062 6173 6536 345f 6279         base64_by
+000010b0: 7465 7320 3d20 6261 7365 3634 2e62 3634  tes = base64.b64
+000010c0: 656e 636f 6465 2867 7261 7068 6279 7465  encode(graphbyte
+000010d0: 7329 0d0a 2020 2020 2020 2020 6261 7365  s)..        base
+000010e0: 3634 5f73 7472 696e 6720 3d20 6261 7365  64_string = base
+000010f0: 3634 5f62 7974 6573 2e64 6563 6f64 6528  64_bytes.decode(
+00001100: 2261 7363 6969 2229 0d0a 2020 2020 2020  "ascii")..      
+00001110: 2020 696d 675f 7572 6c20 3d20 2268 7474    img_url = "htt
+00001120: 7073 3a2f 2f6d 6572 6d61 6964 2e69 6e6b  ps://mermaid.ink
+00001130: 2f69 6d67 2f22 202b 2062 6173 6536 345f  /img/" + base64_
+00001140: 7374 7269 6e67 0d0a 2020 2020 2020 2020  string..        
+00001150: 7265 7475 726e 2069 6d67 5f75 726c 0d0a  return img_url..
+00001160: 0d0a 2020 2020 6465 6620 6c6c 6d5f 6361  ..    def llm_ca
+00001170: 6c6c 2873 656c 662c 206d 6573 7361 6765  ll(self, message
+00001180: 733a 2073 7472 2c20 7465 6d70 6572 6174  s: str, temperat
+00001190: 7572 653a 2066 6c6f 6174 203d 2030 2c20  ure: float = 0, 
+000011a0: 6d61 785f 746f 6b65 6e73 3a20 696e 7420  max_tokens: int 
+000011b0: 3d20 3130 3030 293a 0d0a 2020 2020 2020  = 1000):..      
+000011c0: 2020 7265 7370 6f6e 7365 203d 206f 7065    response = ope
+000011d0: 6e61 692e 4368 6174 436f 6d70 6c65 7469  nai.ChatCompleti
+000011e0: 6f6e 2e63 7265 6174 6528 0d0a 2020 2020  on.create(..    
+000011f0: 2020 2020 2020 2020 6d6f 6465 6c3d 7365          model=se
+00001200: 6c66 2e6c 6c6d 2c0d 0a20 2020 2020 2020  lf.llm,..       
+00001210: 2020 2020 206d 6573 7361 6765 733d 6d65       messages=me
+00001220: 7373 6167 6573 2c0d 0a20 2020 2020 2020  ssages,..       
+00001230: 2020 2020 2074 656d 7065 7261 7475 7265       temperature
+00001240: 3d74 656d 7065 7261 7475 7265 2c0d 0a20  =temperature,.. 
+00001250: 2020 2020 2020 2020 2020 206d 6178 5f74             max_t
+00001260: 6f6b 656e 733d 6d61 785f 746f 6b65 6e73  okens=max_tokens
+00001270: 2c0d 0a20 2020 2020 2020 2029 0d0a 0d0a  ,..        )....
+00001280: 2020 2020 2020 2020 636f 6e74 656e 7420          content 
+00001290: 3d20 7265 7370 6f6e 7365 2e63 686f 6963  = response.choic
+000012a0: 6573 5b30 5d2e 6d65 7373 6167 652e 636f  es[0].message.co
+000012b0: 6e74 656e 742e 7374 7269 7028 290d 0a20  ntent.strip().. 
+000012c0: 2020 2020 2020 2074 6f6b 656e 735f 7573         tokens_us
+000012d0: 6564 203d 2072 6573 706f 6e73 652e 7573  ed = response.us
+000012e0: 6167 652e 746f 7461 6c5f 746f 6b65 6e73  age.total_tokens
+000012f0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+00001300: 726e 2063 6f6e 7465 6e74 2c20 746f 6b65  rn content, toke
+00001310: 6e73 5f75 7365 640d 0a20 2020 200d 0a20  ns_used..    .. 
+00001320: 2020 2023 2046 756e 6374 696f 6e73 2074     # Functions t
+00001330: 6f20 7361 6e69 7469 7a65 2074 6865 206f  o sanitize the o
+00001340: 7574 7075 7420 6672 6f6d 2074 6865 204c  utput from the L
+00001350: 4c4d 0d0a 2020 2020 6465 6620 5f65 7874  LM..    def _ext
+00001360: 7261 6374 5f63 6f64 6528 7365 6c66 2c72  ract_code(self,r
+00001370: 6573 706f 6e73 653a 2073 7472 2c20 7365  esponse: str, se
+00001380: 7061 7261 746f 723a 2073 7472 203d 2022  parator: str = "
+00001390: 6060 6022 2920 2d3e 2073 7472 3a0d 0a0d  ```") -> str:...
+000013a0: 0a20 2020 2020 2020 2023 2044 6566 696e  .        # Defin
+000013b0: 6520 6120 626c 6163 6b6c 6973 7420 6f66  e a blacklist of
+000013c0: 2050 7974 686f 6e20 6b65 7977 6f72 6473   Python keywords
+000013d0: 2061 6e64 2066 756e 6374 696f 6e73 2074   and functions t
+000013e0: 6861 7420 6172 6520 6e6f 7420 616c 6c6f  hat are not allo
+000013f0: 7765 640d 0a20 2020 2020 2020 2062 6c61  wed..        bla
+00001400: 636b 6c69 7374 203d 205b 276f 7327 2c27  cklist = ['os','
+00001410: 7375 6270 726f 6365 7373 272c 2773 7973  subprocess','sys
+00001420: 272c 2765 7661 6c27 2c27 6578 6563 272c  ','eval','exec',
+00001430: 2766 696c 6527 2c27 736f 636b 6574 272c  'file','socket',
+00001440: 2775 726c 6c69 6227 2c0d 0a20 2020 2020  'urllib',..     
+00001450: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00001460: 7368 7574 696c 272c 2770 6963 6b6c 6527  shutil','pickle'
+00001470: 2c27 6374 7970 6573 272c 276d 756c 7469  ,'ctypes','multi
+00001480: 7072 6f63 6573 7369 6e67 272c 2774 656d  processing','tem
+00001490: 7066 696c 6527 2c27 676c 6f62 272c 2763  pfile','glob','c
+000014a0: 6f64 6527 2c27 7074 7927 2c27 636f 6d6d  ode','pty','comm
+000014b0: 616e 6473 272c 0d0a 2020 2020 2020 2020  ands',..        
+000014c0: 2020 2020 2020 2020 2020 2020 2772 6571              'req
+000014d0: 7565 7374 7327 2c27 6367 6927 2c27 6367  uests','cgi','cg
+000014e0: 6974 6227 2c27 786d 6c2e 6574 7265 652e  itb','xml.etree.
+000014f0: 456c 656d 656e 7454 7265 6527 2c27 6275  ElementTree','bu
+00001500: 696c 7469 6e73 270d 0a20 2020 2020 2020  iltins'..       
+00001510: 2020 2020 2020 2020 2020 2020 205d 0d0a               ]..
+00001520: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00001530: 2020 2320 5365 6172 6368 2066 6f72 2061    # Search for a
+00001540: 2070 6174 7465 726e 2062 6574 7765 656e   pattern between
+00001550: 203c 7265 666c 6563 7469 6f6e 3e20 616e   <reflection> an
+00001560: 6420 3c2f 7265 666c 6563 7469 6f6e 3e20  d </reflection> 
+00001570: 696e 2074 6865 2072 6573 706f 6e73 650d  in the response.
+00001580: 0a20 2020 2020 2020 206d 6174 6368 203d  .        match =
+00001590: 2072 652e 7365 6172 6368 2872 223c 7265   re.search(r"<re
+000015a0: 666c 6563 7469 6f6e 3e28 2e2a 293c 2f72  flection>(.*)</r
+000015b0: 6566 6c65 6374 696f 6e3e 222c 2072 6573  eflection>", res
+000015c0: 706f 6e73 652c 2072 652e 444f 5441 4c4c  ponse, re.DOTALL
+000015d0: 290d 0a20 2020 2020 2020 2069 6620 6d61  )..        if ma
+000015e0: 7463 683a 0d0a 2020 2020 2020 2020 2020  tch:..          
+000015f0: 2020 2320 4966 2061 206d 6174 6368 2069    # If a match i
+00001600: 7320 666f 756e 642c 2065 7874 7261 6374  s found, extract
+00001610: 2074 6865 2072 6566 6c65 6374 696f 6e20   the reflection 
+00001620: 6265 7477 6565 6e20 3c72 6566 6c65 6374  between <reflect
+00001630: 696f 6e3e 2061 6e64 203c 2f72 6566 6c65  ion> and </refle
+00001640: 6374 696f 6e3e 0d0a 2020 2020 2020 2020  ction>..        
+00001650: 2020 2020 7265 666c 6563 7469 6f6e 203d      reflection =
+00001660: 206d 6174 6368 2e67 726f 7570 2831 290d   match.group(1).
+00001670: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00001680: 2020 2020 2020 2020 2020 2020 7265 666c              refl
+00001690: 6563 7469 6f6e 203d 2022 220d 0a0d 0a20  ection = "".... 
+000016a0: 2020 2020 2020 2023 2053 6561 7263 6820         # Search 
+000016b0: 666f 7220 6120 7061 7474 6572 6e20 6265  for a pattern be
+000016c0: 7477 6565 6e20 3c66 6c6f 773e 2061 6e64  tween <flow> and
+000016d0: 203c 2f66 6c6f 773e 2069 6e20 7468 6520   </flow> in the 
+000016e0: 7265 7370 6f6e 7365 0d0a 2020 2020 2020  response..      
+000016f0: 2020 6d61 7463 6820 3d20 7265 2e73 6561    match = re.sea
+00001700: 7263 6828 7222 3c66 6c6f 773e 282e 2a29  rch(r"<flow>(.*)
+00001710: 3c2f 666c 6f77 3e22 2c20 7265 7370 6f6e  </flow>", respon
+00001720: 7365 2c20 7265 2e44 4f54 414c 4c29 0d0a  se, re.DOTALL)..
+00001730: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+00001740: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00001750: 2049 6620 6120 6d61 7463 6820 6973 2066   If a match is f
+00001760: 6f75 6e64 2c20 6578 7472 6163 7420 7468  ound, extract th
+00001770: 6520 7265 666c 6563 7469 6f6e 2062 6574  e reflection bet
+00001780: 7765 656e 203c 7265 666c 6563 7469 6f6e  ween <reflection
+00001790: 3e20 616e 6420 3c2f 7265 666c 6563 7469  > and </reflecti
+000017a0: 6f6e 3e0d 0a20 2020 2020 2020 2020 2020  on>..           
+000017b0: 2066 6c6f 7720 3d20 6d61 7463 682e 6772   flow = match.gr
+000017c0: 6f75 7028 3129 0d0a 2020 2020 2020 2020  oup(1)..        
+000017d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000017e0: 2020 2066 6c6f 7720 3d20 2222 0d0a 0d0a     flow = ""....
+000017f0: 2020 2020 2020 2020 2320 5365 6172 6368          # Search
+00001800: 2066 6f72 2061 2070 6174 7465 726e 2062   for a pattern b
 00001810: 6574 7765 656e 203c 636f 6465 3e20 616e  etween <code> an
-00001820: 6420 3c2f 636f 6465 3e0d 0a20 2020 2020  d </code>..     
-00001830: 2020 2020 2020 2063 6f64 6520 3d20 6d61         code = ma
-00001840: 7463 682e 6772 6f75 7028 3129 0d0a 2020  tch.group(1)..  
-00001850: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
-00001860: 6865 2072 6573 706f 6e73 6520 636f 6e74  he response cont
-00001870: 6169 6e73 2074 6865 2073 6570 6172 6174  ains the separat
-00001880: 6f72 2c20 6578 7472 6163 7420 7468 6520  or, extract the 
-00001890: 636f 6465 2062 6c6f 636b 2062 6574 7765  code block betwe
-000018a0: 656e 2074 6865 2073 6570 6172 6174 6f72  en the separator
-000018b0: 730d 0a20 2020 2020 2020 2020 2020 2069  s..            i
-000018c0: 6620 6c65 6e28 636f 6465 2e73 706c 6974  f len(code.split
-000018d0: 2873 6570 6172 6174 6f72 2929 203e 2031  (separator)) > 1
-000018e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000018f0: 2020 2063 6f64 6520 3d20 636f 6465 2e73     code = code.s
-00001900: 706c 6974 2873 6570 6172 6174 6f72 295b  plit(separator)[
-00001910: 315d 0d0a 0d0a 2020 2020 2020 2020 2320  1]....        # 
-00001920: 4966 2074 6865 2072 6573 706f 6e73 6520  If the response 
-00001930: 636f 6e74 6169 6e73 2074 6865 2073 6570  contains the sep
-00001940: 6172 6174 6f72 2c20 6578 7472 6163 7420  arator, extract 
-00001950: 7468 6520 636f 6465 2062 6c6f 636b 2062  the code block b
-00001960: 6574 7765 656e 2074 6865 2073 6570 6172  etween the separ
-00001970: 6174 6f72 730d 0a20 2020 2020 2020 2069  ators..        i
-00001980: 6620 6c65 6e28 7265 7370 6f6e 7365 2e73  f len(response.s
-00001990: 706c 6974 2873 6570 6172 6174 6f72 2929  plit(separator))
-000019a0: 203e 2031 3a0d 0a20 2020 2020 2020 2020   > 1:..         
-000019b0: 2020 2063 6f64 6520 3d20 7265 7370 6f6e     code = respon
-000019c0: 7365 2e73 706c 6974 2873 6570 6172 6174  se.split(separat
-000019d0: 6f72 295b 315d 0d0a 2020 2020 2020 2020  or)[1]..        
-000019e0: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
-000019f0: 5265 6d6f 7665 2074 6865 2022 7079 7468  Remove the "pyth
-00001a00: 6f6e 2220 6f72 2022 7079 2220 7072 6566  on" or "py" pref
-00001a10: 6978 2069 6620 7072 6573 656e 740d 0a20  ix if present.. 
-00001a20: 2020 2020 2020 2069 6620 7265 2e6d 6174         if re.mat
-00001a30: 6368 2872 225e 2870 7974 686f 6e7c 7079  ch(r"^(python|py
-00001a40: 2922 2c20 636f 6465 293a 0d0a 2020 2020  )", code):..    
-00001a50: 2020 2020 2020 2020 636f 6465 203d 2072          code = r
-00001a60: 652e 7375 6228 7222 5e28 7079 7468 6f6e  e.sub(r"^(python
-00001a70: 7c70 7929 222c 2022 222c 2063 6f64 6529  |py)", "", code)
-00001a80: 0d0a 2020 2020 2020 2020 2320 4966 2074  ..        # If t
-00001a90: 6865 2063 6f64 6520 6973 2062 6574 7765  he code is betwe
-00001aa0: 656e 2073 696e 676c 6520 6261 636b 7469  en single backti
-00001ab0: 636b 732c 2065 7874 7261 6374 2074 6865  cks, extract the
-00001ac0: 2063 6f64 6520 6265 7477 6565 6e20 7468   code between th
-00001ad0: 656d 0d0a 2020 2020 2020 2020 6966 2072  em..        if r
-00001ae0: 652e 6d61 7463 6828 7222 5e60 2e2a 6024  e.match(r"^`.*`$
-00001af0: 222c 2063 6f64 6529 3a0d 0a20 2020 2020  ", code):..     
-00001b00: 2020 2020 2020 2063 6f64 6520 3d20 7265         code = re
-00001b10: 2e73 7562 2872 225e 6028 2e2a 2960 2422  .sub(r"^`(.*)`$"
-00001b20: 2c20 7222 5c31 222c 2063 6f64 6529 0d0a  , r"\1", code)..
-00001b30: 0d0a 2020 2020 2020 2020 2320 5265 6d6f  ..        # Remo
-00001b40: 7665 2061 6e79 2069 6e73 7461 6e63 6573  ve any instances
-00001b50: 206f 6620 2264 6620 3d20 7064 2e72 6561   of "df = pd.rea
-00001b60: 645f 6373 7628 2766 696c 656e 616d 652e  d_csv('filename.
-00001b70: 6373 7627 2922 2066 726f 6d20 7468 6520  csv')" from the 
-00001b80: 636f 6465 0d0a 2020 2020 2020 2020 636f  code..        co
-00001b90: 6465 203d 2072 652e 7375 6228 7222 6466  de = re.sub(r"df
-00001ba0: 5c73 2a3d 5c73 2a70 645c 2e72 6561 645f  \s*=\s*pd\.read_
-00001bb0: 6373 765c 2827 2e2a 3f27 5c29 222c 2022  csv\('.*?'\)", "
-00001bc0: 222c 2063 6f64 6529 0d0a 2020 2020 2020  ", code)..      
-00001bd0: 2020 0d0a 2020 2020 2020 2020 2320 5265    ..        # Re
-00001be0: 6d6f 7665 2061 6e79 206f 6363 7572 7265  move any occurre
-00001bf0: 6e63 6573 206f 6620 6466 203d 2070 642e  nces of df = pd.
-00001c00: 4461 7461 4672 616d 6528 2920 7769 7468  DataFrame() with
-00001c10: 2061 6e79 206e 756d 6265 7220 6f66 2063   any number of c
-00001c20: 6861 7261 6374 6572 7320 696e 7369 6465  haracters inside
-00001c30: 2074 6865 2070 6172 656e 7468 6573 6573   the parentheses
-00001c40: 2e0d 0a20 2020 2020 2020 2063 6f64 6520  ...        code 
-00001c50: 3d20 7265 2e73 7562 2872 2264 665c 732a  = re.sub(r"df\s*
-00001c60: 3d5c 732a 7064 5c2e 4461 7461 4672 616d  =\s*pd\.DataFram
-00001c70: 655c 282e 2a3f 5c29 222c 2022 222c 2063  e\(.*?\)", "", c
-00001c80: 6f64 6529 0d0a 0d0a 2020 2020 2020 2020  ode)....        
-00001c90: 2320 4465 6669 6e65 2074 6865 2072 6567  # Define the reg
-00001ca0: 756c 6172 2065 7870 7265 7373 696f 6e20  ular expression 
-00001cb0: 7061 7474 6572 6e20 746f 206d 6174 6368  pattern to match
-00001cc0: 2074 6865 2062 6c61 636b 6c69 7374 2069   the blacklist i
-00001cd0: 7465 6d73 0d0a 2020 2020 2020 2020 7061  tems..        pa
-00001ce0: 7474 6572 6e20 3d20 7222 5e28 2e2a 5c62  ttern = r"^(.*\b
-00001cf0: 2822 202b 2022 7c22 2e6a 6f69 6e28 626c  (" + "|".join(bl
-00001d00: 6163 6b6c 6973 7429 202b 2072 2229 5c62  acklist) + r")\b
-00001d10: 2e2a 2924 220d 0a0d 0a20 2020 2020 2020  .*)$"....       
-00001d20: 2023 2052 6570 6c61 6365 2074 6865 2062   # Replace the b
-00001d30: 6c61 636b 6c69 7374 2069 7465 6d73 2077  lacklist items w
-00001d40: 6974 6820 636f 6d6d 656e 7473 0d0a 2020  ith comments..  
-00001d50: 2020 2020 2020 636f 6465 203d 2072 652e        code = re.
-00001d60: 7375 6228 7061 7474 6572 6e2c 2072 2223  sub(pattern, r"#
-00001d70: 206e 6f74 2061 6c6c 6f77 6564 205c 3122   not allowed \1"
-00001d80: 2c20 636f 6465 2c20 666c 6167 733d 7265  , code, flags=re
-00001d90: 2e4d 554c 5449 4c49 4e45 290d 0a0d 0a20  .MULTILINE).... 
-00001da0: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
-00001db0: 7468 6520 636c 6561 6e65 6420 616e 6420  the cleaned and 
-00001dc0: 6578 7472 6163 7465 6420 636f 6465 0d0a  extracted code..
-00001dd0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00001de0: 6f64 652e 7374 7269 7028 292c 2072 6566  ode.strip(), ref
-00001df0: 6c65 6374 696f 6e2e 7374 7269 7028 292c  lection.strip(),
-00001e00: 2066 6c6f 772e 7374 7269 7028 290d 0a20   flow.strip().. 
-00001e10: 2020 200d 0a20 2020 2064 6566 205f 6578     ..    def _ex
-00001e20: 7472 6163 745f 7461 736b 2873 656c 662c  tract_task(self,
-00001e30: 2072 6573 706f 6e73 653a 2073 7472 2920   response: str) 
-00001e40: 2d3e 2073 7472 3a0d 0a20 2020 2020 2020  -> str:..       
-00001e50: 2023 2053 6561 7263 6820 666f 7220 6120   # Search for a 
-00001e60: 7061 7474 6572 6e20 6265 7477 6565 6e20  pattern between 
-00001e70: 3c74 6173 6b3e 2061 6e64 203c 2f74 6173  <task> and </tas
-00001e80: 6b3e 2069 6e20 7468 6520 7265 7370 6f6e  k> in the respon
-00001e90: 7365 0d0a 2020 2020 2020 2020 6d61 7463  se..        matc
-00001ea0: 6820 3d20 7265 2e73 6561 7263 6828 7222  h = re.search(r"
-00001eb0: 3c74 6173 6b5f 6c69 7374 3e28 2e2a 293c  <task_list>(.*)<
-00001ec0: 2f74 6173 6b5f 6c69 7374 3e22 2c20 7265  /task_list>", re
-00001ed0: 7370 6f6e 7365 2c20 7265 2e44 4f54 414c  sponse, re.DOTAL
-00001ee0: 4c29 0d0a 0d0a 2020 2020 2020 2020 6966  L)....        if
-00001ef0: 206d 6174 6368 3a0d 0a20 2020 2020 2020   match:..       
-00001f00: 2020 2020 2023 2049 6620 6120 6d61 7463       # If a matc
-00001f10: 6820 6973 2066 6f75 6e64 2c20 6578 7472  h is found, extr
-00001f20: 6163 7420 7468 6520 7461 736b 2062 6574  act the task bet
-00001f30: 7765 656e 203c 7461 736b 3e20 616e 6420  ween <task> and 
-00001f40: 3c2f 7461 736b 3e0d 0a20 2020 2020 2020  </task>..       
-00001f50: 2020 2020 2074 6173 6b20 3d20 6d61 7463       task = matc
-00001f60: 682e 6772 6f75 7028 3129 0d0a 0d0a 2020  h.group(1)....  
-00001f70: 2020 2020 2020 2020 2020 2320 4576 6572            # Ever
-00001f80: 7974 6869 6e67 206f 7574 7369 6465 206f  ything outside o
-00001f90: 6620 3c74 6173 6b3e 3c2f 7461 736b 3e20  f <task></task> 
-00001fa0: 676f 6573 2074 6f20 7265 6173 6f6e 696e  goes to reasonin
-00001fb0: 672e 0d0a 2020 2020 2020 2020 2020 2020  g...            
-00001fc0: 2320 4974 2073 706c 6974 7320 7468 6520  # It splits the 
-00001fd0: 7265 7370 6f6e 7365 2069 6e74 6f20 7477  response into tw
-00001fe0: 6f20 7061 7274 732c 2065 7665 7279 7468  o parts, everyth
-00001ff0: 696e 6720 6265 666f 7265 203c 7461 736b  ing before <task
-00002000: 3e20 616e 6420 6576 6572 7974 6869 6e67  > and everything
-00002010: 2061 6674 6572 203c 2f74 6173 6b3e 0d0a   after </task>..
-00002020: 2020 2020 2020 2020 2020 2020 7265 6173              reas
-00002030: 6f6e 696e 675f 7061 7274 7320 3d20 7265  oning_parts = re
-00002040: 2e73 706c 6974 2872 223c 7461 736b 5f6c  .split(r"<task_l
-00002050: 6973 743e 2e2a 3c2f 7461 736b 5f6c 6973  ist>.*</task_lis
-00002060: 743e 222c 2072 6573 706f 6e73 652c 2066  t>", response, f
-00002070: 6c61 6773 3d72 652e 444f 5441 4c4c 290d  lags=re.DOTALL).
-00002080: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
-00002090: 736f 6e69 6e67 203d 2022 222e 6a6f 696e  soning = "".join
-000020a0: 2872 6561 736f 6e69 6e67 5f70 6172 7473  (reasoning_parts
-000020b0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-000020c0: 0d0a 2020 2020 2020 2020 2020 2020 7461  ..            ta
-000020d0: 736b 203d 204e 6f6e 650d 0a20 2020 2020  sk = None..     
-000020e0: 2020 2020 2020 2023 2049 6620 6e6f 2074         # If no t
-000020f0: 6173 6b20 6973 2066 6f75 6e64 2c20 616c  ask is found, al
-00002100: 6c20 7468 6520 7265 7370 6f6e 7365 2067  l the response g
-00002110: 6f65 7320 746f 2072 6561 736f 6e69 6e67  oes to reasoning
-00002120: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00002130: 6173 6f6e 696e 6720 3d20 7265 7370 6f6e  asoning = respon
-00002140: 7365 0d0a 0d0a 2020 2020 2020 2020 2320  se....        # 
-00002150: 5265 7475 726e 696e 6720 626f 7468 2074  Returning both t
-00002160: 6173 6b20 616e 6420 7265 6173 6f6e 696e  ask and reasonin
-00002170: 670d 0a20 2020 2020 2020 2072 6574 7572  g..        retur
-00002180: 6e20 7461 736b 2c20 7265 6173 6f6e 696e  n task, reasonin
-00002190: 670d 0a20 2020 200d 0a20 2020 2064 6566  g..    ..    def
-000021a0: 2074 6173 6b5f 6576 616c 2873 656c 662c   task_eval(self,
-000021b0: 2071 7565 7374 696f 6e3d 4e6f 6e65 293a   question=None):
-000021c0: 0d0a 2020 2020 2020 2020 2320 496e 6974  ..        # Init
-000021d0: 6961 6c69 7a65 2074 6865 206d 6573 7361  ialize the messa
-000021e0: 6765 7320 6c69 7374 2077 6974 6820 6120  ges list with a 
-000021f0: 7379 7374 656d 206d 6573 7361 6765 2063  system message c
-00002200: 6f6e 7461 696e 696e 6720 7468 6520 7461  ontaining the ta
-00002210: 736b 2070 726f 6d70 740d 0a20 2020 2020  sk prompt..     
-00002220: 2020 2065 7661 6c5f 6d65 7373 6167 6573     eval_messages
-00002230: 203d 205b 7b22 726f 6c65 223a 2022 7379   = [{"role": "sy
-00002240: 7374 656d 222c 2022 636f 6e74 656e 7422  stem", "content"
-00002250: 3a20 7365 6c66 2e74 6173 6b5f 6576 616c  : self.task_eval
-00002260: 7561 7469 6f6e 2e66 6f72 6d61 7428 7365  uation.format(se
-00002270: 6c66 2e64 665f 6865 6164 2c20 7175 6573  lf.df_head, ques
-00002280: 7469 6f6e 297d 5d0d 0a0d 0a20 2020 2020  tion)}]....     
-00002290: 2020 2069 6620 2769 7079 6b65 726e 656c     if 'ipykernel
-000022a0: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
-000022b0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-000022c0: 204a 7570 7974 6572 206e 6f74 6562 6f6f   Jupyter noteboo
-000022d0: 6b20 6f72 2069 7079 7468 6f6e 0d0a 2020  k or ipython..  
-000022e0: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-000022f0: 7928 4854 4d4c 2866 273c 7020 7374 796c  y(HTML(f'<p styl
-00002300: 653d 2263 6f6c 6f72 3a6d 6167 656e 7461  e="color:magenta
-00002310: 3b22 3e5c 6e55 7369 6e67 204d 6f64 656c  ;">\nUsing Model
-00002320: 3a20 7b73 656c 662e 6c6c 6d7d 3c2f 703e  : {self.llm}</p>
-00002330: 2729 290d 0a20 2020 2020 2020 2020 2020  '))..           
-00002340: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
-00002350: 3c70 3e3c 6220 7374 796c 653d 2263 6f6c  <p><b style="col
-00002360: 6f72 3a6d 6167 656e 7461 3b22 3e54 7279  or:magenta;">Try
-00002370: 696e 6720 746f 2064 6574 6572 6d69 6e65  ing to determine
-00002380: 2074 6865 2062 6573 7420 6d65 7468 6f64   the best method
-00002390: 2074 6f20 616e 616c 7973 6520 796f 7574   to analyse yout
-000023a0: 2064 6174 612c 2070 6c65 6173 6520 7761   data, please wa
-000023b0: 6974 2e2e 2e3c 2f62 3e3c 2f70 3e3c 6272  it...</b></p><br
-000023c0: 3e27 2929 0d0a 2020 2020 2020 2020 656c  >'))..        el
-000023d0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000023e0: 2023 204f 7468 6572 2065 6e76 6972 6f6e   # Other environ
-000023f0: 6d65 6e74 2028 6c69 6b65 2074 6572 6d69  ment (like termi
-00002400: 6e61 6c29 0d0a 2020 2020 2020 2020 2020  nal)..          
-00002410: 2020 7072 696e 7428 636f 6c6f 7265 6428    print(colored(
-00002420: 6622 5c6e 3e20 5573 696e 6720 4d6f 6465  f"\n> Using Mode
-00002430: 6c3a 207b 7365 6c66 2e6c 6c6d 7d22 2c20  l: {self.llm}", 
-00002440: 226d 6167 656e 7461 2229 290d 0a20 2020  "magenta"))..   
-00002450: 2020 2020 2020 2020 2063 7072 696e 7428           cprint(
-00002460: 6622 5c6e 3e20 5472 7969 6e67 2074 6f20  f"\n> Trying to 
-00002470: 6465 7465 726d 696e 6520 7468 6520 6265  determine the be
-00002480: 7374 206d 6574 686f 6420 746f 2061 6e61  st method to ana
-00002490: 6c79 7365 2079 7572 2064 6174 612c 2070  lyse yur data, p
-000024a0: 6c65 6173 6520 7761 6974 2e2e 2e5c 6e22  lease wait...\n"
-000024b0: 2c20 276d 6167 656e 7461 272c 2061 7474  , 'magenta', att
-000024c0: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 0d0a  rs=['bold'])....
-000024d0: 2020 2020 2020 2020 2320 4675 6e63 7469          # Functi
-000024e0: 6f6e 2074 6f20 6469 7370 6c61 7920 7265  on to display re
-000024f0: 7375 6c74 7320 6e69 6365 6c79 0d0a 2020  sults nicely..  
-00002500: 2020 2020 2020 6465 6620 6469 7370 6c61        def displa
-00002510: 795f 7461 736b 2874 6173 6b2c 7265 6173  y_task(task,reas
-00002520: 6f6e 696e 6729 3a0d 0a20 2020 2020 2020  oning):..       
-00002530: 2020 2020 2069 6620 2769 7079 6b65 726e       if 'ipykern
-00002540: 656c 2720 696e 2073 7973 2e6d 6f64 756c  el' in sys.modul
-00002550: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00002560: 2020 2020 2023 204a 7570 7974 6572 206e       # Jupyter n
-00002570: 6f74 6562 6f6f 6b20 6f72 2069 7079 7468  otebook or ipyth
-00002580: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-00002590: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
-000025a0: 2866 273c 703e 3c62 2073 7479 6c65 3d22  (f'<p><b style="
-000025b0: 636f 6c6f 723a 626c 7565 3b22 3e49 2068  color:blue;">I h
-000025c0: 6176 6520 6576 616c 7561 7465 6420 7365  ave evaluated se
-000025d0: 7665 7261 6c20 706f 7373 6962 6c65 2061  veral possible a
-000025e0: 7070 726f 6163 6865 732e 2042 656c 6f77  pproaches. Below
-000025f0: 2069 7320 6d79 2072 6561 736f 6e69 6e67   is my reasoning
-00002600: 3a3c 2f62 3e3c 6272 3e3c 7072 6520 7374  :</b><br><pre st
-00002610: 796c 653d 2263 6f6c 6f72 3a62 6c61 636b  yle="color:black
-00002620: 3b22 3e7b 7265 6173 6f6e 696e 677d 3c2f  ;">{reasoning}</
-00002630: 7072 653e 3c2f 703e 3c62 723e 2729 290d  pre></p><br>')).
-00002640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002650: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
-00002660: 3c70 3e3c 6220 7374 796c 653d 2263 6f6c  <p><b style="col
-00002670: 6f72 3a62 6c75 653b 223e 4920 6861 7665  or:blue;">I have
-00002680: 2063 7265 6174 6564 2074 6865 2066 6f6c   created the fol
-00002690: 6c6f 7769 6e67 2074 6173 6b20 6c69 7374  lowing task list
-000026a0: 2c20 616e 6420 7769 6c6c 206e 6f77 2074  , and will now t
-000026b0: 7279 2074 6f20 6578 7072 6573 7320 6974  ry to express it
-000026c0: 2069 6e20 636f 6465 3a3c 2f62 3e3c 6272   in code:</b><br
-000026d0: 3e3c 7072 6520 7374 796c 653d 2263 6f6c  ><pre style="col
-000026e0: 6f72 3a62 6c61 636b 3b22 3e3c 623e 7b74  or:black;"><b>{t
-000026f0: 6173 6b7d 3c2f 623e 3c2f 7072 653e 3c2f  ask}</b></pre></
-00002700: 703e 3c62 723e 2729 290d 0a20 2020 2020  p><br>'))..     
-00002710: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00002720: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00002730: 4f74 6865 7220 656e 7669 726f 6e6d 656e  Other environmen
-00002740: 7420 286c 696b 6520 7465 726d 696e 616c  t (like terminal
-00002750: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00002760: 2020 2063 7072 696e 7428 6622 5c6e 4920     cprint(f"\nI 
-00002770: 6861 7665 2065 7661 6c75 6174 6564 2073  have evaluated s
-00002780: 6576 6572 616c 2070 6f73 7369 626c 6520  everal possible 
-00002790: 6170 7072 6f61 6368 6573 2e20 4265 6c6f  approaches. Belo
-000027a0: 7720 6973 206d 7920 7265 6173 6f6e 696e  w is my reasonin
-000027b0: 673a 5c6e 7b72 6561 736f 6e69 6e67 7d5c  g:\n{reasoning}\
-000027c0: 6e22 2c20 276d 6167 656e 7461 272c 2061  n", 'magenta', a
-000027d0: 7474 7273 3d5b 2762 6f6c 6427 5d29 0d0a  ttrs=['bold'])..
-000027e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027f0: 6370 7269 6e74 2866 225c 6e54 6173 6b3a  cprint(f"\nTask:
-00002800: 5c6e 7b74 6173 6b7d 5c6e 222c 2027 6d61  \n{task}\n", 'ma
-00002810: 6765 6e74 6127 2c20 6174 7472 733d 5b27  genta', attrs=['
-00002820: 626f 6c64 275d 290d 0a0d 0a20 2020 2020  bold'])....     
-00002830: 2020 2023 2043 616c 6c20 7468 6520 4f70     # Call the Op
-00002840: 656e 4149 2041 5049 2061 6e64 2068 616e  enAI API and han
-00002850: 646c 6520 7261 7465 206c 696d 6974 2065  dle rate limit e
-00002860: 7272 6f72 730d 0a20 2020 2020 2020 2074  rrors..        t
-00002870: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-00002880: 206c 6c6d 5f72 6573 706f 6e73 652c 2074   llm_response, t
-00002890: 6f6b 656e 735f 7573 6564 203d 2073 656c  okens_used = sel
-000028a0: 662e 6c6c 6d5f 6361 6c6c 2865 7661 6c5f  f.llm_call(eval_
-000028b0: 6d65 7373 6167 6573 2c74 656d 7065 7261  messages,tempera
-000028c0: 7475 7265 3d30 2920 2320 6869 6768 6572  ture=0) # higher
-000028d0: 2074 656d 7065 7261 7475 7265 2072 6573   temperature res
-000028e0: 756c 7473 2069 6e20 6d6f 7265 2022 6372  ults in more "cr
-000028f0: 6561 7469 7665 2220 616e 7377 6572 7320  eative" answers 
-00002900: 2873 6f6d 6574 696d 6573 2074 6f6f 2063  (sometimes too c
-00002910: 7265 6174 6976 6520 3a2d 2929 0d0a 2020  reative :-))..  
-00002920: 2020 2020 2020 6578 6365 7074 206f 7065        except ope
-00002930: 6e61 692e 6572 726f 722e 5261 7465 4c69  nai.error.RateLi
-00002940: 6d69 7445 7272 6f72 3a0d 0a20 2020 2020  mitError:..     
-00002950: 2020 2020 2020 2070 7269 6e74 280d 0a20         print(.. 
-00002960: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00002970: 5468 6520 4f70 656e 4149 2041 5049 2072  The OpenAI API r
-00002980: 6174 6520 6c69 6d69 7420 6861 7320 6265  ate limit has be
-00002990: 656e 2065 7863 6565 6465 642e 2057 6169  en exceeded. Wai
-000029a0: 7469 6e67 2031 3020 7365 636f 6e64 7320  ting 10 seconds 
-000029b0: 616e 6420 7472 7969 6e67 2061 6761 696e  and trying again
-000029c0: 2e22 0d0a 2020 2020 2020 2020 2020 2020  ."..            
-000029d0: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
-000029e0: 696d 652e 736c 6565 7028 3130 290d 0a20  ime.sleep(10).. 
-000029f0: 2020 2020 2020 2020 2020 206c 6c6d 5f72             llm_r
-00002a00: 6573 706f 6e73 652c 2074 6f6b 656e 735f  esponse, tokens_
-00002a10: 7573 6564 203d 2073 656c 662e 6c6c 6d5f  used = self.llm_
-00002a20: 6361 6c6c 2865 7661 6c5f 6d65 7373 6167  call(eval_messag
-00002a30: 6573 290d 0a0d 0a20 2020 2020 2020 2023  es)....        #
-00002a40: 2045 7874 7261 6374 2074 6865 2074 6173   Extract the tas
-00002a50: 6b20 616e 6420 6573 6f6e 696e 6720 6672  k and esoning fr
-00002a60: 6f6d 2074 6865 2041 5049 2072 6573 706f  om the API respo
-00002a70: 6e73 650d 0a20 2020 2020 2020 2074 6173  nse..        tas
-00002a80: 6b2c 7265 6173 6f6e 696e 6720 3d20 7365  k,reasoning = se
-00002a90: 6c66 2e5f 6578 7472 6163 745f 7461 736b  lf._extract_task
-00002aa0: 286c 6c6d 5f72 6573 706f 6e73 6529 0d0a  (llm_response)..
-00002ab0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00002ac0: 2020 2355 7365 2074 6865 2075 7365 7220    #Use the user 
-00002ad0: 7072 6f6d 7074 2061 7320 6120 7461 736b  prompt as a task
-00002ae0: 2069 6620 7461 736b 2063 616e 206e 6f74   if task can not
-00002af0: 2062 6520 6578 6374 7261 6374 6564 0d0a   be exctracted..
-00002b00: 2020 2020 2020 2020 6966 2074 6173 6b20          if task 
-00002b10: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00002b20: 2020 2020 2020 7461 736b 203d 2071 7565        task = que
-00002b30: 7374 696f 6e0d 0a20 2020 2020 2020 200d  stion..        .
-00002b40: 0a20 2020 2020 2020 2023 2050 7269 6e74  .        # Print
-00002b50: 2072 6561 736f 6e69 6e67 0d0a 2020 2020   reasoning..    
-00002b60: 2020 2020 6469 7370 6c61 795f 7461 736b      display_task
-00002b70: 2874 6173 6b2c 7265 6173 6f6e 696e 6729  (task,reasoning)
-00002b80: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00002b90: 2e74 6f74 616c 5f74 6f6b 656e 735f 7573  .total_tokens_us
-00002ba0: 6564 2e61 7070 656e 6428 746f 6b65 6e73  ed.append(tokens
-00002bb0: 5f75 7365 6429 0d0a 0d0a 2020 2020 2020  _used)....      
-00002bc0: 2020 7265 7475 726e 2074 6173 6b0d 0a0d    return task...
-00002bd0: 0a20 2020 2064 6566 2070 645f 6167 656e  .    def pd_agen
-00002be0: 745f 636f 6e76 6572 7365 2873 656c 662c  t_converse(self,
-00002bf0: 2071 7565 7374 696f 6e3d 4e6f 6e65 293a   question=None):
-00002c00: 0d0a 2020 2020 2020 2020 2320 496e 6974  ..        # Init
-00002c10: 6961 6c69 7a65 2074 6865 206d 6573 7361  ialize the messa
-00002c20: 6765 7320 6c69 7374 2077 6974 6820 6120  ges list with a 
-00002c30: 7379 7374 656d 206d 6573 7361 6765 2063  system message c
-00002c40: 6f6e 7461 696e 696e 6720 7468 6520 7461  ontaining the ta
-00002c50: 736b 2070 726f 6d70 740d 0a20 2020 2020  sk prompt..     
-00002c60: 2020 206d 6573 7361 6765 7320 3d20 5b7b     messages = [{
-00002c70: 2272 6f6c 6522 3a20 2273 7973 7465 6d22  "role": "system"
-00002c80: 2c20 2263 6f6e 7465 6e74 223a 2073 656c  , "content": sel
-00002c90: 662e 7461 736b 2e66 6f72 6d61 7428 7365  f.task.format(se
-00002ca0: 6c66 2e64 665f 6865 6164 2c20 2222 297d  lf.df_head, "")}
-00002cb0: 5d0d 0a0d 0a20 2020 2020 2020 2023 2046  ]....        # F
-00002cc0: 756e 6374 696f 6e20 746f 2064 6973 706c  unction to displ
-00002cd0: 6179 2072 6573 756c 7473 206e 6963 656c  ay results nicel
-00002ce0: 790d 0a20 2020 2020 2020 2064 6566 2064  y..        def d
-00002cf0: 6973 706c 6179 5f72 6573 756c 7473 2861  isplay_results(a
-00002d00: 6e73 7765 722c 2063 6f64 652c 2072 6566  nswer, code, ref
-00002d10: 6c65 6374 696f 6e2c 2066 6c6f 772c 2074  lection, flow, t
-00002d20: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
-00002d30: 5f73 756d 293a 0d0a 2020 2020 2020 2020  _sum):..        
-00002d40: 2020 2020 6966 2027 6970 796b 6572 6e65      if 'ipykerne
-00002d50: 6c27 2069 6e20 7379 732e 6d6f 6475 6c65  l' in sys.module
-00002d60: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00002d70: 2020 2020 2320 4a75 7079 7465 7220 6e6f      # Jupyter no
-00002d80: 7465 626f 6f6b 206f 7220 6970 7974 686f  tebook or ipytho
-00002d90: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-00002da0: 2020 2064 6973 706c 6179 2848 544d 4c28     display(HTML(
-00002db0: 6627 3c70 3e3c 6220 7374 796c 653d 2263  f'<p><b style="c
-00002dc0: 6f6c 6f72 3a62 6c75 653b 223e 416e 7377  olor:blue;">Answ
-00002dd0: 6572 3a3c 2f62 3e3c 6272 3e3c 7072 6520  er:</b><br><pre 
-00002de0: 7374 796c 653d 2263 6f6c 6f72 3a62 6c61  style="color:bla
-00002df0: 636b 3b22 3e3c 623e 7b61 6e73 7765 727d  ck;"><b>{answer}
-00002e00: 3c2f 623e 3c2f 7072 653e 3c2f 703e 3c62  </b></pre></p><b
-00002e10: 723e 2729 290d 0a20 2020 2020 2020 2020  r>'))..         
-00002e20: 2020 2020 2020 2064 6973 706c 6179 2848         display(H
-00002e30: 544d 4c28 6627 3c70 3e3c 6220 7374 796c  TML(f'<p><b styl
-00002e40: 653d 2263 6f6c 6f72 3a62 6c75 653b 223e  e="color:blue;">
-00002e50: 4920 6861 7665 2067 656e 6572 6174 6564  I have generated
-00002e60: 2074 6865 2066 6f6c 6c6f 7769 6e67 2063   the following c
-00002e70: 6f64 653a 3c2f 623e 3c62 723e 3c70 7265  ode:</b><br><pre
-00002e80: 2073 7479 6c65 3d22 636f 6c6f 723a 2335   style="color:#5
-00002e90: 3535 3535 353b 223e 7b63 6f64 657d 3c2f  55555;">{code}</
-00002ea0: 7072 653e 3c2f 703e 3c62 723e 2729 290d  pre></p><br>')).
-00002eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ec0: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
-00002ed0: 3c70 3e3c 6220 7374 796c 653d 2263 6f6c  <p><b style="col
-00002ee0: 6f72 3a62 6c75 653b 223e 4669 6e61 6c20  or:blue;">Final 
-00002ef0: 5468 6f75 6768 7473 3a3c 2f62 3e3c 6272  Thoughts:</b><br
-00002f00: 3e3c 6220 7374 796c 653d 2263 6f6c 6f72  ><b style="color
-00002f10: 3a62 6c61 636b 3b22 3e7b 7265 666c 6563  :black;">{reflec
-00002f20: 7469 6f6e 7d3c 2f62 3e3c 2f70 3e3c 6272  tion}</b></p><br
-00002f30: 3e27 2929 0d0a 2020 2020 2020 2020 2020  >'))..          
-00002f40: 2020 2020 2020 6469 7370 6c61 7928 4854        display(HT
-00002f50: 4d4c 2866 273c 703e 3c62 2073 7479 6c65  ML(f'<p><b style
-00002f60: 3d22 636f 6c6f 723a 626c 7565 3b22 3e42  ="color:blue;">B
-00002f70: 656c 6f77 2069 7320 6d79 2061 7070 726f  elow is my appro
-00002f80: 6368 2061 7320 6120 466c 6f77 2063 6861  ch as a Flow cha
-00002f90: 7274 3a3c 2f62 3e3c 6272 3e3c 696d 6720  rt:</b><br><img 
-00002fa0: 7372 633d 227b 7365 6c66 2e6d 6d28 666c  src="{self.mm(fl
-00002fb0: 6f77 297d 2220 616c 743d 2241 6e61 6c79  ow)}" alt="Analy
-00002fc0: 7369 7320 466c 6f77 223e 3c2f 696d 673e  sis Flow"></img>
-00002fd0: 3c2f 703e 3c62 723e 2729 290d 0a20 2020  </p><br>'))..   
-00002fe0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-00002ff0: 706c 6179 2848 544d 4c28 6627 3c70 3e3c  play(HTML(f'<p><
-00003000: 6220 7374 796c 653d 2263 6f6c 6f72 3a62  b style="color:b
-00003010: 6c75 653b 223e 546f 7461 6c20 546f 6b65  lue;">Total Toke
-00003020: 6e73 2055 7365 643a 3c2f 623e 3c62 723e  ns Used:</b><br>
-00003030: 3c73 7061 6e20 7374 796c 653d 2263 6f6c  <span style="col
-00003040: 6f72 3a62 6c61 636b 3b22 3e7b 746f 7461  or:black;">{tota
-00003050: 6c5f 746f 6b65 6e73 5f75 7365 645f 7375  l_tokens_used_su
-00003060: 6d7d 3c2f 7370 616e 3e3c 2f70 3e3c 6272  m}</span></p><br
-00003070: 3e27 2929 0d0a 2020 2020 2020 2020 2020  >'))..          
-00003080: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00003090: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
-000030a0: 2065 6e76 6972 6f6e 6d65 6e74 2028 6c69   environment (li
-000030b0: 6b65 2074 6572 6d69 6e61 6c29 0d0a 2020  ke terminal)..  
-000030c0: 2020 2020 2020 2020 2020 2020 2020 6370                cp
-000030d0: 7269 6e74 2866 225c 6e3e 2041 6e73 7765  rint(f"\n> Answe
-000030e0: 723a 5c6e 7b61 6e73 7765 727d 5c6e 222c  r:\n{answer}\n",
-000030f0: 2027 6772 6565 6e27 2c20 6174 7472 733d   'green', attrs=
-00003100: 5b27 626f 6c64 275d 290d 0a20 2020 2020  ['bold'])..     
-00003110: 2020 2020 2020 2020 2020 2063 7072 696e             cprin
-00003120: 7428 6622 3e20 4920 6861 7665 2067 656e  t(f"> I have gen
-00003130: 6572 6174 6564 2074 6865 2066 6f6c 6c6f  erated the follo
-00003140: 7769 6e67 2063 6f64 653a 5c6e 7b63 6f64  wing code:\n{cod
-00003150: 657d 5c6e 222c 2027 6772 6565 6e27 2c20  e}\n", 'green', 
-00003160: 6174 7472 733d 5b27 626f 6c64 275d 290d  attrs=['bold']).
-00003170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003180: 2063 7072 696e 7428 6622 3e20 4669 6e61   cprint(f"> Fina
-00003190: 6c20 5468 6f75 6768 7473 3a5c 6e7b 7265  l Thoughts:\n{re
-000031a0: 666c 6563 7469 6f6e 7d5c 6e22 2c20 2767  flection}\n", 'g
-000031b0: 7265 656e 272c 2061 7474 7273 3d5b 2762  reen', attrs=['b
-000031c0: 6f6c 6427 5d29 0d0a 2020 2020 2020 2020  old'])..        
-000031d0: 2020 2020 2020 2020 6370 7269 6e74 2866          cprint(f
-000031e0: 223e 2054 6f74 616c 2074 6f6b 656e 7320  "> Total tokens 
-000031f0: 7573 6564 3a5c 6e7b 746f 7461 6c5f 746f  used:\n{total_to
-00003200: 6b65 6e73 5f75 7365 645f 7375 6d7d 5c6e  kens_used_sum}\n
-00003210: 222c 2027 7965 6c6c 6f77 272c 2061 7474  ", 'yellow', att
-00003220: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 2020  rs=['bold'])..  
-00003230: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00003240: 2320 4966 2061 2071 7565 7374 696f 6e20  # If a question 
-00003250: 6973 2070 726f 7669 6465 642c 2073 6b69  is provided, ski
-00003260: 7020 7468 6520 696e 7075 7420 7072 6f6d  p the input prom
-00003270: 7074 0d0a 2020 2020 2020 2020 6966 2071  pt..        if q
-00003280: 7565 7374 696f 6e20 6973 206e 6f74 204e  uestion is not N
-00003290: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-000032a0: 2020 2320 4361 6c6c 2074 6865 2074 6173    # Call the tas
-000032b0: 6b5f 6576 616c 206d 6574 686f 6420 7769  k_eval method wi
-000032c0: 7468 2074 6865 2075 7365 7227 7320 7175  th the user's qu
-000032d0: 6573 7469 6f6e 2069 6620 7468 6520 6578  estion if the ex
-000032e0: 706c 6f72 6174 6f72 7920 6d6f 6465 2069  ploratory mode i
-000032f0: 7320 5472 7565 0d0a 2020 2020 2020 2020  s True..        
-00003300: 2020 2020 6966 2073 656c 662e 6578 706c      if self.expl
-00003310: 6f72 6174 6f72 7920 6973 2054 7275 653a  oratory is True:
-00003320: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003330: 2020 7461 736b 203d 2073 656c 662e 7461    task = self.ta
-00003340: 736b 5f65 7661 6c28 7175 6573 7469 6f6e  sk_eval(question
-00003350: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00003360: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00003370: 2020 2020 2020 7461 736b 203d 2071 7565        task = que
-00003380: 7374 696f 6e0d 0a20 2020 2020 2020 2020  stion..         
-00003390: 2020 2023 2043 616c 6c20 7468 6520 7064     # Call the pd
-000033a0: 5f61 6765 6e74 206d 6574 686f 6420 7769  _agent method wi
-000033b0: 7468 2074 6865 2075 7365 7227 7320 7175  th the user's qu
-000033c0: 6573 7469 6f6e 2c20 7468 6520 6d65 7373  estion, the mess
-000033d0: 6167 6573 206c 6973 742c 2061 6e64 2074  ages list, and t
-000033e0: 6865 2064 6174 6166 7261 6d65 0d0a 2020  he dataframe..  
-000033f0: 2020 2020 2020 2020 2020 616e 7377 6572            answer
-00003400: 2c20 636f 6465 2c20 7265 666c 6563 7469  , code, reflecti
-00003410: 6f6e 2c20 666c 6f77 2c20 746f 7461 6c5f  on, flow, total_
-00003420: 746f 6b65 6e73 5f75 7365 645f 7375 6d20  tokens_used_sum 
-00003430: 3d20 7365 6c66 2e70 645f 6167 656e 7428  = self.pd_agent(
-00003440: 7461 736b 2c20 6d65 7373 6167 6573 2c20  task, messages, 
-00003450: 7365 6c66 2e64 6629 0d0a 2020 2020 2020  self.df)..      
-00003460: 2020 2020 2020 6469 7370 6c61 795f 7265        display_re
-00003470: 7375 6c74 7328 616e 7377 6572 2c20 636f  sults(answer, co
-00003480: 6465 2c20 7265 666c 6563 7469 6f6e 2c20  de, reflection, 
-00003490: 666c 6f77 2c20 746f 7461 6c5f 746f 6b65  flow, total_toke
-000034a0: 6e73 5f75 7365 645f 7375 6d29 0d0a 2020  ns_used_sum)..  
-000034b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000034c0: 0d0a 0d0a 2020 2020 2020 2020 2320 5374  ....        # St
-000034d0: 6172 7420 616e 2069 6e66 696e 6974 6520  art an infinite 
-000034e0: 6c6f 6f70 2074 6f20 6b65 6570 2061 736b  loop to keep ask
-000034f0: 696e 6720 7468 6520 7573 6572 2066 6f72  ing the user for
-00003500: 2071 7565 7374 696f 6e73 0d0a 2020 2020   questions..    
-00003510: 2020 2020 7768 696c 6520 5472 7565 3a0d      while True:.
-00003520: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-00003530: 726f 6d70 7420 7468 6520 7573 6572 2074  rompt the user t
-00003540: 6f20 656e 7465 7220 6120 7175 6573 7469  o enter a questi
-00003550: 6f6e 206f 7220 7479 7065 2027 6578 6974  on or type 'exit
-00003560: 2720 746f 2071 7569 740d 0a20 2020 2020  ' to quit..     
-00003570: 2020 2020 2020 2069 6620 2769 7079 6b65         if 'ipyke
-00003580: 726e 656c 2720 696e 2073 7973 2e6d 6f64  rnel' in sys.mod
-00003590: 756c 6573 3a0d 0a20 2020 2020 2020 2020  ules:..         
-000035a0: 2020 2020 2020 2064 6973 706c 6179 2848         display(H
-000035b0: 544d 4c28 273c 6220 7374 796c 653d 2263  TML('<b style="c
-000035c0: 6f6c 6f72 3a62 6c75 653b 223e 456e 7465  olor:blue;">Ente
-000035d0: 7220 796f 7572 2071 7565 7374 696f 6e20  r your question 
-000035e0: 6f72 2074 7970 6520 5c27 6578 6974 5c27  or type \'exit\'
-000035f0: 2074 6f20 7175 6974 3a3c 2f62 3e27 2929   to quit:</b>'))
-00003600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003610: 2020 7175 6573 7469 6f6e 203d 2069 6e70    question = inp
-00003620: 7574 2829 0d0a 2020 2020 2020 2020 2020  ut()..          
-00003630: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00003640: 2020 2020 2020 2020 2063 7072 696e 7428           cprint(
-00003650: 225c 6e45 6e74 6572 2079 6f75 7220 7175  "\nEnter your qu
-00003660: 6573 7469 6f6e 206f 7220 7479 7065 2027  estion or type '
-00003670: 6578 6974 2720 746f 2071 7569 743a 222c  exit' to quit:",
-00003680: 2027 626c 7565 272c 2061 7474 7273 3d5b   'blue', attrs=[
-00003690: 2762 6f6c 6427 5d29 0d0a 2020 2020 2020  'bold'])..      
-000036a0: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-000036b0: 6f6e 203d 2069 6e70 7574 2829 0d0a 0d0a  on = input()....
-000036c0: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-000036d0: 2074 6865 2075 7365 7220 7479 7065 7320   the user types 
-000036e0: 2765 7869 7427 2c20 6272 6561 6b20 6f75  'exit', break ou
-000036f0: 7420 6f66 2074 6865 206c 6f6f 700d 0a20  t of the loop.. 
-00003700: 2020 2020 2020 2020 2020 2069 6620 7175             if qu
-00003710: 6573 7469 6f6e 2e73 7472 6970 2829 2e6c  estion.strip().l
-00003720: 6f77 6572 2829 203d 3d20 2765 7869 7427  ower() == 'exit'
-00003730: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00003740: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
-00003750: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00003760: 2020 2020 2320 4361 6c6c 2074 6865 2074      # Call the t
-00003770: 6173 6b5f 6576 616c 206d 6574 686f 6420  ask_eval method 
-00003780: 7769 7468 2074 6865 2075 7365 7227 7320  with the user's 
-00003790: 7175 6573 7469 6f6e 2069 6620 7468 6520  question if the 
-000037a0: 6578 706c 6f72 6174 6f72 7920 6d6f 6465  exploratory mode
-000037b0: 2069 7320 5472 7565 0d0a 2020 2020 2020   is True..      
-000037c0: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-000037d0: 706c 6f72 6174 6f72 7920 6973 2054 7275  ploratory is Tru
-000037e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000037f0: 2020 2020 7461 736b 203d 2073 656c 662e      task = self.
-00003800: 7461 736b 5f65 7661 6c28 7175 6573 7469  task_eval(questi
-00003810: 6f6e 290d 0a20 2020 2020 2020 2020 2020  on)..           
-00003820: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00003830: 2020 2020 2020 2020 7461 736b 203d 2071          task = q
-00003840: 7565 7374 696f 6e0d 0a0d 0a20 2020 2020  uestion....     
-00003850: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
-00003860: 6520 7064 5f61 6765 6e74 206d 6574 686f  e pd_agent metho
-00003870: 6420 7769 7468 2074 6865 2075 7365 7227  d with the user'
-00003880: 7320 7175 6573 7469 6f6e 2c20 7468 6520  s question, the 
-00003890: 6d65 7373 6167 6573 206c 6973 742c 2061  messages list, a
-000038a0: 6e64 2074 6865 2064 6174 6166 7261 6d65  nd the dataframe
-000038b0: 0d0a 2020 2020 2020 2020 2020 2020 616e  ..            an
-000038c0: 7377 6572 2c20 636f 6465 2c20 7265 666c  swer, code, refl
-000038d0: 6563 7469 6f6e 2c20 666c 6f77 2c20 746f  ection, flow, to
-000038e0: 7461 6c5f 746f 6b65 6e73 5f75 7365 645f  tal_tokens_used_
-000038f0: 7375 6d20 3d20 7365 6c66 2e70 645f 6167  sum = self.pd_ag
-00003900: 656e 7428 7461 736b 2c20 6d65 7373 6167  ent(task, messag
-00003910: 6573 2c20 7365 6c66 2e64 6629 0d0a 2020  es, self.df)..  
-00003920: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-00003930: 795f 7265 7375 6c74 7328 616e 7377 6572  y_results(answer
-00003940: 2c20 636f 6465 2c20 7265 666c 6563 7469  , code, reflecti
-00003950: 6f6e 2c66 6c6f 772c 2074 6f74 616c 5f74  on,flow, total_t
-00003960: 6f6b 656e 735f 7573 6564 5f73 756d 290d  okens_used_sum).
-00003970: 0a0d 0a20 2020 2064 6566 2070 645f 6167  ...    def pd_ag
-00003980: 656e 7428 7365 6c66 2c20 7175 6573 7469  ent(self, questi
-00003990: 6f6e 2c20 6d65 7373 6167 6573 2c20 6466  on, messages, df
-000039a0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-000039b0: 2023 2041 6464 2061 2075 7365 7220 6d65   # Add a user me
-000039c0: 7373 6167 6520 7769 7468 2074 6865 2075  ssage with the u
-000039d0: 7064 6174 6564 2074 6173 6b20 7072 6f6d  pdated task prom
-000039e0: 7074 2074 6f20 7468 6520 6d65 7373 6167  pt to the messag
-000039f0: 6573 206c 6973 740d 0a20 2020 2020 2020  es list..       
-00003a00: 206d 6573 7361 6765 732e 6170 7065 6e64   messages.append
-00003a10: 287b 2272 6f6c 6522 3a20 2275 7365 7222  ({"role": "user"
-00003a20: 2c20 2263 6f6e 7465 6e74 223a 2073 656c  , "content": sel
-00003a30: 662e 7461 736b 2e66 6f72 6d61 7428 7365  f.task.format(se
-00003a40: 6c66 2e64 665f 6865 6164 2c20 7175 6573  lf.df_head, ques
-00003a50: 7469 6f6e 297d 290d 0a0d 0a20 2020 2020  tion)})....     
-00003a60: 2020 2069 6620 2769 7079 6b65 726e 656c     if 'ipykernel
-00003a70: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
-00003a80: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00003a90: 204a 7570 7974 6572 206e 6f74 6562 6f6f   Jupyter noteboo
-00003aa0: 6b20 6f72 2069 7079 7468 6f6e 0d0a 2020  k or ipython..  
-00003ab0: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-00003ac0: 7928 4854 4d4c 2866 273c 7020 7374 796c  y(HTML(f'<p styl
-00003ad0: 653d 2263 6f6c 6f72 3a6d 6167 656e 7461  e="color:magenta
-00003ae0: 3b22 3e5c 6e55 7369 6e67 204d 6f64 656c  ;">\nUsing Model
-00003af0: 3a20 7b73 656c 662e 6c6c 6d7d 3c2f 703e  : {self.llm}</p>
-00003b00: 2729 290d 0a20 2020 2020 2020 2020 2020  '))..           
-00003b10: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
-00003b20: 3c70 3e3c 6220 7374 796c 653d 2263 6f6c  <p><b style="col
-00003b30: 6f72 3a6d 6167 656e 7461 3b22 3e50 726f  or:magenta;">Pro
-00003b40: 6365 7373 696e 6720 796f 7572 2072 6571  cessing your req
-00003b50: 7565 7374 2c20 706c 6561 7365 2077 6169  uest, please wai
-00003b60: 742e 2e2e 3c2f 623e 3c2f 703e 3c62 723e  t...</b></p><br>
-00003b70: 2729 290d 0a20 2020 2020 2020 2065 6c73  '))..        els
-00003b80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00003b90: 2320 4f74 6865 7220 656e 7669 726f 6e6d  # Other environm
-00003ba0: 656e 7420 286c 696b 6520 7465 726d 696e  ent (like termin
-00003bb0: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
-00003bc0: 2070 7269 6e74 2863 6f6c 6f72 6564 2866   print(colored(f
-00003bd0: 225c 6e3e 2055 7369 6e67 204d 6f64 656c  "\n> Using Model
-00003be0: 3a20 7b73 656c 662e 6c6c 6d7d 222c 2022  : {self.llm}", "
-00003bf0: 6d61 6765 6e74 6122 2929 0d0a 2020 2020  magenta"))..    
-00003c00: 2020 2020 2020 2020 6370 7269 6e74 2866          cprint(f
-00003c10: 225c 6e3e 2050 726f 6365 7373 696e 6720  "\n> Processing 
-00003c20: 796f 7572 2072 6571 7565 7374 2c20 706c  your request, pl
-00003c30: 6561 7365 2077 6169 742e 2e2e 5c6e 222c  ease wait...\n",
-00003c40: 2027 6d61 6765 6e74 6127 2c20 6174 7472   'magenta', attr
-00003c50: 733d 5b27 626f 6c64 275d 290d 0a0d 0a20  s=['bold']).... 
-00003c60: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
-00003c70: 6520 4f70 656e 4149 2041 5049 2061 6e64  e OpenAI API and
-00003c80: 2068 616e 646c 6520 7261 7465 206c 696d   handle rate lim
-00003c90: 6974 2065 7272 6f72 730d 0a20 2020 2020  it errors..     
-00003ca0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00003cb0: 2020 2020 206c 6c6d 5f72 6573 706f 6e73       llm_respons
-00003cc0: 652c 2074 6f6b 656e 735f 7573 6564 203d  e, tokens_used =
-00003cd0: 2073 656c 662e 6c6c 6d5f 6361 6c6c 286d   self.llm_call(m
-00003ce0: 6573 7361 6765 7329 0d0a 2020 2020 2020  essages)..      
-00003cf0: 2020 6578 6365 7074 206f 7065 6e61 692e    except openai.
-00003d00: 6572 726f 722e 5261 7465 4c69 6d69 7445  error.RateLimitE
-00003d10: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00003d20: 2020 2070 7269 6e74 280d 0a20 2020 2020     print(..     
-00003d30: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
-00003d40: 4f70 656e 4149 2041 5049 2072 6174 6520  OpenAI API rate 
-00003d50: 6c69 6d69 7420 6861 7320 6265 656e 2065  limit has been e
-00003d60: 7863 6565 6465 642e 2057 6169 7469 6e67  xceeded. Waiting
-00003d70: 2031 3020 7365 636f 6e64 7320 616e 6420   10 seconds and 
-00003d80: 7472 7969 6e67 2061 6761 696e 2e22 0d0a  trying again."..
-00003d90: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00003da0: 2020 2020 2020 2020 2020 2074 696d 652e             time.
-00003db0: 736c 6565 7028 3130 290d 0a20 2020 2020  sleep(10)..     
-00003dc0: 2020 2020 2020 206c 6c6d 5f72 6573 706f         llm_respo
-00003dd0: 6e73 652c 2074 6f6b 656e 735f 7573 6564  nse, tokens_used
-00003de0: 203d 2073 656c 662e 6c6c 6d5f 6361 6c6c   = self.llm_call
-00003df0: 286d 6573 7361 6765 7329 0d0a 0d0a 2020  (messages)....  
-00003e00: 2020 2020 2020 2320 4578 7472 6163 7420        # Extract 
-00003e10: 7468 6520 636f 6465 2066 726f 6d20 7468  the code from th
-00003e20: 6520 4150 4920 7265 7370 6f6e 7365 0d0a  e API response..
-00003e30: 2020 2020 2020 2020 636f 6465 2c72 6566          code,ref
-00003e40: 6c65 6374 696f 6e2c 666c 6f77 203d 2073  lection,flow = s
-00003e50: 656c 662e 5f65 7874 7261 6374 5f63 6f64  elf._extract_cod
-00003e60: 6528 6c6c 6d5f 7265 7370 6f6e 7365 290d  e(llm_response).
-00003e70: 0a0d 0a20 2020 2020 2020 2023 2055 7064  ...        # Upd
-00003e80: 6174 6520 7468 6520 746f 7461 6c20 746f  ate the total to
-00003e90: 6b65 6e73 2075 7365 640d 0a20 2020 2020  kens used..     
-00003ea0: 2020 2073 656c 662e 746f 7461 6c5f 746f     self.total_to
-00003eb0: 6b65 6e73 5f75 7365 642e 6170 7065 6e64  kens_used.append
-00003ec0: 2874 6f6b 656e 735f 7573 6564 290d 0a20  (tokens_used).. 
-00003ed0: 2020 2020 2020 2074 6f74 616c 5f74 6f6b         total_tok
-00003ee0: 656e 735f 7573 6564 5f73 756d 203d 2073  ens_used_sum = s
-00003ef0: 756d 2873 656c 662e 746f 7461 6c5f 746f  um(self.total_to
-00003f00: 6b65 6e73 5f75 7365 6429 0d0a 0d0a 2020  kens_used)....  
-00003f10: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
-00003f20: 7a65 2065 7272 6f72 2063 6f72 7265 6374  ze error correct
-00003f30: 696f 6e20 636f 756e 7465 720d 0a20 2020  ion counter..   
-00003f40: 2020 2020 2065 7272 6f72 5f63 6f72 7265       error_corre
-00003f50: 6374 696f 6e73 203d 2030 0d0a 0d0a 2020  ctions = 0....  
-00003f60: 2020 2020 2020 2320 5374 6f72 6520 7468        # Store th
-00003f70: 6520 6f72 6967 696e 616c 206c 6c6d 2076  e original llm v
-00003f80: 616c 7565 0d0a 2020 2020 2020 2020 6f72  alue..        or
-00003f90: 6967 696e 616c 5f6c 6c6d 203d 2073 656c  iginal_llm = sel
-00003fa0: 662e 6c6c 6d0d 0a0d 0a20 2020 2020 2020  f.llm....       
-00003fb0: 2023 2052 6564 6972 6563 7420 7374 616e   # Redirect stan
-00003fc0: 6461 7264 206f 7574 7075 7420 746f 2061  dard output to a
-00003fd0: 2053 7472 696e 6749 4f20 6275 6666 6572   StringIO buffer
-00003fe0: 0d0a 2020 2020 2020 2020 7769 7468 2072  ..        with r
-00003ff0: 6564 6972 6563 745f 7374 646f 7574 2869  edirect_stdout(i
-00004000: 6f2e 5374 7269 6e67 494f 2829 2920 6173  o.StringIO()) as
-00004010: 206f 7574 7075 743a 0d0a 2020 2020 2020   output:..      
-00004020: 2020 2020 2020 2320 5472 7920 746f 2065        # Try to e
-00004030: 7865 6375 7465 2074 6865 2063 6f64 6520  xecute the code 
-00004040: 616e 6420 6861 6e64 6c65 2065 7272 6f72  and handle error
-00004050: 730d 0a20 2020 2020 2020 2020 2020 2077  s..            w
-00004060: 6869 6c65 2065 7272 6f72 5f63 6f72 7265  hile error_corre
-00004070: 6374 696f 6e73 203c 2073 656c 662e 4d41  ctions < self.MA
-00004080: 585f 4552 524f 525f 434f 5252 4543 5449  X_ERROR_CORRECTI
-00004090: 4f4e 533a 0d0a 2020 2020 2020 2020 2020  ONS:..          
-000040a0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-000040b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000040c0: 6d65 7373 6167 6573 2e61 7070 656e 6428  messages.append(
-000040d0: 7b22 726f 6c65 223a 2022 6173 7369 7374  {"role": "assist
-000040e0: 616e 7422 2c20 2263 6f6e 7465 6e74 223a  ant", "content":
-000040f0: 206c 6c6d 5f72 6573 706f 6e73 657d 290d   llm_response}).
-00004100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004110: 2020 2020 2023 2052 656d 6f76 6520 7468       # Remove th
-00004120: 6520 6f6c 6465 7374 2063 6f6e 7665 7273  e oldest convers
-00004130: 6174 696f 6e20 6672 6f6d 2074 6865 206d  ation from the m
-00004140: 6573 7361 6765 7320 6c69 7374 0d0a 2020  essages list..  
-00004150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004160: 2020 6966 206c 656e 286d 6573 7361 6765    if len(message
-00004170: 7329 203e 2073 656c 662e 4d41 585f 434f  s) > self.MAX_CO
-00004180: 4e56 4552 5341 5449 4f4e 533a 0d0a 2020  NVERSATIONS:..  
-00004190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041a0: 2020 2020 2020 6d65 7373 6167 6573 2e70        messages.p
-000041b0: 6f70 2831 290d 0a20 2020 2020 2020 2020  op(1)..         
-000041c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000041d0: 6573 7361 6765 732e 706f 7028 3129 0d0a  essages.pop(1)..
-000041e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041f0: 2020 2020 2320 5265 7365 7420 6466 2074      # Reset df t
-00004200: 6f20 7468 6520 6f72 6967 696e 616c 2073  o the original s
-00004210: 7461 7465 2062 6566 6f72 6520 6578 6563  tate before exec
-00004220: 7574 696e 6720 7468 6520 636f 6465 0d0a  uting the code..
-00004230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004240: 2020 2020 7365 6c66 2e64 6620 3d20 7365      self.df = se
-00004250: 6c66 2e6f 7269 6769 6e61 6c5f 6466 2e63  lf.original_df.c
-00004260: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
-00004270: 2020 2020 2020 2020 2020 2023 2045 7865             # Exe
-00004280: 6375 7465 2074 6865 2063 6f64 650d 0a20  cute the code.. 
-00004290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042a0: 2020 2069 6620 636f 6465 2069 7320 6e6f     if code is no
-000042b0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-000042c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042d0: 2065 7865 6328 636f 6465 290d 0a20 2020   exec(code)..   
-000042e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042f0: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
-00004300: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00004310: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
-00004320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004330: 2020 2020 2320 5072 696e 7420 7468 6520      # Print the 
-00004340: 6572 726f 7220 6d65 7373 6167 650d 0a20  error message.. 
-00004350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004360: 2020 2069 6620 2769 7079 6b65 726e 656c     if 'ipykernel
-00004370: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
-00004380: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004390: 2020 2020 2020 2020 2020 2023 204a 7570             # Jup
-000043a0: 7974 6572 206e 6f74 6562 6f6f 6b0d 0a20  yter notebook.. 
-000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043c0: 2020 2020 2020 2064 6973 706c 6179 2848         display(H
-000043d0: 544d 4c28 6627 3c62 723e 3c62 3e3c 7370  TML(f'<br><b><sp
-000043e0: 616e 2073 7479 6c65 3d22 636f 6c6f 723a  an style="color:
-000043f0: 2023 6438 3663 3030 3b22 3e49 2072 616e   #d86c00;">I ran
-00004400: 2069 6e74 6f20 616e 2069 7373 7565 3a3c   into an issue:<
-00004410: 2f73 7061 6e3e 3c2f 623e 3c62 723e 3c70  /span></b><br><p
-00004420: 7265 2073 7479 6c65 3d22 636f 6c6f 723a  re style="color:
-00004430: 2023 6438 3663 3030 3b22 3e7b 657d 3c2f   #d86c00;">{e}</
-00004440: 7072 653e 3c62 723e 3c62 3e3c 7370 616e  pre><br><b><span
-00004450: 2073 7479 6c65 3d22 636f 6c6f 723a 2023   style="color: #
-00004460: 6438 3663 3030 3b22 3e49 2077 696c 6c20  d86c00;">I will 
-00004470: 6578 616d 696e 6520 6974 2c20 616e 6420  examine it, and 
-00004480: 7472 7920 6167 6169 6e20 7769 7468 2061  try again with a
-00004490: 6e20 6164 6a75 7374 6564 2063 6f64 652e  n adjusted code.
-000044a0: 3c2f 7370 616e 3e3c 2f62 3e3c 6272 3e27  </span></b><br>'
-000044b0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-000044c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000044d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044e0: 2020 2020 2020 2023 2043 4c49 0d0a 2020         # CLI..  
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2020 2020 2020 2370 7269 6e74 2863 6f6c        #print(col
-00004510: 6f72 6564 2866 2749 2072 616e 2069 6e74  ored(f'I ran int
-00004520: 6f20 616e 2069 7373 7565 3a20 7b65 7d2e  o an issue: {e}.
-00004530: 203e 2049 2077 696c 6c20 6578 616d 696e   > I will examin
-00004540: 6520 6974 2c20 616e 6420 7472 7920 6167  e it, and try ag
-00004550: 6169 6e20 7769 7468 2061 6e20 6164 6a75  ain with an adju
-00004560: 7374 6564 2063 6f64 652e 272c 2027 7265  sted code.', 're
-00004570: 6427 2929 0d0a 2020 2020 2020 2020 2020  d'))..          
-00004580: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00004590: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
-000045a0: 5c30 3333 5b33 316d 2720 2b20 6627 3e20  \033[31m' + f'> 
-000045b0: 4920 7261 6e20 696e 746f 2061 6e20 6973  I ran into an is
-000045c0: 7375 653a 207b 657d 2e20 5c6e 3e20 4920  sue: {e}. \n> I 
-000045d0: 7769 6c6c 2065 7861 6d69 6e65 2069 742c  will examine it,
-000045e0: 2061 6e64 2074 7279 2061 6761 696e 2077   and try again w
-000045f0: 6974 6820 616e 2061 646a 7573 7465 6420  ith an adjusted 
-00004600: 636f 6465 2e27 202b 2027 5c30 3333 5b30  code.' + '\033[0
-00004610: 6d27 202b 2027 5c6e 2729 0d0a 2020 2020  m' + '\n')..    
-00004620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004630: 2020 2020 7379 732e 7374 6465 7272 2e66      sys.stderr.f
-00004640: 6c75 7368 2829 0d0a 0d0a 2020 2020 2020  lush()....      
-00004650: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00004660: 496e 6372 656d 656e 7420 7468 6520 6572  Increment the er
-00004670: 726f 7220 636f 7272 6563 7469 6f6e 2063  ror correction c
-00004680: 6f75 6e74 6572 2061 6e64 2075 7064 6174  ounter and updat
-00004690: 6520 7468 6520 6d65 7373 6167 6573 206c  e the messages l
-000046a0: 6973 7420 7769 7468 2074 6865 2065 7272  ist with the err
-000046b0: 6f72 0d0a 2020 2020 2020 2020 2020 2020  or..            
-000046c0: 2020 2020 2020 2020 6572 726f 725f 636f          error_co
-000046d0: 7272 6563 7469 6f6e 7320 2b3d 2031 0d0a  rrections += 1..
+00001820: 6420 3c2f 636f 6465 3e20 696e 2074 6865  d </code> in the
+00001830: 2065 7874 7261 6374 6564 2063 6f64 650d   extracted code.
+00001840: 0a20 2020 2020 2020 206d 6174 6368 203d  .        match =
+00001850: 2072 652e 7365 6172 6368 2872 223c 636f   re.search(r"<co
+00001860: 6465 3e28 2e2a 293c 2f63 6f64 653e 222c  de>(.*)</code>",
+00001870: 2072 6573 706f 6e73 652c 2072 652e 444f   response, re.DO
+00001880: 5441 4c4c 290d 0a20 2020 2020 2020 2069  TALL)..        i
+00001890: 6620 6d61 7463 683a 0d0a 2020 2020 2020  f match:..      
+000018a0: 2020 2020 2020 2320 4966 2061 206d 6174        # If a mat
+000018b0: 6368 2069 7320 666f 756e 642c 2065 7874  ch is found, ext
+000018c0: 7261 6374 2074 6865 2063 6f64 6520 6265  ract the code be
+000018d0: 7477 6565 6e20 3c63 6f64 653e 2061 6e64  tween <code> and
+000018e0: 203c 2f63 6f64 653e 0d0a 2020 2020 2020   </code>..      
+000018f0: 2020 2020 2020 636f 6465 203d 206d 6174        code = mat
+00001900: 6368 2e67 726f 7570 2831 290d 0a20 2020  ch.group(1)..   
+00001910: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
+00001920: 6520 7265 7370 6f6e 7365 2063 6f6e 7461  e response conta
+00001930: 696e 7320 7468 6520 7365 7061 7261 746f  ins the separato
+00001940: 722c 2065 7874 7261 6374 2074 6865 2063  r, extract the c
+00001950: 6f64 6520 626c 6f63 6b20 6265 7477 6565  ode block betwee
+00001960: 6e20 7468 6520 7365 7061 7261 746f 7273  n the separators
+00001970: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00001980: 206c 656e 2863 6f64 652e 7370 6c69 7428   len(code.split(
+00001990: 7365 7061 7261 746f 7229 2920 3e20 313a  separator)) > 1:
+000019a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000019b0: 2020 636f 6465 203d 2063 6f64 652e 7370    code = code.sp
+000019c0: 6c69 7428 7365 7061 7261 746f 7229 5b31  lit(separator)[1
+000019d0: 5d0d 0a0d 0a20 2020 2020 2020 2023 2049  ]....        # I
+000019e0: 6620 7468 6520 7265 7370 6f6e 7365 2063  f the response c
+000019f0: 6f6e 7461 696e 7320 7468 6520 7365 7061  ontains the sepa
+00001a00: 7261 746f 722c 2065 7874 7261 6374 2074  rator, extract t
+00001a10: 6865 2063 6f64 6520 626c 6f63 6b20 6265  he code block be
+00001a20: 7477 6565 6e20 7468 6520 7365 7061 7261  tween the separa
+00001a30: 746f 7273 0d0a 2020 2020 2020 2020 6966  tors..        if
+00001a40: 206c 656e 2872 6573 706f 6e73 652e 7370   len(response.sp
+00001a50: 6c69 7428 7365 7061 7261 746f 7229 2920  lit(separator)) 
+00001a60: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
+00001a70: 2020 636f 6465 203d 2072 6573 706f 6e73    code = respons
+00001a80: 652e 7370 6c69 7428 7365 7061 7261 746f  e.split(separato
+00001a90: 7229 5b31 5d0d 0a20 2020 2020 2020 2020  r)[1]..         
+00001aa0: 2020 200d 0a20 2020 2020 2020 2023 2052     ..        # R
+00001ab0: 656d 6f76 6520 7468 6520 2270 7974 686f  emove the "pytho
+00001ac0: 6e22 206f 7220 2270 7922 2070 7265 6669  n" or "py" prefi
+00001ad0: 7820 6966 2070 7265 7365 6e74 0d0a 2020  x if present..  
+00001ae0: 2020 2020 2020 6966 2072 652e 6d61 7463        if re.matc
+00001af0: 6828 7222 5e28 7079 7468 6f6e 7c70 7929  h(r"^(python|py)
+00001b00: 222c 2063 6f64 6529 3a0d 0a20 2020 2020  ", code):..     
+00001b10: 2020 2020 2020 2063 6f64 6520 3d20 7265         code = re
+00001b20: 2e73 7562 2872 225e 2870 7974 686f 6e7c  .sub(r"^(python|
+00001b30: 7079 2922 2c20 2222 2c20 636f 6465 290d  py)", "", code).
+00001b40: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
+00001b50: 6520 636f 6465 2069 7320 6265 7477 6565  e code is betwee
+00001b60: 6e20 7369 6e67 6c65 2062 6163 6b74 6963  n single backtic
+00001b70: 6b73 2c20 6578 7472 6163 7420 7468 6520  ks, extract the 
+00001b80: 636f 6465 2062 6574 7765 656e 2074 6865  code between the
+00001b90: 6d0d 0a20 2020 2020 2020 2069 6620 7265  m..        if re
+00001ba0: 2e6d 6174 6368 2872 225e 602e 2a60 2422  .match(r"^`.*`$"
+00001bb0: 2c20 636f 6465 293a 0d0a 2020 2020 2020  , code):..      
+00001bc0: 2020 2020 2020 636f 6465 203d 2072 652e        code = re.
+00001bd0: 7375 6228 7222 5e60 282e 2a29 6024 222c  sub(r"^`(.*)`$",
+00001be0: 2072 225c 3122 2c20 636f 6465 290d 0a0d   r"\1", code)...
+00001bf0: 0a20 2020 2020 2020 2023 2052 656d 6f76  .        # Remov
+00001c00: 6520 616e 7920 696e 7374 616e 6365 7320  e any instances 
+00001c10: 6f66 2022 6466 203d 2070 642e 7265 6164  of "df = pd.read
+00001c20: 5f63 7376 2827 6669 6c65 6e61 6d65 2e63  _csv('filename.c
+00001c30: 7376 2729 2220 6672 6f6d 2074 6865 2063  sv')" from the c
+00001c40: 6f64 650d 0a20 2020 2020 2020 2063 6f64  ode..        cod
+00001c50: 6520 3d20 7265 2e73 7562 2872 2264 665c  e = re.sub(r"df\
+00001c60: 732a 3d5c 732a 7064 5c2e 7265 6164 5f63  s*=\s*pd\.read_c
+00001c70: 7376 5c28 272e 2a3f 2728 2c2e 2a29 3f5c  sv\('.*?'(,.*)?\
+00001c80: 2922 2c20 2222 2c20 636f 6465 290d 0a0d  )", "", code)...
+00001c90: 0a20 2020 2020 2020 2023 2052 656d 6f76  .        # Remov
+00001ca0: 6520 616e 7920 6f63 6375 7272 656e 6365  e any occurrence
+00001cb0: 7320 6f66 2064 6620 3d20 7064 2e44 6174  s of df = pd.Dat
+00001cc0: 6146 7261 6d65 2829 2077 6974 6820 616e  aFrame() with an
+00001cd0: 7920 6e75 6d62 6572 206f 6620 6368 6172  y number of char
+00001ce0: 6163 7465 7273 2069 6e73 6964 6520 7468  acters inside th
+00001cf0: 6520 7061 7265 6e74 6865 7365 732e 0d0a  e parentheses...
+00001d00: 2020 2020 2020 2020 636f 6465 203d 2072          code = r
+00001d10: 652e 7375 6228 7222 6466 5c73 2a3d 5c73  e.sub(r"df\s*=\s
+00001d20: 2a70 645c 2e44 6174 6146 7261 6d65 5c28  *pd\.DataFrame\(
+00001d30: 2e2a 3f5c 2922 2c20 2222 2c20 636f 6465  .*?\)", "", code
+00001d40: 2c20 666c 6167 733d 7265 2e44 4f54 414c  , flags=re.DOTAL
+00001d50: 4c29 0d0a 0d0a 2020 2020 2020 2020 2320  L)....        # 
+00001d60: 4465 6669 6e65 2074 6865 2072 6567 756c  Define the regul
+00001d70: 6172 2065 7870 7265 7373 696f 6e20 7061  ar expression pa
+00001d80: 7474 6572 6e20 746f 206d 6174 6368 2074  ttern to match t
+00001d90: 6865 2062 6c61 636b 6c69 7374 2069 7465  he blacklist ite
+00001da0: 6d73 0d0a 2020 2020 2020 2020 7061 7474  ms..        patt
+00001db0: 6572 6e20 3d20 7222 5e28 2e2a 5c62 2822  ern = r"^(.*\b("
+00001dc0: 202b 2022 7c22 2e6a 6f69 6e28 626c 6163   + "|".join(blac
+00001dd0: 6b6c 6973 7429 202b 2072 2229 5c62 2e2a  klist) + r")\b.*
+00001de0: 2924 220d 0a0d 0a20 2020 2020 2020 2023  )$"....        #
+00001df0: 2052 6570 6c61 6365 2074 6865 2062 6c61   Replace the bla
+00001e00: 636b 6c69 7374 2069 7465 6d73 2077 6974  cklist items wit
+00001e10: 6820 636f 6d6d 656e 7473 0d0a 2020 2020  h comments..    
+00001e20: 2020 2020 636f 6465 203d 2072 652e 7375      code = re.su
+00001e30: 6228 7061 7474 6572 6e2c 2072 2223 206e  b(pattern, r"# n
+00001e40: 6f74 2061 6c6c 6f77 6564 205c 3122 2c20  ot allowed \1", 
+00001e50: 636f 6465 2c20 666c 6167 733d 7265 2e4d  code, flags=re.M
+00001e60: 554c 5449 4c49 4e45 290d 0a0d 0a20 2020  ULTILINE)....   
+00001e70: 2020 2020 2023 2052 6574 7572 6e20 7468       # Return th
+00001e80: 6520 636c 6561 6e65 6420 616e 6420 6578  e cleaned and ex
+00001e90: 7472 6163 7465 6420 636f 6465 0d0a 2020  tracted code..  
+00001ea0: 2020 2020 2020 7265 7475 726e 2063 6f64        return cod
+00001eb0: 652e 7374 7269 7028 292c 2072 6566 6c65  e.strip(), refle
+00001ec0: 6374 696f 6e2e 7374 7269 7028 292c 2066  ction.strip(), f
+00001ed0: 6c6f 772e 7374 7269 7028 290d 0a20 2020  low.strip()..   
+00001ee0: 200d 0a20 2020 2064 6566 2074 6173 6b5f   ..    def task_
+00001ef0: 6576 616c 2873 656c 662c 2071 7565 7374  eval(self, quest
+00001f00: 696f 6e3d 4e6f 6e65 293a 0d0a 2020 2020  ion=None):..    
+00001f10: 2020 2020 2320 496e 6974 6961 6c69 7a65      # Initialize
+00001f20: 2074 6865 206d 6573 7361 6765 7320 6c69   the messages li
+00001f30: 7374 2077 6974 6820 6120 7379 7374 656d  st with a system
+00001f40: 206d 6573 7361 6765 2063 6f6e 7461 696e   message contain
+00001f50: 696e 6720 7468 6520 7461 736b 2070 726f  ing the task pro
+00001f60: 6d70 740d 0a20 2020 2020 2020 2065 7661  mpt..        eva
+00001f70: 6c5f 6d65 7373 6167 6573 203d 205b 7b22  l_messages = [{"
+00001f80: 726f 6c65 223a 2022 7379 7374 656d 222c  role": "system",
+00001f90: 2022 636f 6e74 656e 7422 3a20 7365 6c66   "content": self
+00001fa0: 2e74 6173 6b5f 6576 616c 7561 7469 6f6e  .task_evaluation
+00001fb0: 2e66 6f72 6d61 7428 7175 6573 7469 6f6e  .format(question
+00001fc0: 2c20 7365 6c66 2e64 665f 6865 6164 2c29  , self.df_head,)
+00001fd0: 7d5d 0d0a 0d0a 2020 2020 2020 2020 6966  }]....        if
+00001fe0: 2027 6970 796b 6572 6e65 6c27 2069 6e20   'ipykernel' in 
+00001ff0: 7379 732e 6d6f 6475 6c65 733a 0d0a 2020  sys.modules:..  
+00002000: 2020 2020 2020 2020 2020 2320 4a75 7079            # Jupy
+00002010: 7465 7220 6e6f 7465 626f 6f6b 206f 7220  ter notebook or 
+00002020: 6970 7974 686f 6e0d 0a20 2020 2020 2020  ipython..       
+00002030: 2020 2020 2064 6973 706c 6179 2848 544d       display(HTM
+00002040: 4c28 6627 3c70 2073 7479 6c65 3d22 636f  L(f'<p style="co
+00002050: 6c6f 723a 6d61 6765 6e74 613b 223e 5c6e  lor:magenta;">\n
+00002060: 5573 696e 6720 4d6f 6465 6c3a 207b 7365  Using Model: {se
+00002070: 6c66 2e6c 6c6d 7d3c 2f70 3e27 2929 0d0a  lf.llm}</p>'))..
+00002080: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+00002090: 6c61 7928 4854 4d4c 2866 273c 703e 3c62  lay(HTML(f'<p><b
+000020a0: 2073 7479 6c65 3d22 636f 6c6f 723a 6d61   style="color:ma
+000020b0: 6765 6e74 613b 223e 5472 7969 6e67 2074  genta;">Trying t
+000020c0: 6f20 6465 7465 726d 696e 6520 7468 6520  o determine the 
+000020d0: 6265 7374 206d 6574 686f 6420 746f 2061  best method to a
+000020e0: 6e61 6c79 7365 2079 6f75 7220 6461 7461  nalyse your data
+000020f0: 2c20 706c 6561 7365 2077 6169 742e 2e2e  , please wait...
+00002100: 3c2f 623e 3c2f 703e 3c62 723e 2729 290d  </b></p><br>')).
+00002110: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00002120: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
+00002130: 6865 7220 656e 7669 726f 6e6d 656e 7420  her environment 
+00002140: 286c 696b 6520 7465 726d 696e 616c 290d  (like terminal).
+00002150: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00002160: 6e74 2863 6f6c 6f72 6564 2866 225c 6e3e  nt(colored(f"\n>
+00002170: 2055 7369 6e67 204d 6f64 656c 3a20 7b73   Using Model: {s
+00002180: 656c 662e 6c6c 6d7d 222c 2022 6d61 6765  elf.llm}", "mage
+00002190: 6e74 6122 2929 0d0a 2020 2020 2020 2020  nta"))..        
+000021a0: 2020 2020 6370 7269 6e74 2866 225c 6e3e      cprint(f"\n>
+000021b0: 2054 7279 696e 6720 746f 2064 6574 6572   Trying to deter
+000021c0: 6d69 6e65 2074 6865 2062 6573 7420 6d65  mine the best me
+000021d0: 7468 6f64 2074 6f20 616e 616c 7973 6520  thod to analyse 
+000021e0: 796f 7572 2064 6174 612c 2070 6c65 6173  your data, pleas
+000021f0: 6520 7761 6974 2e2e 2e5c 6e22 2c20 276d  e wait...\n", 'm
+00002200: 6167 656e 7461 272c 2061 7474 7273 3d5b  agenta', attrs=[
+00002210: 2762 6f6c 6427 5d29 0d0a 0d0a 2020 2020  'bold'])....    
+00002220: 2020 2020 2320 4675 6e63 7469 6f6e 2074      # Function t
+00002230: 6f20 6469 7370 6c61 7920 7265 7375 6c74  o display result
+00002240: 7320 6e69 6365 6c79 0d0a 2020 2020 2020  s nicely..      
+00002250: 2020 6465 6620 6469 7370 6c61 795f 7461    def display_ta
+00002260: 736b 2874 6173 6b29 3a0d 0a20 2020 2020  sk(task):..     
+00002270: 2020 2020 2020 2069 6620 2769 7079 6b65         if 'ipyke
+00002280: 726e 656c 2720 696e 2073 7973 2e6d 6f64  rnel' in sys.mod
+00002290: 756c 6573 3a0d 0a20 2020 2020 2020 2020  ules:..         
+000022a0: 2020 2020 2020 2023 204a 7570 7974 6572         # Jupyter
+000022b0: 206e 6f74 6562 6f6f 6b20 6f72 2069 7079   notebook or ipy
+000022c0: 7468 6f6e 0d0a 2020 2020 2020 2020 2020  thon..          
+000022d0: 2020 2020 2020 6469 7370 6c61 7928 4854        display(HT
+000022e0: 4d4c 2866 273c 703e 3c62 2073 7479 6c65  ML(f'<p><b style
+000022f0: 3d22 636f 6c6f 723a 626c 7565 3b22 3e49  ="color:blue;">I
+00002300: 2068 6176 6520 6372 6561 7465 6420 7468   have created th
+00002310: 6520 666f 6c6c 6f77 696e 6720 7461 736b  e following task
+00002320: 206c 6973 742c 2061 6e64 2077 696c 6c20   list, and will 
+00002330: 6e6f 7720 7472 7920 746f 2065 7870 7265  now try to expre
+00002340: 7373 2069 7420 696e 2063 6f64 653a 3c2f  ss it in code:</
+00002350: 623e 3c62 723e 3c70 7265 2073 7479 6c65  b><br><pre style
+00002360: 3d22 636f 6c6f 723a 626c 6163 6b3b 223e  ="color:black;">
+00002370: 3c62 3e7b 7461 736b 7d3c 2f62 3e3c 2f70  <b>{task}</b></p
+00002380: 7265 3e3c 2f70 3e3c 6272 3e27 2929 0d0a  re></p><br>'))..
+00002390: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000023a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000023b0: 2020 2023 204f 7468 6572 2065 6e76 6972     # Other envir
+000023c0: 6f6e 6d65 6e74 2028 6c69 6b65 2074 6572  onment (like ter
+000023d0: 6d69 6e61 6c29 0d0a 2020 2020 2020 2020  minal)..        
+000023e0: 2020 2020 2020 2020 6370 7269 6e74 2866          cprint(f
+000023f0: 225c 6e54 6173 6b3a 5c6e 7b74 6173 6b7d  "\nTask:\n{task}
+00002400: 5c6e 222c 2027 6d61 6765 6e74 6127 2c20  \n", 'magenta', 
+00002410: 6174 7472 733d 5b27 626f 6c64 275d 290d  attrs=['bold']).
+00002420: 0a0d 0a20 2020 2020 2020 2023 2043 616c  ...        # Cal
+00002430: 6c20 7468 6520 4f70 656e 4149 2041 5049  l the OpenAI API
+00002440: 2061 6e64 2068 616e 646c 6520 7261 7465   and handle rate
+00002450: 206c 696d 6974 2065 7272 6f72 730d 0a20   limit errors.. 
+00002460: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+00002470: 2020 2020 2020 2020 206c 6c6d 5f72 6573           llm_res
+00002480: 706f 6e73 652c 2074 6f6b 656e 735f 7573  ponse, tokens_us
+00002490: 6564 203d 2073 656c 662e 6c6c 6d5f 6361  ed = self.llm_ca
+000024a0: 6c6c 2865 7661 6c5f 6d65 7373 6167 6573  ll(eval_messages
+000024b0: 2c74 656d 7065 7261 7475 7265 3d30 2920  ,temperature=0) 
+000024c0: 2320 6869 6768 6572 2074 656d 7065 7261  # higher tempera
+000024d0: 7475 7265 2072 6573 756c 7473 2069 6e20  ture results in 
+000024e0: 6d6f 7265 2022 6372 6561 7469 7665 2220  more "creative" 
+000024f0: 616e 7377 6572 7320 2873 6f6d 6574 696d  answers (sometim
+00002500: 6573 2074 6f6f 2063 7265 6174 6976 6520  es too creative 
+00002510: 3a2d 2929 0d0a 2020 2020 2020 2020 6578  :-))..        ex
+00002520: 6365 7074 206f 7065 6e61 692e 6572 726f  cept openai.erro
+00002530: 722e 5261 7465 4c69 6d69 7445 7272 6f72  r.RateLimitError
+00002540: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+00002550: 7269 6e74 280d 0a20 2020 2020 2020 2020  rint(..         
+00002560: 2020 2020 2020 2022 5468 6520 4f70 656e         "The Open
+00002570: 4149 2041 5049 2072 6174 6520 6c69 6d69  AI API rate limi
+00002580: 7420 6861 7320 6265 656e 2065 7863 6565  t has been excee
+00002590: 6465 642e 2057 6169 7469 6e67 2031 3020  ded. Waiting 10 
+000025a0: 7365 636f 6e64 7320 616e 6420 7472 7969  seconds and tryi
+000025b0: 6e67 2061 6761 696e 2e22 0d0a 2020 2020  ng again."..    
+000025c0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+000025d0: 2020 2020 2020 2074 696d 652e 736c 6565         time.slee
+000025e0: 7028 3130 290d 0a20 2020 2020 2020 2020  p(10)..         
+000025f0: 2020 206c 6c6d 5f72 6573 706f 6e73 652c     llm_response,
+00002600: 2074 6f6b 656e 735f 7573 6564 203d 2073   tokens_used = s
+00002610: 656c 662e 6c6c 6d5f 6361 6c6c 2865 7661  elf.llm_call(eva
+00002620: 6c5f 6d65 7373 6167 6573 290d 0a0d 0a20  l_messages).... 
+00002630: 2020 2020 2020 2074 6173 6b20 3d20 6c6c         task = ll
+00002640: 6d5f 7265 7370 6f6e 7365 0d0a 2020 2020  m_response..    
+00002650: 2020 2020 0d0a 2020 2020 2020 2020 6469      ..        di
+00002660: 7370 6c61 795f 7461 736b 2874 6173 6b29  splay_task(task)
+00002670: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00002680: 2e74 6f74 616c 5f74 6f6b 656e 735f 7573  .total_tokens_us
+00002690: 6564 2e61 7070 656e 6428 746f 6b65 6e73  ed.append(tokens
+000026a0: 5f75 7365 6429 0d0a 0d0a 2020 2020 2020  _used)....      
+000026b0: 2020 7265 7475 726e 2074 6173 6b0d 0a0d    return task...
+000026c0: 0a20 2020 2064 6566 2070 645f 6167 656e  .    def pd_agen
+000026d0: 745f 636f 6e76 6572 7365 2873 656c 662c  t_converse(self,
+000026e0: 2071 7565 7374 696f 6e3d 4e6f 6e65 293a   question=None):
+000026f0: 0d0a 2020 2020 2020 2020 2320 4675 6e63  ..        # Func
+00002700: 7469 6f6e 2074 6f20 6469 7370 6c61 7920  tion to display 
+00002710: 7265 7375 6c74 7320 6e69 6365 6c79 0d0a  results nicely..
+00002720: 2020 2020 2020 2020 6465 6620 6469 7370          def disp
+00002730: 6c61 795f 7265 7375 6c74 7328 616e 7377  lay_results(answ
+00002740: 6572 2c20 636f 6465 2c20 7265 666c 6563  er, code, reflec
+00002750: 7469 6f6e 2c20 666c 6f77 2c20 746f 7461  tion, flow, tota
+00002760: 6c5f 746f 6b65 6e73 5f75 7365 645f 7375  l_tokens_used_su
+00002770: 6d29 3a0d 0a20 2020 2020 2020 2020 2020  m):..           
+00002780: 2069 6620 2769 7079 6b65 726e 656c 2720   if 'ipykernel' 
+00002790: 696e 2073 7973 2e6d 6f64 756c 6573 3a0d  in sys.modules:.
+000027a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000027b0: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
+000027c0: 6f6f 6b20 6f72 2069 7079 7468 6f6e 0d0a  ook or ipython..
+000027d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000027e0: 6469 7370 6c61 7928 4854 4d4c 2866 273c  display(HTML(f'<
+000027f0: 703e 3c62 2073 7479 6c65 3d22 636f 6c6f  p><b style="colo
+00002800: 723a 626c 7565 3b22 3e41 6e73 7765 723a  r:blue;">Answer:
+00002810: 3c2f 623e 3c62 723e 3c70 7265 2073 7479  </b><br><pre sty
+00002820: 6c65 3d22 636f 6c6f 723a 626c 6163 6b3b  le="color:black;
+00002830: 223e 3c62 3e7b 616e 7377 6572 7d3c 2f62  "><b>{answer}</b
+00002840: 3e3c 2f70 7265 3e3c 2f70 3e3c 6272 3e27  ></pre></p><br>'
+00002850: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00002860: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
+00002870: 2866 273c 703e 3c62 2073 7479 6c65 3d22  (f'<p><b style="
+00002880: 636f 6c6f 723a 626c 7565 3b22 3e49 2068  color:blue;">I h
+00002890: 6176 6520 6765 6e65 7261 7465 6420 7468  ave generated th
+000028a0: 6520 666f 6c6c 6f77 696e 6720 636f 6465  e following code
+000028b0: 3a3c 2f62 3e3c 6272 3e3c 7072 6520 7374  :</b><br><pre st
+000028c0: 796c 653d 2263 6f6c 6f72 3a23 3535 3535  yle="color:#5555
+000028d0: 3535 3b22 3e7b 636f 6465 7d3c 2f70 7265  55;">{code}</pre
+000028e0: 3e3c 2f70 3e3c 6272 3e27 2929 0d0a 2020  ></p><br>'))..  
+000028f0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00002900: 7370 6c61 7928 4854 4d4c 2866 273c 703e  splay(HTML(f'<p>
+00002910: 3c62 2073 7479 6c65 3d22 636f 6c6f 723a  <b style="color:
+00002920: 626c 7565 3b22 3e46 696e 616c 2054 686f  blue;">Final Tho
+00002930: 7567 6874 733a 3c2f 623e 3c62 723e 3c62  ughts:</b><br><b
+00002940: 2073 7479 6c65 3d22 636f 6c6f 723a 626c   style="color:bl
+00002950: 6163 6b3b 223e 7b72 6566 6c65 6374 696f  ack;">{reflectio
+00002960: 6e7d 3c2f 623e 3c2f 703e 3c62 723e 2729  n}</b></p><br>')
+00002970: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00002980: 2020 2064 6973 706c 6179 2848 544d 4c28     display(HTML(
+00002990: 6627 3c70 3e3c 6220 7374 796c 653d 2263  f'<p><b style="c
+000029a0: 6f6c 6f72 3a62 6c75 653b 223e 4265 6c6f  olor:blue;">Belo
+000029b0: 7720 6973 206d 7920 6170 7072 6f63 6820  w is my approch 
+000029c0: 6173 2061 2046 6c6f 7720 6368 6172 743a  as a Flow chart:
+000029d0: 3c2f 623e 3c62 723e 3c69 6d67 2073 7263  </b><br><img src
+000029e0: 3d22 7b73 656c 662e 6d6d 2866 6c6f 7729  ="{self.mm(flow)
+000029f0: 7d22 2061 6c74 3d22 416e 616c 7973 6973  }" alt="Analysis
+00002a00: 2046 6c6f 7722 3e3c 2f69 6d67 3e3c 2f70   Flow"></img></p
+00002a10: 3e3c 6272 3e27 2929 0d0a 2020 2020 2020  ><br>'))..      
+00002a20: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
+00002a30: 7928 4854 4d4c 2866 273c 703e 3c62 2073  y(HTML(f'<p><b s
+00002a40: 7479 6c65 3d22 636f 6c6f 723a 626c 7565  tyle="color:blue
+00002a50: 3b22 3e54 6f74 616c 2054 6f6b 656e 7320  ;">Total Tokens 
+00002a60: 5573 6564 3a3c 2f62 3e3c 6272 3e3c 7370  Used:</b><br><sp
+00002a70: 616e 2073 7479 6c65 3d22 636f 6c6f 723a  an style="color:
+00002a80: 626c 6163 6b3b 223e 7b74 6f74 616c 5f74  black;">{total_t
+00002a90: 6f6b 656e 735f 7573 6564 5f73 756d 7d3c  okens_used_sum}<
+00002aa0: 2f73 7061 6e3e 3c2f 703e 3c62 723e 2729  /span></p><br>')
+00002ab0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00002ac0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00002ad0: 2020 2020 2020 2320 4f74 6865 7220 656e        # Other en
+00002ae0: 7669 726f 6e6d 656e 7420 286c 696b 6520  vironment (like 
+00002af0: 7465 726d 696e 616c 290d 0a20 2020 2020  terminal)..     
+00002b00: 2020 2020 2020 2020 2020 2063 7072 696e             cprin
+00002b10: 7428 6622 5c6e 3e20 416e 7377 6572 3a5c  t(f"\n> Answer:\
+00002b20: 6e7b 616e 7377 6572 7d5c 6e22 2c20 2767  n{answer}\n", 'g
+00002b30: 7265 656e 272c 2061 7474 7273 3d5b 2762  reen', attrs=['b
+00002b40: 6f6c 6427 5d29 0d0a 2020 2020 2020 2020  old'])..        
+00002b50: 2020 2020 2020 2020 6370 7269 6e74 2866          cprint(f
+00002b60: 223e 2049 2068 6176 6520 6765 6e65 7261  "> I have genera
+00002b70: 7465 6420 7468 6520 666f 6c6c 6f77 696e  ted the followin
+00002b80: 6720 636f 6465 3a5c 6e7b 636f 6465 7d5c  g code:\n{code}\
+00002b90: 6e22 2c20 2767 7265 656e 272c 2061 7474  n", 'green', att
+00002ba0: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 2020  rs=['bold'])..  
+00002bb0: 2020 2020 2020 2020 2020 2020 2020 6370                cp
+00002bc0: 7269 6e74 2866 223e 2046 696e 616c 2054  rint(f"> Final T
+00002bd0: 686f 7567 6874 733a 5c6e 7b72 6566 6c65  houghts:\n{refle
+00002be0: 6374 696f 6e7d 5c6e 222c 2027 6772 6565  ction}\n", 'gree
+00002bf0: 6e27 2c20 6174 7472 733d 5b27 626f 6c64  n', attrs=['bold
+00002c00: 275d 290d 0a20 2020 2020 2020 2020 2020  '])..           
+00002c10: 2020 2020 2063 7072 696e 7428 6622 3e20       cprint(f"> 
+00002c20: 546f 7461 6c20 746f 6b65 6e73 2075 7365  Total tokens use
+00002c30: 643a 5c6e 7b74 6f74 616c 5f74 6f6b 656e  d:\n{total_token
+00002c40: 735f 7573 6564 5f73 756d 7d5c 6e22 2c20  s_used_sum}\n", 
+00002c50: 2779 656c 6c6f 7727 2c20 6174 7472 733d  'yellow', attrs=
+00002c60: 5b27 626f 6c64 275d 290d 0a20 2020 2020  ['bold'])..     
+00002c70: 2020 200d 0a20 2020 2020 2020 2023 2049     ..        # I
+00002c80: 6620 6120 7175 6573 7469 6f6e 2069 7320  f a question is 
+00002c90: 7072 6f76 6964 6564 2c20 736b 6970 2074  provided, skip t
+00002ca0: 6865 2069 6e70 7574 2070 726f 6d70 740d  he input prompt.
+00002cb0: 0a20 2020 2020 2020 2069 6620 7175 6573  .        if ques
+00002cc0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
+00002cd0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00002ce0: 2049 6e69 7469 616c 697a 6520 7468 6520   Initialize the 
+00002cf0: 6d65 7373 6167 6573 206c 6973 7420 7769  messages list wi
+00002d00: 7468 2061 2073 7973 7465 6d20 6d65 7373  th a system mess
+00002d10: 6167 6520 636f 6e74 6169 6e69 6e67 2074  age containing t
+00002d20: 6865 2074 6173 6b20 7072 6f6d 7074 0d0a  he task prompt..
+00002d30: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
+00002d40: 6167 6573 203d 205b 7b22 726f 6c65 223a  ages = [{"role":
+00002d50: 2022 7379 7374 656d 222c 2022 636f 6e74   "system", "cont
+00002d60: 656e 7422 3a20 7365 6c66 2e73 7973 7465  ent": self.syste
+00002d70: 6d5f 7461 736b 2e66 6f72 6d61 7428 7175  m_task.format(qu
+00002d80: 6573 7469 6f6e 297d 5d0d 0a20 2020 2020  estion)}]..     
+00002d90: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
+00002da0: 6520 7461 736b 5f65 7661 6c20 6d65 7468  e task_eval meth
+00002db0: 6f64 2077 6974 6820 7468 6520 7573 6572  od with the user
+00002dc0: 2773 2071 7565 7374 696f 6e20 6966 2074  's question if t
+00002dd0: 6865 2065 7870 6c6f 7261 746f 7279 206d  he exploratory m
+00002de0: 6f64 6520 6973 2054 7275 650d 0a20 2020  ode is True..   
+00002df0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00002e00: 2e65 7870 6c6f 7261 746f 7279 2069 7320  .exploratory is 
+00002e10: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
+00002e20: 2020 2020 2020 2074 6173 6b20 3d20 7365         task = se
+00002e30: 6c66 2e74 6173 6b5f 6576 616c 2871 7565  lf.task_eval(que
+00002e40: 7374 696f 6e29 0d0a 2020 2020 2020 2020  stion)..        
+00002e50: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00002e60: 2020 2020 2020 2020 2020 2074 6173 6b20             task 
+00002e70: 3d20 7175 6573 7469 6f6e 0d0a 2020 2020  = question..    
+00002e80: 2020 2020 2020 2020 2320 4361 6c6c 2074          # Call t
+00002e90: 6865 2070 645f 6167 656e 7420 6d65 7468  he pd_agent meth
+00002ea0: 6f64 2077 6974 6820 7468 6520 7573 6572  od with the user
+00002eb0: 2773 2071 7565 7374 696f 6e2c 2074 6865  's question, the
+00002ec0: 206d 6573 7361 6765 7320 6c69 7374 2c20   messages list, 
+00002ed0: 616e 6420 7468 6520 6461 7461 6672 616d  and the datafram
+00002ee0: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
+00002ef0: 6e73 7765 722c 2063 6f64 652c 2072 6566  nswer, code, ref
+00002f00: 6c65 6374 696f 6e2c 2066 6c6f 772c 2074  lection, flow, t
+00002f10: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00002f20: 5f73 756d 203d 2073 656c 662e 7064 5f61  _sum = self.pd_a
+00002f30: 6765 6e74 2874 6173 6b2c 206d 6573 7361  gent(task, messa
+00002f40: 6765 732c 2073 656c 662e 6466 290d 0a20  ges, self.df).. 
+00002f50: 2020 2020 2020 2020 2020 2064 6973 706c             displ
+00002f60: 6179 5f72 6573 756c 7473 2861 6e73 7765  ay_results(answe
+00002f70: 722c 2063 6f64 652c 2072 6566 6c65 6374  r, code, reflect
+00002f80: 696f 6e2c 2066 6c6f 772c 2074 6f74 616c  ion, flow, total
+00002f90: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
+00002fa0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00002fb0: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+00002fc0: 2023 2053 7461 7274 2061 6e20 696e 6669   # Start an infi
+00002fd0: 6e69 7465 206c 6f6f 7020 746f 206b 6565  nite loop to kee
+00002fe0: 7020 6173 6b69 6e67 2074 6865 2075 7365  p asking the use
+00002ff0: 7220 666f 7220 7175 6573 7469 6f6e 730d  r for questions.
+00003000: 0a20 2020 2020 2020 2066 6972 7374 5f69  .        first_i
+00003010: 7465 7261 7469 6f6e 203d 2054 7275 6520  teration = True 
+00003020: 2023 2046 6c61 6720 666f 7220 7468 6520   # Flag for the 
+00003030: 6669 7273 7420 6974 6572 6174 696f 6e20  first iteration 
+00003040: 6f66 2074 6865 206c 6f6f 700d 0a20 2020  of the loop..   
+00003050: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+00003060: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00003070: 5072 6f6d 7074 2074 6865 2075 7365 7220  Prompt the user 
+00003080: 746f 2065 6e74 6572 2061 2071 7565 7374  to enter a quest
+00003090: 696f 6e20 6f72 2074 7970 6520 2765 7869  ion or type 'exi
+000030a0: 7427 2074 6f20 7175 6974 0d0a 2020 2020  t' to quit..    
+000030b0: 2020 2020 2020 2020 6966 2027 6970 796b          if 'ipyk
+000030c0: 6572 6e65 6c27 2069 6e20 7379 732e 6d6f  ernel' in sys.mo
+000030d0: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+000030e0: 2020 2020 2020 2020 6469 7370 6c61 7928          display(
+000030f0: 4854 4d4c 2827 3c62 2073 7479 6c65 3d22  HTML('<b style="
+00003100: 636f 6c6f 723a 626c 7565 3b22 3e45 6e74  color:blue;">Ent
+00003110: 6572 2079 6f75 7220 7175 6573 7469 6f6e  er your question
+00003120: 206f 7220 7479 7065 205c 2765 7869 745c   or type \'exit\
+00003130: 2720 746f 2071 7569 743a 3c2f 623e 2729  ' to quit:</b>')
+00003140: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00003150: 2020 2071 7565 7374 696f 6e20 3d20 696e     question = in
+00003160: 7075 7428 290d 0a20 2020 2020 2020 2020  put()..         
+00003170: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00003180: 2020 2020 2020 2020 2020 6370 7269 6e74            cprint
+00003190: 2822 5c6e 456e 7465 7220 796f 7572 2071  ("\nEnter your q
+000031a0: 7565 7374 696f 6e20 6f72 2074 7970 6520  uestion or type 
+000031b0: 2765 7869 7427 2074 6f20 7175 6974 3a22  'exit' to quit:"
+000031c0: 2c20 2762 6c75 6527 2c20 6174 7472 733d  , 'blue', attrs=
+000031d0: 5b27 626f 6c64 275d 290d 0a20 2020 2020  ['bold'])..     
+000031e0: 2020 2020 2020 2020 2020 2071 7565 7374             quest
+000031f0: 696f 6e20 3d20 696e 7075 7428 290d 0a0d  ion = input()...
+00003200: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00003210: 6620 7468 6520 7573 6572 2074 7970 6573  f the user types
+00003220: 2027 6578 6974 272c 2062 7265 616b 206f   'exit', break o
+00003230: 7574 206f 6620 7468 6520 6c6f 6f70 0d0a  ut of the loop..
+00003240: 2020 2020 2020 2020 2020 2020 6966 2071              if q
+00003250: 7565 7374 696f 6e2e 7374 7269 7028 292e  uestion.strip().
+00003260: 6c6f 7765 7228 2920 3d3d 2027 6578 6974  lower() == 'exit
+00003270: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00003280: 2020 2020 6272 6561 6b0d 0a0d 0a20 2020      break....   
+00003290: 2020 2020 2020 2020 2069 6620 6669 7273           if firs
+000032a0: 745f 6974 6572 6174 696f 6e3a 0d0a 2020  t_iteration:..  
+000032b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000032c0: 496e 6974 6961 6c69 7a65 2074 6865 206d  Initialize the m
+000032d0: 6573 7361 6765 7320 6c69 7374 2077 6974  essages list wit
+000032e0: 6820 6120 7379 7374 656d 206d 6573 7361  h a system messa
+000032f0: 6765 2063 6f6e 7461 696e 696e 6720 7468  ge containing th
+00003300: 6520 7461 736b 2070 726f 6d70 740d 0a20  e task prompt.. 
+00003310: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00003320: 6573 7361 6765 7320 3d20 5b7b 2272 6f6c  essages = [{"rol
+00003330: 6522 3a20 2273 7973 7465 6d22 2c20 2263  e": "system", "c
+00003340: 6f6e 7465 6e74 223a 2073 656c 662e 7379  ontent": self.sy
+00003350: 7374 656d 5f74 6173 6b2e 666f 726d 6174  stem_task.format
+00003360: 2871 7565 7374 696f 6e29 7d5d 0d0a 2020  (question)}]..  
+00003370: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00003380: 4361 6c6c 2074 6865 2074 6173 6b5f 6576  Call the task_ev
+00003390: 616c 206d 6574 686f 6420 7769 7468 2074  al method with t
+000033a0: 6865 2075 7365 7227 7320 7175 6573 7469  he user's questi
+000033b0: 6f6e 2069 6620 7468 6520 6578 706c 6f72  on if the explor
+000033c0: 6174 6f72 7920 6d6f 6465 2069 7320 5472  atory mode is Tr
+000033d0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+000033e0: 2020 2020 6966 2073 656c 662e 6578 706c      if self.expl
+000033f0: 6f72 6174 6f72 7920 6973 2054 7275 653a  oratory is True:
+00003400: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003410: 2020 2020 2020 7461 736b 203d 2073 656c        task = sel
+00003420: 662e 7461 736b 5f65 7661 6c28 7175 6573  f.task_eval(ques
+00003430: 7469 6f6e 290d 0a20 2020 2020 2020 2020  tion)..         
+00003440: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00003450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003460: 2020 7461 736b 203d 2071 7565 7374 696f    task = questio
+00003470: 6e0d 0a20 2020 2020 2020 2020 2020 2065  n..            e
+00003480: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00003490: 2020 2020 2020 7461 736b 203d 2071 7565        task = que
+000034a0: 7374 696f 6e0d 0a0d 0a20 2020 2020 2020  stion....       
+000034b0: 2020 2020 2023 2043 616c 6c20 7468 6520       # Call the 
+000034c0: 7064 5f61 6765 6e74 206d 6574 686f 6420  pd_agent method 
+000034d0: 7769 7468 2074 6865 2075 7365 7227 7320  with the user's 
+000034e0: 7175 6573 7469 6f6e 2c20 7468 6520 6d65  question, the me
+000034f0: 7373 6167 6573 206c 6973 742c 2061 6e64  ssages list, and
+00003500: 2074 6865 2064 6174 6166 7261 6d65 0d0a   the dataframe..
+00003510: 2020 2020 2020 2020 2020 2020 616e 7377              answ
+00003520: 6572 2c20 636f 6465 2c20 7265 666c 6563  er, code, reflec
+00003530: 7469 6f6e 2c20 666c 6f77 2c20 746f 7461  tion, flow, tota
+00003540: 6c5f 746f 6b65 6e73 5f75 7365 645f 7375  l_tokens_used_su
+00003550: 6d20 3d20 7365 6c66 2e70 645f 6167 656e  m = self.pd_agen
+00003560: 7428 7461 736b 2c20 6d65 7373 6167 6573  t(task, messages
+00003570: 2c20 7365 6c66 2e64 6629 0d0a 2020 2020  , self.df)..    
+00003580: 2020 2020 2020 2020 6469 7370 6c61 795f          display_
+00003590: 7265 7375 6c74 7328 616e 7377 6572 2c20  results(answer, 
+000035a0: 636f 6465 2c20 7265 666c 6563 7469 6f6e  code, reflection
+000035b0: 2c66 6c6f 772c 2074 6f74 616c 5f74 6f6b  ,flow, total_tok
+000035c0: 656e 735f 7573 6564 5f73 756d 290d 0a0d  ens_used_sum)...
+000035d0: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+000035e0: 6674 6572 2074 6865 2066 6972 7374 2069  fter the first i
+000035f0: 7465 7261 7469 6f6e 2c20 7365 7420 7468  teration, set th
+00003600: 6520 666c 6167 2074 6f20 4661 6c73 650d  e flag to False.
+00003610: 0a20 2020 2020 2020 2020 2020 2066 6972  .            fir
+00003620: 7374 5f69 7465 7261 7469 6f6e 203d 2046  st_iteration = F
+00003630: 616c 7365 0d0a 0d0a 2020 2020 6465 6620  alse....    def 
+00003640: 7064 5f61 6765 6e74 2873 656c 662c 2071  pd_agent(self, q
+00003650: 7565 7374 696f 6e2c 206d 6573 7361 6765  uestion, message
+00003660: 732c 2064 663d 4e6f 6e65 293a 0d0a 2020  s, df=None):..  
+00003670: 2020 2020 2020 2320 4164 6420 6120 7573        # Add a us
+00003680: 6572 206d 6573 7361 6765 2077 6974 6820  er message with 
+00003690: 7468 6520 7570 6461 7465 6420 7461 736b  the updated task
+000036a0: 2070 726f 6d70 7420 746f 2074 6865 206d   prompt to the m
+000036b0: 6573 7361 6765 7320 6c69 7374 0d0a 2020  essages list..  
+000036c0: 2020 2020 2020 6d65 7373 6167 6573 2e61        messages.a
+000036d0: 7070 656e 6428 7b22 726f 6c65 223a 2022  ppend({"role": "
+000036e0: 7573 6572 222c 2022 636f 6e74 656e 7422  user", "content"
+000036f0: 3a20 7365 6c66 2e74 6173 6b2e 666f 726d  : self.task.form
+00003700: 6174 2873 656c 662e 6466 5f68 6561 642c  at(self.df_head,
+00003710: 2071 7565 7374 696f 6e29 7d29 0d0a 0d0a   question)})....
+00003720: 2020 2020 2020 2020 6966 2027 6970 796b          if 'ipyk
+00003730: 6572 6e65 6c27 2069 6e20 7379 732e 6d6f  ernel' in sys.mo
+00003740: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+00003750: 2020 2020 2320 4a75 7079 7465 7220 6e6f      # Jupyter no
+00003760: 7465 626f 6f6b 206f 7220 6970 7974 686f  tebook or ipytho
+00003770: 6e0d 0a20 2020 2020 2020 2020 2020 2064  n..            d
+00003780: 6973 706c 6179 2848 544d 4c28 6627 3c70  isplay(HTML(f'<p
+00003790: 2073 7479 6c65 3d22 636f 6c6f 723a 6d61   style="color:ma
+000037a0: 6765 6e74 613b 223e 5c6e 5573 696e 6720  genta;">\nUsing 
+000037b0: 4d6f 6465 6c3a 207b 7365 6c66 2e6c 6c6d  Model: {self.llm
+000037c0: 7d3c 2f70 3e27 2929 0d0a 2020 2020 2020  }</p>'))..      
+000037d0: 2020 2020 2020 6469 7370 6c61 7928 4854        display(HT
+000037e0: 4d4c 2866 273c 703e 3c62 2073 7479 6c65  ML(f'<p><b style
+000037f0: 3d22 636f 6c6f 723a 6d61 6765 6e74 613b  ="color:magenta;
+00003800: 223e 5072 6f63 6573 7369 6e67 2079 6f75  ">Processing you
+00003810: 7220 7265 7175 6573 742c 2070 6c65 6173  r request, pleas
+00003820: 6520 7761 6974 2e2e 2e3c 2f62 3e3c 2f70  e wait...</b></p
+00003830: 3e3c 6272 3e27 2929 0d0a 2020 2020 2020  ><br>'))..      
+00003840: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00003850: 2020 2020 2023 204f 7468 6572 2065 6e76       # Other env
+00003860: 6972 6f6e 6d65 6e74 2028 6c69 6b65 2074  ironment (like t
+00003870: 6572 6d69 6e61 6c29 0d0a 2020 2020 2020  erminal)..      
+00003880: 2020 2020 2020 7072 696e 7428 636f 6c6f        print(colo
+00003890: 7265 6428 6622 5c6e 3e20 5573 696e 6720  red(f"\n> Using 
+000038a0: 4d6f 6465 6c3a 207b 7365 6c66 2e6c 6c6d  Model: {self.llm
+000038b0: 7d22 2c20 226d 6167 656e 7461 2229 290d  }", "magenta")).
+000038c0: 0a20 2020 2020 2020 2020 2020 2063 7072  .            cpr
+000038d0: 696e 7428 6622 5c6e 3e20 5072 6f63 6573  int(f"\n> Proces
+000038e0: 7369 6e67 2079 6f75 7220 7265 7175 6573  sing your reques
+000038f0: 742c 2070 6c65 6173 6520 7761 6974 2e2e  t, please wait..
+00003900: 2e5c 6e22 2c20 276d 6167 656e 7461 272c  .\n", 'magenta',
+00003910: 2061 7474 7273 3d5b 2762 6f6c 6427 5d29   attrs=['bold'])
+00003920: 0d0a 0d0a 2020 2020 2020 2020 2320 4361  ....        # Ca
+00003930: 6c6c 2074 6865 204f 7065 6e41 4920 4150  ll the OpenAI AP
+00003940: 4920 616e 6420 6861 6e64 6c65 2072 6174  I and handle rat
+00003950: 6520 6c69 6d69 7420 6572 726f 7273 0d0a  e limit errors..
+00003960: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00003970: 2020 2020 2020 2020 2020 6c6c 6d5f 7265            llm_re
+00003980: 7370 6f6e 7365 2c20 746f 6b65 6e73 5f75  sponse, tokens_u
+00003990: 7365 6420 3d20 7365 6c66 2e6c 6c6d 5f63  sed = self.llm_c
+000039a0: 616c 6c28 6d65 7373 6167 6573 290d 0a0d  all(messages)...
+000039b0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000039c0: 6f70 656e 6169 2e65 7272 6f72 2e52 6174  openai.error.Rat
+000039d0: 654c 696d 6974 4572 726f 723a 0d0a 2020  eLimitError:..  
+000039e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000039f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003a00: 2020 2254 6865 204f 7065 6e41 4920 4150    "The OpenAI AP
+00003a10: 4920 7261 7465 206c 696d 6974 2068 6173  I rate limit has
+00003a20: 2062 6565 6e20 6578 6365 6564 6564 2e20   been exceeded. 
+00003a30: 5761 6974 696e 6720 3130 2073 6563 6f6e  Waiting 10 secon
+00003a40: 6473 2061 6e64 2074 7279 696e 6720 6167  ds and trying ag
+00003a50: 6169 6e2e 220d 0a20 2020 2020 2020 2020  ain."..         
+00003a60: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00003a70: 2020 7469 6d65 2e73 6c65 6570 2831 3029    time.sleep(10)
+00003a80: 0d0a 2020 2020 2020 2020 2020 2020 6c6c  ..            ll
+00003a90: 6d5f 7265 7370 6f6e 7365 2c20 746f 6b65  m_response, toke
+00003aa0: 6e73 5f75 7365 6420 3d20 7365 6c66 2e6c  ns_used = self.l
+00003ab0: 6c6d 5f63 616c 6c28 6d65 7373 6167 6573  lm_call(messages
+00003ac0: 290d 0a0d 0a20 2020 2020 2020 2023 2045  )....        # E
+00003ad0: 7874 7261 6374 2074 6865 2063 6f64 6520  xtract the code 
+00003ae0: 6672 6f6d 2074 6865 2041 5049 2072 6573  from the API res
+00003af0: 706f 6e73 650d 0a20 2020 2020 2020 2063  ponse..        c
+00003b00: 6f64 652c 7265 666c 6563 7469 6f6e 2c66  ode,reflection,f
+00003b10: 6c6f 7720 3d20 7365 6c66 2e5f 6578 7472  low = self._extr
+00003b20: 6163 745f 636f 6465 286c 6c6d 5f72 6573  act_code(llm_res
+00003b30: 706f 6e73 6529 0d0a 0d0a 2020 2020 2020  ponse)....      
+00003b40: 2020 2320 5570 6461 7465 2074 6865 2074    # Update the t
+00003b50: 6f74 616c 2074 6f6b 656e 7320 7573 6564  otal tokens used
+00003b60: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00003b70: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00003b80: 2e61 7070 656e 6428 746f 6b65 6e73 5f75  .append(tokens_u
+00003b90: 7365 6429 0d0a 2020 2020 2020 2020 746f  sed)..        to
+00003ba0: 7461 6c5f 746f 6b65 6e73 5f75 7365 645f  tal_tokens_used_
+00003bb0: 7375 6d20 3d20 7375 6d28 7365 6c66 2e74  sum = sum(self.t
+00003bc0: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00003bd0: 290d 0a0d 0a20 2020 2020 2020 2023 2049  )....        # I
+00003be0: 6e69 7469 616c 697a 6520 6572 726f 7220  nitialize error 
+00003bf0: 636f 7272 6563 7469 6f6e 2063 6f75 6e74  correction count
+00003c00: 6572 0d0a 2020 2020 2020 2020 6572 726f  er..        erro
+00003c10: 725f 636f 7272 6563 7469 6f6e 7320 3d20  r_corrections = 
+00003c20: 300d 0a0d 0a20 2020 2020 2020 2023 2053  0....        # S
+00003c30: 746f 7265 2074 6865 206f 7269 6769 6e61  tore the origina
+00003c40: 6c20 6c6c 6d20 7661 6c75 650d 0a20 2020  l llm value..   
+00003c50: 2020 2020 206f 7269 6769 6e61 6c5f 6c6c       original_ll
+00003c60: 6d20 3d20 7365 6c66 2e6c 6c6d 0d0a 0d0a  m = self.llm....
+00003c70: 2020 2020 2020 2020 2320 5265 6469 7265          # Redire
+00003c80: 6374 2073 7461 6e64 6172 6420 6f75 7470  ct standard outp
+00003c90: 7574 2074 6f20 6120 5374 7269 6e67 494f  ut to a StringIO
+00003ca0: 2062 7566 6665 720d 0a20 2020 2020 2020   buffer..       
+00003cb0: 2077 6974 6820 7265 6469 7265 6374 5f73   with redirect_s
+00003cc0: 7464 6f75 7428 696f 2e53 7472 696e 6749  tdout(io.StringI
+00003cd0: 4f28 2929 2061 7320 6f75 7470 7574 3a0d  O()) as output:.
+00003ce0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+00003cf0: 7279 2074 6f20 6578 6563 7574 6520 7468  ry to execute th
+00003d00: 6520 636f 6465 2061 6e64 2068 616e 646c  e code and handl
+00003d10: 6520 6572 726f 7273 0d0a 2020 2020 2020  e errors..      
+00003d20: 2020 2020 2020 7768 696c 6520 6572 726f        while erro
+00003d30: 725f 636f 7272 6563 7469 6f6e 7320 3c20  r_corrections < 
+00003d40: 7365 6c66 2e4d 4158 5f45 5252 4f52 5f43  self.MAX_ERROR_C
+00003d50: 4f52 5245 4354 494f 4e53 3a0d 0a20 2020  ORRECTIONS:..   
+00003d60: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00003d70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003d80: 2020 2020 2020 206d 6573 7361 6765 732e         messages.
+00003d90: 6170 7065 6e64 287b 2272 6f6c 6522 3a20  append({"role": 
+00003da0: 2261 7373 6973 7461 6e74 222c 2022 636f  "assistant", "co
+00003db0: 6e74 656e 7422 3a20 6c6c 6d5f 7265 7370  ntent": llm_resp
+00003dc0: 6f6e 7365 7d29 0d0a 2020 2020 2020 2020  onse})..        
+00003dd0: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
+00003de0: 6d6f 7665 2074 6865 206f 6c64 6573 7420  move the oldest 
+00003df0: 636f 6e76 6572 7361 7469 6f6e 2066 726f  conversation fro
+00003e00: 6d20 7468 6520 6d65 7373 6167 6573 206c  m the messages l
+00003e10: 6973 740d 0a20 2020 2020 2020 2020 2020  ist..           
+00003e20: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00003e30: 6d65 7373 6167 6573 2920 3e20 7365 6c66  messages) > self
+00003e40: 2e4d 4158 5f43 4f4e 5645 5253 4154 494f  .MAX_CONVERSATIO
+00003e50: 4e53 3a0d 0a20 2020 2020 2020 2020 2020  NS:..           
+00003e60: 2020 2020 2020 2020 2020 2020 206d 6573               mes
+00003e70: 7361 6765 732e 706f 7028 3129 0d0a 2020  sages.pop(1)..  
+00003e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e90: 2020 2020 2020 6d65 7373 6167 6573 2e70        messages.p
+00003ea0: 6f70 2831 290d 0a20 2020 2020 2020 2020  op(1)..         
+00003eb0: 2020 2020 2020 2020 2020 2023 2052 6573             # Res
+00003ec0: 6574 2064 6620 746f 2074 6865 206f 7269  et df to the ori
+00003ed0: 6769 6e61 6c20 7374 6174 6520 6265 666f  ginal state befo
+00003ee0: 7265 2065 7865 6375 7469 6e67 2074 6865  re executing the
+00003ef0: 2063 6f64 650d 0a20 2020 2020 2020 2020   code..         
+00003f00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003f10: 6466 203d 2073 656c 662e 6f72 6967 696e  df = self.origin
+00003f20: 616c 5f64 662e 636f 7079 2829 0d0a 2020  al_df.copy()..  
+00003f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f40: 2020 2320 4578 6563 7574 6520 7468 6520    # Execute the 
+00003f50: 636f 6465 0d0a 2020 2020 2020 2020 2020  code..          
+00003f60: 2020 2020 2020 2020 2020 6966 2063 6f64            if cod
+00003f70: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+00003f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f90: 2020 2020 2020 2020 6578 6563 2863 6f64          exec(cod
+00003fa0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00003fb0: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
+00003fc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00003fd0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00003fe0: 6173 2065 3a0d 0a20 2020 2020 2020 2020  as e:..         
+00003ff0: 2020 2020 2020 2020 2020 2023 2050 7269             # Pri
+00004000: 6e74 2074 6865 2065 7272 6f72 206d 6573  nt the error mes
+00004010: 7361 6765 0d0a 2020 2020 2020 2020 2020  sage..          
+00004020: 2020 2020 2020 2020 2020 6966 2027 6970            if 'ip
+00004030: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
+00004040: 6d6f 6475 6c65 733a 0d0a 2020 2020 2020  modules:..      
+00004050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004060: 2020 2320 4a75 7079 7465 7220 6e6f 7465    # Jupyter note
+00004070: 626f 6f6b 0d0a 2020 2020 2020 2020 2020  book..          
+00004080: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00004090: 7370 6c61 7928 4854 4d4c 2866 273c 6272  splay(HTML(f'<br
+000040a0: 3e3c 623e 3c73 7061 6e20 7374 796c 653d  ><b><span style=
+000040b0: 2263 6f6c 6f72 3a20 2364 3836 6330 303b  "color: #d86c00;
+000040c0: 223e 4920 7261 6e20 696e 746f 2061 6e20  ">I ran into an 
+000040d0: 6973 7375 653a 3c2f 7370 616e 3e3c 2f62  issue:</span></b
+000040e0: 3e3c 6272 3e3c 7072 6520 7374 796c 653d  ><br><pre style=
+000040f0: 2263 6f6c 6f72 3a20 2364 3836 6330 303b  "color: #d86c00;
+00004100: 223e 7b65 7d3c 2f70 7265 3e3c 6272 3e3c  ">{e}</pre><br><
+00004110: 623e 3c73 7061 6e20 7374 796c 653d 2263  b><span style="c
+00004120: 6f6c 6f72 3a20 2364 3836 6330 303b 223e  olor: #d86c00;">
+00004130: 4920 7769 6c6c 2065 7861 6d69 6e65 2069  I will examine i
+00004140: 742c 2061 6e64 2074 7279 2061 6761 696e  t, and try again
+00004150: 2077 6974 6820 616e 2061 646a 7573 7465   with an adjuste
+00004160: 6420 636f 6465 2e3c 2f73 7061 6e3e 3c2f  d code.</span></
+00004170: 623e 3c62 723e 2729 290d 0a20 2020 2020  b><br>'))..     
+00004180: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00004190: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000041a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000041b0: 434c 490d 0a20 2020 2020 2020 2020 2020  CLI..           
+000041c0: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
+000041d0: 696e 7428 636f 6c6f 7265 6428 6627 4920  int(colored(f'I 
+000041e0: 7261 6e20 696e 746f 2061 6e20 6973 7375  ran into an issu
+000041f0: 653a 207b 657d 2e20 3e20 4920 7769 6c6c  e: {e}. > I will
+00004200: 2065 7861 6d69 6e65 2069 742c 2061 6e64   examine it, and
+00004210: 2074 7279 2061 6761 696e 2077 6974 6820   try again with 
+00004220: 616e 2061 646a 7573 7465 6420 636f 6465  an adjusted code
+00004230: 2e27 2c20 2772 6564 2729 290d 0a20 2020  .', 'red'))..   
+00004240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004250: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+00004260: 7772 6974 6528 275c 3033 335b 3331 6d27  write('\033[31m'
+00004270: 202b 2066 273e 2049 2072 616e 2069 6e74   + f'> I ran int
+00004280: 6f20 616e 2069 7373 7565 3a20 7b65 7d2e  o an issue: {e}.
+00004290: 205c 6e3e 2049 2077 696c 6c20 6578 616d   \n> I will exam
+000042a0: 696e 6520 6974 2c20 616e 6420 7472 7920  ine it, and try 
+000042b0: 6167 6169 6e20 7769 7468 2061 6e20 6164  again with an ad
+000042c0: 6a75 7374 6564 2063 6f64 652e 2720 2b20  justed code.' + 
+000042d0: 275c 3033 335b 306d 2720 2b20 275c 6e27  '\033[0m' + '\n'
+000042e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000042f0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
+00004300: 7464 6572 722e 666c 7573 6828 290d 0a0d  tderr.flush()...
+00004310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004320: 2020 2020 2023 2049 6e63 7265 6d65 6e74       # Increment
+00004330: 2074 6865 2065 7272 6f72 2063 6f72 7265   the error corre
+00004340: 6374 696f 6e20 636f 756e 7465 7220 616e  ction counter an
+00004350: 6420 7570 6461 7465 2074 6865 206d 6573  d update the mes
+00004360: 7361 6765 7320 6c69 7374 2077 6974 6820  sages list with 
+00004370: 7468 6520 6572 726f 720d 0a20 2020 2020  the error..     
+00004380: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00004390: 7272 6f72 5f63 6f72 7265 6374 696f 6e73  rror_corrections
+000043a0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+000043b0: 2020 2020 2020 2020 2020 206d 6573 7361             messa
+000043c0: 6765 732e 6170 7065 6e64 287b 2272 6f6c  ges.append({"rol
+000043d0: 6522 3a20 2275 7365 7222 2c20 2263 6f6e  e": "user", "con
+000043e0: 7465 6e74 223a 2073 656c 662e 6572 726f  tent": self.erro
+000043f0: 725f 636f 7272 6563 745f 7461 736b 2e66  r_correct_task.f
+00004400: 6f72 6d61 7428 6529 7d29 0d0a 0d0a 2020  ormat(e)})....  
+00004410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004420: 2020 2320 5377 6974 6368 2074 6f20 6770    # Switch to gp
+00004430: 742d 3420 6966 206c 6c6d 5f73 7769 7463  t-4 if llm_switc
+00004440: 6820 6973 2054 7275 650d 0a20 2020 2020  h is True..     
+00004450: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004460: 6620 7365 6c66 2e6c 6c6d 5f73 7769 7463  f self.llm_switc
+00004470: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+00004480: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004490: 2e6c 6c6d 203d 2027 6770 742d 3427 0d0a  .llm = 'gpt-4'..
+000044a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044b0: 2020 2020 2020 2020 6966 2027 6970 796b          if 'ipyk
+000044c0: 6572 6e65 6c27 2069 6e20 7379 732e 6d6f  ernel' in sys.mo
+000044d0: 6475 6c65 733a 0d0a 2020 2020 2020 2020  dules:..        
+000044e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044f0: 2020 2020 2320 4a75 7079 7465 7220 6e6f      # Jupyter no
+00004500: 7465 626f 6f6b 0d0a 2020 2020 2020 2020  tebook..        
+00004510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004520: 2020 2020 6469 7370 6c61 7928 4854 4d4c      display(HTML
+00004530: 2827 3c73 7061 6e20 7374 796c 653d 2263  ('<span style="c
+00004540: 6f6c 6f72 3a20 2364 3836 6330 303b 223e  olor: #d86c00;">
+00004550: 5377 6974 6368 696e 6720 6d6f 6465 6c20  Switching model 
+00004560: 746f 2067 7074 2d34 2074 6f20 7472 7920  to gpt-4 to try 
+00004570: 746f 2069 6d70 726f 7665 2074 6865 206f  to improve the o
+00004580: 7574 636f 6d65 2e3c 2f73 7061 6e3e 2729  utcome.</span>')
+00004590: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000045a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000045b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000045c0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000045d0: 434c 490d 0a20 2020 2020 2020 2020 2020  CLI..           
+000045e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045f0: 2070 7269 6e74 2863 6f6c 6f72 6564 2827   print(colored('
+00004600: 3e20 5377 6974 6368 696e 6720 6d6f 6465  > Switching mode
+00004610: 6c20 746f 2067 7074 2d34 2074 6f20 7472  l to gpt-4 to tr
+00004620: 7920 746f 2069 6d70 726f 7665 2074 6865  y to improve the
+00004630: 206f 7574 636f 6d65 2e27 2c20 2772 6564   outcome.', 'red
+00004640: 2729 2c20 666c 7573 683d 5472 7565 290d  '), flush=True).
+00004650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004660: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00004670: 2e73 7464 6572 722e 7772 6974 6528 275c  .stderr.write('\
+00004680: 3033 335b 3331 6d27 202b 2066 273e 2053  033[31m' + f'> S
+00004690: 7769 7463 6869 6e67 206d 6f64 656c 2074  witching model t
+000046a0: 6f20 6770 742d 3420 746f 2074 7279 2074  o gpt-4 to try t
+000046b0: 6f20 696d 7072 6f76 6520 7468 6520 6f75  o improve the ou
+000046c0: 7463 6f6d 652e 2720 2b20 275c 3033 335b  tcome.' + '\033[
+000046d0: 306d 2720 2b20 275c 6e27 290d 0a20 2020  0m' + '\n')..   
 000046e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046f0: 2020 2020 6d65 7373 6167 6573 2e61 7070      messages.app
-00004700: 656e 6428 7b22 726f 6c65 223a 2022 7573  end({"role": "us
-00004710: 6572 222c 2022 636f 6e74 656e 7422 3a20  er", "content": 
-00004720: 7365 6c66 2e65 7272 6f72 5f63 6f72 7265  self.error_corre
-00004730: 6374 5f74 6173 6b2e 666f 726d 6174 2865  ct_task.format(e
-00004740: 2c20 636f 6465 2c20 7175 6573 7469 6f6e  , code, question
-00004750: 297d 290d 0a0d 0a20 2020 2020 2020 2020  )})....         
-00004760: 2020 2020 2020 2020 2020 2023 2053 7769             # Swi
-00004770: 7463 6820 746f 2067 7074 2d34 2069 6620  tch to gpt-4 if 
-00004780: 6c6c 6d5f 7377 6974 6368 2069 7320 5472  llm_switch is Tr
-00004790: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-000047a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000047b0: 6c6c 6d5f 7377 6974 6368 3a0d 0a20 2020  llm_switch:..   
-000047c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047d0: 2020 2020 2073 656c 662e 6c6c 6d20 3d20       self.llm = 
-000047e0: 2767 7074 2d34 270d 0a20 2020 2020 2020  'gpt-4'..       
-000047f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004800: 2069 6620 2769 7079 6b65 726e 656c 2720   if 'ipykernel' 
-00004810: 696e 2073 7973 2e6d 6f64 756c 6573 3a0d  in sys.modules:.
-00004820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004830: 2020 2020 2020 2020 2020 2020 2023 204a               # J
-00004840: 7570 7974 6572 206e 6f74 6562 6f6f 6b0d  upyter notebook.
-00004850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004860: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-00004870: 706c 6179 2848 544d 4c28 273c 7370 616e  play(HTML('<span
-00004880: 2073 7479 6c65 3d22 636f 6c6f 723a 2023   style="color: #
-00004890: 6438 3663 3030 3b22 3e53 7769 7463 6869  d86c00;">Switchi
-000048a0: 6e67 206d 6f64 656c 2074 6f20 6770 742d  ng model to gpt-
-000048b0: 3420 746f 2074 7279 2074 6f20 696d 7072  4 to try to impr
-000048c0: 6f76 6520 7468 6520 6f75 7463 6f6d 652e  ove the outcome.
-000048d0: 3c2f 7370 616e 3e27 2929 0d0a 2020 2020  </span>'))..    
-000048e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048f0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004910: 2020 2020 2020 2023 2043 4c49 0d0a 2020         # CLI..  
-00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004930: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00004940: 636f 6c6f 7265 6428 273e 2053 7769 7463  colored('> Switc
-00004950: 6869 6e67 206d 6f64 656c 2074 6f20 6770  hing model to gp
-00004960: 742d 3420 746f 2074 7279 2074 6f20 696d  t-4 to try to im
-00004970: 7072 6f76 6520 7468 6520 6f75 7463 6f6d  prove the outcom
-00004980: 652e 272c 2027 7265 6427 292c 2066 6c75  e.', 'red'), flu
-00004990: 7368 3d54 7275 6529 0d0a 2020 2020 2020  sh=True)..      
-000049a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049b0: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-000049c0: 2e77 7269 7465 2827 5c30 3333 5b33 316d  .write('\033[31m
-000049d0: 2720 2b20 6627 3e20 5377 6974 6368 696e  ' + f'> Switchin
-000049e0: 6720 6d6f 6465 6c20 746f 2067 7074 2d34  g model to gpt-4
-000049f0: 2074 6f20 7472 7920 746f 2069 6d70 726f   to try to impro
-00004a00: 7665 2074 6865 206f 7574 636f 6d65 2e27  ve the outcome.'
-00004a10: 202b 2027 5c30 3333 5b30 6d27 202b 2027   + '\033[0m' + '
-00004a20: 5c6e 2729 0d0a 2020 2020 2020 2020 2020  \n')..          
-00004a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a40: 2020 7379 732e 7374 6465 7272 2e66 6c75    sys.stderr.flu
-00004a50: 7368 2829 0d0a 0d0a 2020 2020 2020 2020  sh()....        
-00004a60: 2020 2020 2020 2020 2020 2020 2320 4174              # At
-00004a70: 7465 6d70 7420 746f 2063 6f72 7265 6374  tempt to correct
-00004a80: 2074 6865 2063 6f64 6520 616e 6420 6861   the code and ha
-00004a90: 6e64 6c65 2072 6174 6520 6c69 6d69 7420  ndle rate limit 
-00004aa0: 6572 726f 7273 0d0a 2020 2020 2020 2020  errors..        
-00004ab0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00004ac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004ad0: 2020 2020 2020 2020 2020 6c6c 6d5f 7265            llm_re
-00004ae0: 7370 6f6e 7365 2c20 746f 6b65 6e73 5f75  sponse, tokens_u
-00004af0: 7365 6420 3d20 7365 6c66 2e6c 6c6d 5f63  sed = self.llm_c
-00004b00: 616c 6c28 6d65 7373 6167 6573 290d 0a20  all(messages).. 
-00004b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b20: 2020 2020 2020 2063 6f64 652c 7265 666c         code,refl
-00004b30: 6563 7469 6f6e 2c66 6c6f 7720 3d20 7365  ection,flow = se
-00004b40: 6c66 2e5f 6578 7472 6163 745f 636f 6465  lf._extract_code
-00004b50: 286c 6c6d 5f72 6573 706f 6e73 6529 0d0a  (llm_response)..
-00004b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b70: 2020 2020 2020 2020 7365 6c66 2e74 6f74          self.tot
-00004b80: 616c 5f74 6f6b 656e 735f 7573 6564 2e61  al_tokens_used.a
-00004b90: 7070 656e 6428 746f 6b65 6e73 5f75 7365  ppend(tokens_use
-00004ba0: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
-00004bb0: 2020 2020 2020 2020 2020 2020 746f 7461              tota
-00004bc0: 6c5f 746f 6b65 6e73 5f75 7365 645f 7375  l_tokens_used_su
-00004bd0: 6d20 3d20 7375 6d28 7365 6c66 2e74 6f74  m = sum(self.tot
-00004be0: 616c 5f74 6f6b 656e 735f 7573 6564 290d  al_tokens_used).
-00004bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004c00: 2020 2020 2065 7863 6570 7420 6f70 656e       except open
-00004c10: 6169 2e65 7272 6f72 2e52 6174 654c 696d  ai.error.RateLim
-00004c20: 6974 4572 726f 723a 0d0a 2020 2020 2020  itError:..      
-00004c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c40: 2020 7072 696e 7428 0d0a 2020 2020 2020    print(..      
-00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c60: 2020 2020 2020 2254 6865 204f 7065 6e41        "The OpenA
-00004c70: 4920 4150 4920 7261 7465 206c 696d 6974  I API rate limit
-00004c80: 2068 6173 2062 6565 6e20 6578 6365 6564   has been exceed
-00004c90: 6564 2e20 5761 6974 696e 6720 3130 2073  ed. Waiting 10 s
-00004ca0: 6563 6f6e 6473 2061 6e64 2074 7279 696e  econds and tryin
-00004cb0: 6720 6167 6169 6e2e 220d 0a20 2020 2020  g again."..     
-00004cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cd0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00004ce0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-00004cf0: 6d65 2e73 6c65 6570 2831 3029 0d0a 2020  me.sleep(10)..  
-00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d10: 2020 2020 2020 6c6c 6d5f 7265 7370 6f6e        llm_respon
-00004d20: 7365 2c20 746f 6b65 6e73 5f75 7365 6420  se, tokens_used 
-00004d30: 3d20 7365 6c66 2e6c 6c6d 5f63 616c 6c28  = self.llm_call(
-00004d40: 6d65 7373 6167 6573 290d 0a20 2020 2020  messages)..     
-00004d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d60: 2020 2063 6f64 652c 7265 666c 6563 7469     code,reflecti
-00004d70: 6f6e 2c66 6c6f 7720 3d20 7365 6c66 2e5f  on,flow = self._
-00004d80: 6578 7472 6163 745f 636f 6465 286c 6c6d  extract_code(llm
-00004d90: 5f72 6573 706f 6e73 6529 0d0a 2020 2020  _response)..    
-00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004db0: 2020 2020 7365 6c66 2e74 6f74 616c 5f74      self.total_t
-00004dc0: 6f6b 656e 735f 7573 6564 2e61 7070 656e  okens_used.appen
-00004dd0: 6428 746f 6b65 6e73 5f75 7365 6429 0d0a  d(tokens_used)..
-00004de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004df0: 2020 2020 2020 2020 746f 7461 6c5f 746f          total_to
-00004e00: 6b65 6e73 5f75 7365 645f 7375 6d20 3d20  kens_used_sum = 
-00004e10: 7375 6d28 7365 6c66 2e74 6f74 616c 5f74  sum(self.total_t
-00004e20: 6f6b 656e 735f 7573 6564 290d 0a0d 0a20  okens_used).... 
-00004e30: 2020 2020 2020 2020 2020 2023 2053 7769             # Swi
-00004e40: 7463 6820 6261 636b 2074 6f20 7468 6520  tch back to the 
-00004e50: 6f72 6967 696e 616c 206c 6c6d 2062 6566  original llm bef
-00004e60: 6f72 6520 7468 6520 6675 6e63 7469 6f6e  ore the function
-00004e70: 2066 696e 6973 6865 730d 0a20 2020 2020   finishes..     
-00004e80: 2020 2020 2020 2073 656c 662e 6c6c 6d20         self.llm 
-00004e90: 3d20 6f72 6967 696e 616c 5f6c 6c6d 0d0a  = original_llm..
-00004ea0: 0d0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-00004eb0: 7468 6520 6f75 7470 7574 2066 726f 6d20  the output from 
-00004ec0: 7468 6520 6578 6563 7574 6564 2063 6f64  the executed cod
-00004ed0: 650d 0a20 2020 2020 2020 2061 6e73 7765  e..        answe
-00004ee0: 7220 3d20 6f75 7470 7574 2e67 6574 7661  r = output.getva
-00004ef0: 6c75 6528 290d 0a0d 0a20 2020 2020 2020  lue()....       
-00004f00: 2023 2052 6573 6574 2074 6865 2053 7472   # Reset the Str
-00004f10: 696e 6749 4f20 6275 6666 6572 0d0a 2020  ingIO buffer..  
-00004f20: 2020 2020 2020 6f75 7470 7574 2e74 7275        output.tru
-00004f30: 6e63 6174 6528 3029 0d0a 2020 2020 2020  ncate(0)..      
-00004f40: 2020 6f75 7470 7574 2e73 6565 6b28 3029    output.seek(0)
-00004f50: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-00004f60: 726e 2061 6e73 7765 722c 2063 6f64 652c  rn answer, code,
-00004f70: 2072 6566 6c65 6374 696f 6e2c 2066 6c6f   reflection, flo
-00004f80: 772c 2074 6f74 616c 5f74 6f6b 656e 735f  w, total_tokens_
-00004f90: 7573 6564 5f73 756d 0d0a 2020 2020       used_sum..    
+000046f0: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+00004700: 6572 722e 666c 7573 6828 290d 0a0d 0a20  err.flush().... 
+00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004720: 2020 2023 2041 7474 656d 7074 2074 6f20     # Attempt to 
+00004730: 636f 7272 6563 7420 7468 6520 636f 6465  correct the code
+00004740: 2061 6e64 2068 616e 646c 6520 7261 7465   and handle rate
+00004750: 206c 696d 6974 2065 7272 6f72 730d 0a20   limit errors.. 
+00004760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004770: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00004780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004790: 206c 6c6d 5f72 6573 706f 6e73 652c 2074   llm_response, t
+000047a0: 6f6b 656e 735f 7573 6564 203d 2073 656c  okens_used = sel
+000047b0: 662e 6c6c 6d5f 6361 6c6c 286d 6573 7361  f.llm_call(messa
+000047c0: 6765 7329 0d0a 2020 2020 2020 2020 2020  ges)..          
+000047d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000047e0: 6465 2c72 6566 6c65 6374 696f 6e2c 666c  de,reflection,fl
+000047f0: 6f77 203d 2073 656c 662e 5f65 7874 7261  ow = self._extra
+00004800: 6374 5f63 6f64 6528 6c6c 6d5f 7265 7370  ct_code(llm_resp
+00004810: 6f6e 7365 290d 0a20 2020 2020 2020 2020  onse)..         
+00004820: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004830: 656c 662e 746f 7461 6c5f 746f 6b65 6e73  elf.total_tokens
+00004840: 5f75 7365 642e 6170 7065 6e64 2874 6f6b  _used.append(tok
+00004850: 656e 735f 7573 6564 290d 0a20 2020 2020  ens_used)..     
+00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004870: 2020 2074 6f74 616c 5f74 6f6b 656e 735f     total_tokens_
+00004880: 7573 6564 5f73 756d 203d 2073 756d 2873  used_sum = sum(s
+00004890: 656c 662e 746f 7461 6c5f 746f 6b65 6e73  elf.total_tokens
+000048a0: 5f75 7365 6429 0d0a 2020 2020 2020 2020  _used)..        
+000048b0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+000048c0: 7074 206f 7065 6e61 692e 6572 726f 722e  pt openai.error.
+000048d0: 5261 7465 4c69 6d69 7445 7272 6f72 3a0d  RateLimitError:.
+000048e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000048f0: 2020 2020 2020 2020 2070 7269 6e74 280d           print(.
+00004900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004910: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
+00004920: 6520 4f70 656e 4149 2041 5049 2072 6174  e OpenAI API rat
+00004930: 6520 6c69 6d69 7420 6861 7320 6265 656e  e limit has been
+00004940: 2065 7863 6565 6465 642e 2057 6169 7469   exceeded. Waiti
+00004950: 6e67 2031 3020 7365 636f 6e64 7320 616e  ng 10 seconds an
+00004960: 6420 7472 7969 6e67 2061 6761 696e 2e22  d trying again."
+00004970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004980: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00004990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049a0: 2020 2020 2074 696d 652e 736c 6565 7028       time.sleep(
+000049b0: 3130 290d 0a20 2020 2020 2020 2020 2020  10)..           
+000049c0: 2020 2020 2020 2020 2020 2020 206c 6c6d               llm
+000049d0: 5f72 6573 706f 6e73 652c 2074 6f6b 656e  _response, token
+000049e0: 735f 7573 6564 203d 2073 656c 662e 6c6c  s_used = self.ll
+000049f0: 6d5f 6361 6c6c 286d 6573 7361 6765 7329  m_call(messages)
+00004a00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004a10: 2020 2020 2020 2020 2020 636f 6465 2c72            code,r
+00004a20: 6566 6c65 6374 696f 6e2c 666c 6f77 203d  eflection,flow =
+00004a30: 2073 656c 662e 5f65 7874 7261 6374 5f63   self._extract_c
+00004a40: 6f64 6528 6c6c 6d5f 7265 7370 6f6e 7365  ode(llm_response
+00004a50: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00004a60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004a70: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00004a80: 642e 6170 7065 6e64 2874 6f6b 656e 735f  d.append(tokens_
+00004a90: 7573 6564 290d 0a20 2020 2020 2020 2020  used)..         
+00004aa0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00004ab0: 6f74 616c 5f74 6f6b 656e 735f 7573 6564  otal_tokens_used
+00004ac0: 5f73 756d 203d 2073 756d 2873 656c 662e  _sum = sum(self.
+00004ad0: 746f 7461 6c5f 746f 6b65 6e73 5f75 7365  total_tokens_use
+00004ae0: 6429 0d0a 0d0a 2020 2020 2020 2020 2020  d)....          
+00004af0: 2020 2320 5377 6974 6368 2062 6163 6b20    # Switch back 
+00004b00: 746f 2074 6865 206f 7269 6769 6e61 6c20  to the original 
+00004b10: 6c6c 6d20 6265 666f 7265 2074 6865 2066  llm before the f
+00004b20: 756e 6374 696f 6e20 6669 6e69 7368 6573  unction finishes
+00004b30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00004b40: 6c66 2e6c 6c6d 203d 206f 7269 6769 6e61  lf.llm = origina
+00004b50: 6c5f 6c6c 6d0d 0a0d 0a20 2020 2020 2020  l_llm....       
+00004b60: 2023 2047 6574 2074 6865 206f 7574 7075   # Get the outpu
+00004b70: 7420 6672 6f6d 2074 6865 2065 7865 6375  t from the execu
+00004b80: 7465 6420 636f 6465 0d0a 2020 2020 2020  ted code..      
+00004b90: 2020 616e 7377 6572 203d 206f 7574 7075    answer = outpu
+00004ba0: 742e 6765 7476 616c 7565 2829 0d0a 0d0a  t.getvalue()....
+00004bb0: 2020 2020 2020 2020 2320 5265 7365 7420          # Reset 
+00004bc0: 7468 6520 5374 7269 6e67 494f 2062 7566  the StringIO buf
+00004bd0: 6665 720d 0a20 2020 2020 2020 206f 7574  fer..        out
+00004be0: 7075 742e 7472 756e 6361 7465 2830 290d  put.truncate(0).
+00004bf0: 0a20 2020 2020 2020 206f 7574 7075 742e  .        output.
+00004c00: 7365 656b 2830 290d 0a0d 0a20 2020 2020  seek(0)....     
+00004c10: 2020 2072 6574 7572 6e20 616e 7377 6572     return answer
+00004c20: 2c20 636f 6465 2c20 7265 666c 6563 7469  , code, reflecti
+00004c30: 6f6e 2c20 666c 6f77 2c20 746f 7461 6c5f  on, flow, total_
+00004c40: 746f 6b65 6e73 5f75 7365 645f 7375 6d0d  tokens_used_sum.
+00004c50: 0a20 2020 20                             .
```

### Comparing `bambooai-0.2.6/bambooai.egg-info/PKG-INFO` & `bambooai-0.2.7/bambooai.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.2.6
+Version: 0.2.7
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.2.6/setup.py` & `bambooai-0.2.7/setup.py`

 * *Files 12% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 import os
 
 with open("README.md", "r") as fh:
     long_description = fh.read()
 
 setup(
     name='bambooai',
-    version='0.2.6',
+    version='0.2.7',
     description='A lightweight library for working with pandas dataframes using natural language queries',
     long_description=long_description,
     long_description_content_type="text/markdown",
     author='Palo Galko',
     packages=find_packages(),
     install_requires=[
         'openai',
```

