# Comparing `tmp/vitriolic-3.2.0-py3-none-any.whl.zip` & `tmp/vitriolic-3.2.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 2936368 bytes, number of entries: 970
+Zip file size: 2936463 bytes, number of entries: 970
 -rw-r--r--  2.0 unx      110 b- defN 19-Oct-31 21:17 tests/.coveragerc
 -rw-r--r--  2.0 unx       32 b- defN 19-Oct-31 21:17 tests/.gitignore
 -rw-r--r--  2.0 unx        0 b- defN 19-Oct-18 22:04 tests/__init__.py
 -rw-r--r--  2.0 unx       19 b- defN 22-Jun-12 11:19 tests/constraints-dj22.txt
 -rw-r--r--  2.0 unx       19 b- defN 22-Jun-12 11:19 tests/constraints-dj32.txt
 -rw-r--r--  2.0 unx       19 b- defN 22-Jun-12 11:19 tests/constraints-dj40.txt
 -rw-r--r--  2.0 unx      815 b- defN 19-Oct-18 22:04 tests/manage.py
@@ -686,32 +686,32 @@
 -rw-r--r--  2.0 unx     1864 b- defN 22-Jun-12 11:19 touchtechnology/news/templatetags/news.py
 -rw-r--r--  2.0 unx        0 b- defN 19-Oct-18 22:04 touchtechnology/news/tests/__init__.py
 -rw-r--r--  2.0 unx      982 b- defN 22-Jun-12 11:19 touchtechnology/news/tests/factories.py
 -rw-r--r--  2.0 unx     2557 b- defN 22-Jun-12 11:19 touchtechnology/news/tests/test_admin.py
 -rw-r--r--  2.0 unx     3442 b- defN 22-Jun-12 11:19 touchtechnology/news/tests/test_site.py
 -rw-r--r--  2.0 unx        0 b- defN 19-Oct-18 22:04 tournamentcontrol/__init__.py
 -rw-r--r--  2.0 unx      366 b- defN 19-Nov-19 06:59 tournamentcontrol/competition/__init__.py
--rw-r--r--  2.0 unx    81613 b- defN 23-May-22 07:39 tournamentcontrol/competition/admin.py
+-rw-r--r--  2.0 unx    82413 b- defN 23-May-28 02:11 tournamentcontrol/competition/admin.py
 -rw-r--r--  2.0 unx     2796 b- defN 23-Feb-16 20:24 tournamentcontrol/competition/apps.py
 -rw-r--r--  2.0 unx     4268 b- defN 19-Oct-18 22:04 tournamentcontrol/competition/calc.py
 -rw-r--r--  2.0 unx     1361 b- defN 23-May-21 21:21 tournamentcontrol/competition/constants.py
 -rw-r--r--  2.0 unx    10047 b- defN 22-Jun-12 22:50 tournamentcontrol/competition/dashboard.py
 -rw-r--r--  2.0 unx    12977 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/decorators.py
 -rw-r--r--  2.0 unx    18623 b- defN 23-Feb-16 20:24 tournamentcontrol/competition/draw.py
 -rw-r--r--  2.0 unx      269 b- defN 19-Oct-18 22:04 tournamentcontrol/competition/fields.py
 -rw-r--r--  2.0 unx    70373 b- defN 23-May-21 21:21 tournamentcontrol/competition/forms.py
 -rw-r--r--  2.0 unx      467 b- defN 19-Oct-18 22:04 tournamentcontrol/competition/managers.py
 -rw-r--r--  2.0 unx     4705 b- defN 19-Oct-18 22:04 tournamentcontrol/competition/merge.py
 -rw-r--r--  2.0 unx     1517 b- defN 19-Oct-31 21:17 tournamentcontrol/competition/mixins.py
--rw-r--r--  2.0 unx    70999 b- defN 23-May-21 21:21 tournamentcontrol/competition/models.py
+-rw-r--r--  2.0 unx    70999 b- defN 23-May-28 02:10 tournamentcontrol/competition/models.py
 -rw-r--r--  2.0 unx     5029 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/query.py
 -rw-r--r--  2.0 unx    12590 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/rank.py
 -rw-r--r--  2.0 unx    43575 b- defN 23-May-21 21:21 tournamentcontrol/competition/sites.py
--rw-r--r--  2.0 unx     1179 b- defN 23-May-22 07:39 tournamentcontrol/competition/tasks.py
--rw-r--r--  2.0 unx    17381 b- defN 23-May-21 21:21 tournamentcontrol/competition/utils.py
+-rw-r--r--  2.0 unx     1269 b- defN 23-May-28 02:11 tournamentcontrol/competition/tasks.py
+-rw-r--r--  2.0 unx    17461 b- defN 23-May-28 02:11 tournamentcontrol/competition/utils.py
 -rw-r--r--  2.0 unx      227 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/validators.py
 -rw-r--r--  2.0 unx     8084 b- defN 22-Jul-03 22:11 tournamentcontrol/competition/wizards.py
 -rw-r--r--  2.0 unx      421 b- defN 19-Nov-09 20:04 tournamentcontrol/competition/locale/de/LC_MESSAGES/django.mo
 -rw-r--r--  2.0 unx    63237 b- defN 19-Nov-09 20:04 tournamentcontrol/competition/locale/de/LC_MESSAGES/django.po
 -rw-r--r--  2.0 unx      429 b- defN 19-Nov-09 20:04 tournamentcontrol/competition/locale/en-AU/LC_MESSAGES/django.mo
 -rw-r--r--  2.0 unx    63245 b- defN 19-Nov-09 20:04 tournamentcontrol/competition/locale/en-AU/LC_MESSAGES/django.po
 -rw-r--r--  2.0 unx      420 b- defN 19-Nov-09 20:04 tournamentcontrol/competition/locale/fr/LC_MESSAGES/django.mo
@@ -960,13 +960,13 @@
 -rw-r--r--  2.0 unx     1837 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/tests/test_dashboard.py
 -rw-r--r--  2.0 unx     2299 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/tests/test_draw.py
 -rw-r--r--  2.0 unx     7104 b- defN 23-May-21 21:14 tournamentcontrol/competition/tests/test_formsets.py
 -rw-r--r--  2.0 unx     4308 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/tests/test_rank.py
 -rw-r--r--  2.0 unx     1925 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/tests/test_signals.py
 -rw-r--r--  2.0 unx     1240 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/tests/test_utils.py
 -rw-r--r--  2.0 unx      339 b- defN 22-Jun-12 11:19 tournamentcontrol/competition/tests/urls.py
--rw-r--r--  2.0 unx     1524 b- defN 23-May-22 07:44 vitriolic-3.2.0.dist-info/LICENSE
--rw-r--r--  2.0 unx     5079 b- defN 23-May-22 07:44 vitriolic-3.2.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-May-22 07:44 vitriolic-3.2.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       34 b- defN 23-May-22 07:44 vitriolic-3.2.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx   114624 b- defN 23-May-22 07:44 vitriolic-3.2.0.dist-info/RECORD
-970 files, 8458255 bytes uncompressed, 2743038 bytes compressed:  67.6%
+-rw-r--r--  2.0 unx     1524 b- defN 23-May-28 02:13 vitriolic-3.2.1.dist-info/LICENSE
+-rw-r--r--  2.0 unx     5079 b- defN 23-May-28 02:13 vitriolic-3.2.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-28 02:13 vitriolic-3.2.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx       34 b- defN 23-May-28 02:13 vitriolic-3.2.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx   114624 b- defN 23-May-28 02:13 vitriolic-3.2.1.dist-info/RECORD
+970 files, 8459225 bytes uncompressed, 2743133 bytes compressed:  67.6%
```

## zipnote {}

```diff
@@ -2889,23 +2889,23 @@
 
 Filename: tournamentcontrol/competition/tests/test_utils.py
 Comment: 
 
 Filename: tournamentcontrol/competition/tests/urls.py
 Comment: 
 
-Filename: vitriolic-3.2.0.dist-info/LICENSE
+Filename: vitriolic-3.2.1.dist-info/LICENSE
 Comment: 
 
-Filename: vitriolic-3.2.0.dist-info/METADATA
+Filename: vitriolic-3.2.1.dist-info/METADATA
 Comment: 
 
-Filename: vitriolic-3.2.0.dist-info/WHEEL
+Filename: vitriolic-3.2.1.dist-info/WHEEL
 Comment: 
 
-Filename: vitriolic-3.2.0.dist-info/top_level.txt
+Filename: vitriolic-3.2.1.dist-info/top_level.txt
 Comment: 
 
-Filename: vitriolic-3.2.0.dist-info/RECORD
+Filename: vitriolic-3.2.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## tournamentcontrol/competition/admin.py

```diff
@@ -421,14 +421,19 @@
                     "<int:season_id>/summary.html", self.season_summary, name="summary"
                 ),
                 path(
                     "<int:season_id>/matches/grid.<mode>",
                     self.season_grid,
                     name="match-grid",
                 ),
+                path(
+                    "<int:season_id>/matches/<result_id>.pdf",
+                    self.grid_async,
+                    name="grid-async",
+                ),
             ],
             self.app_name,
         )
 
         competition_urls = (
             [
                 path("", self.list_competitions, name="list"),  # KEEP
@@ -1677,15 +1682,15 @@
 
         if (
             getattr(settings, "TOURNAMENTCONTROL_ASYNC_PDF_GRID", False)
             and mode == "pdf"
         ):
             result = generate_pdf_grid.delay(season, extra_context)
             redirect_to = self.reverse(
-                "competition:season:scorecards-async",
+                "competition:season:grid-async",
                 kwargs={
                     "competition_id": season.competition_id,
                     "season_id": season.pk,
                     "result_id": result.id,
                 },
             )
             return self.redirect(redirect_to)
@@ -1696,17 +1701,19 @@
     @csrf_exempt_m
     @staff_login_required_m
     def day_grid(self, request, season, date, mode, extra_context, **kwargs):
         if (
             getattr(settings, "TOURNAMENTCONTROL_ASYNC_PDF_GRID", False)
             and mode == "pdf"
         ):
+            extra_context.pop("admin", None)
+            extra_context.pop("component", None)
             result = generate_pdf_grid.delay(season, extra_context, date)
             redirect_to = self.reverse(
-                "competition:season:scorecards-async",
+                "competition:season:grid-async",
                 kwargs={
                     "competition_id": season.competition_id,
                     "season_id": season.pk,
                     "result_id": result.id,
                 },
             )
             return self.redirect(redirect_to)
@@ -1716,14 +1723,28 @@
             format=mode,
             extra_context=extra_context,
             dates=[date],
         )
 
     @competition_by_pk_m
     @staff_login_required_m
+    def grid_async(self, request, result_id, extra_context, **kwargs):
+        result = generate_pdf_grid.AsyncResult(result_id)
+
+        if result.ready():
+            data = result.wait()
+            return HttpResponse(base64.b64decode(data), content_type="application/pdf")
+
+        templates = self.template_path("wait.html", "scorecards")
+        response = self.render(request, templates, extra_context)
+        response["Refresh"] = SCORECARD_PDF_WAIT
+        return response
+
+    @competition_by_pk_m
+    @staff_login_required_m
     def progress_teams(
         self, request, competition, season, division, stage, extra_context, **kwargs
     ):
         matches = stage.matches.filter(team_needs_progressing).exclude(
             legitimate_bye_match
         )
         teams = stage.undecided_teams.all()
```

## tournamentcontrol/competition/tasks.py

```diff
@@ -23,14 +23,18 @@
     # We can't JSON encode bytes, so we need to base64 encode the
     # PDF document before handing it back to the result backend.
     return base64.b64encode(data).decode("utf8")
 
 
 @shared_task
 def generate_pdf_grid(season, extra_context, date=None):
-    kwargs = {"format": "pdf", "extra_context": extra_context}
-    if date is not None:
-        kwargs["dates"] = [date]
-    data = generate_fixture_grid(season, **kwargs)
+    dates = [date] if date is not None else None
+    data: bytes = generate_fixture_grid(
+        season,
+        dates=dates,
+        format="pdf",
+        extra_context=extra_context,
+        http_response=False,  # Get bytes back, not a response object
+    )
     # We can't JSON encode bytes, so we need to base64 encode the
     # PDF document before handing it back to the result backend.
     return base64.b64encode(data).decode("utf8")
```

## tournamentcontrol/competition/utils.py

```diff
@@ -465,14 +465,16 @@
 
 def generate_fixture_grid(
     season,
     dates=None,
     templates=None,
     format="html",
     extra_context=None,
+    *,
+    http_response=True,
     **kwargs,
 ):
     logger.info(
         "season=%r dates=%r templates=%r format=%r extra_context=%r kwargs=%r",
         season,
         dates,
         templates,
@@ -530,19 +532,21 @@
     context.update(extra_context)
 
     template = select_template(templates)
     html = template.render(context)
 
     if format == "pdf":
         pdf = prince(html, **kwargs)
-        response = HttpResponse(pdf, content_type="application/pdf")
-    else:
-        response = HttpResponse(html)
-
-    return response
+        if http_response:
+            return HttpResponse(pdf, content_type="application/pdf")
+        return pdf
+
+    if http_response:
+        return HttpResponse(html)
+    return html
 
 
 #
 # Forfeit handling
 #
```

## Comparing `vitriolic-3.2.0.dist-info/LICENSE` & `vitriolic-3.2.1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `vitriolic-3.2.0.dist-info/METADATA` & `vitriolic-3.2.1.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: vitriolic
-Version: 3.2.0
+Version: 3.2.1
 Summary: A suite of packages for the Django framework to provide integrated Content Management and Sports Administration functionality for sporting associations.
 Author-email: Gary Reynolds <gary@touch.asn.au>
 License: BSD 3-Clause License
         
         Copyright (c) 2016, Touch Technology Pty Ltd
         All rights reserved.
```

## Comparing `vitriolic-3.2.0.dist-info/RECORD` & `vitriolic-3.2.1.dist-info/RECORD`

 * *Files 0% similar despite different names*

```diff
@@ -685,15 +685,15 @@
 touchtechnology/news/templatetags/news.py,sha256=vgyrw9VwbQ-LWNPUAbKLQhEMYj8Motxni9uhUW2lw5M,1864
 touchtechnology/news/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 touchtechnology/news/tests/factories.py,sha256=RbXKNlva7ainKuAg6Ioj9SYfZNKonHR_Qp-Fo0w-ij4,982
 touchtechnology/news/tests/test_admin.py,sha256=pfVQ29EcTdhgtsMpTw7h2TRnIMei-ucUiFrjsbLwXK4,2557
 touchtechnology/news/tests/test_site.py,sha256=hyNDZnqLOgm_MjD0Rj45TLmtmX5WzNCDuenKb2zx9Jw,3442
 tournamentcontrol/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 tournamentcontrol/competition/__init__.py,sha256=SScx6_SbKoERyLSjExClsmjSzEkS9rClPjVu8-dVwPE,366
-tournamentcontrol/competition/admin.py,sha256=dgV5LqUfnzNQdpmuGMDMvpkZFLnEJUIgoxRjuTSxAJQ,81613
+tournamentcontrol/competition/admin.py,sha256=EBqqmhlk0IlleznEXzP7PS09Wwv1D79kDCTthXSWOxw,82413
 tournamentcontrol/competition/apps.py,sha256=dGwA7hShn-F2G4IIz1Q1osKvpIj6WTBXh3E08Uv-6r8,2796
 tournamentcontrol/competition/calc.py,sha256=2VV4FlZ7afkHKArOJwibAAv8K62j1u49PGCnzydcIOM,4268
 tournamentcontrol/competition/constants.py,sha256=Z0qYTgO9-4hS_Hipglk05nDsQYh6Q5gC4Gx_Qjqf-Zs,1361
 tournamentcontrol/competition/dashboard.py,sha256=MonuXxpdJ8RnpMco7sCQEoLSpPMrXgFaASv4IwkzOjw,10047
 tournamentcontrol/competition/decorators.py,sha256=kjf6xJM0qmcM128JSzUjjkbRMPnV-C0y4LGXPhoYKFs,12977
 tournamentcontrol/competition/draw.py,sha256=SMeS_2mmMNZQ1m8SStzl7xmLcTYKm9sxM6ETA52eRdw,18623
 tournamentcontrol/competition/fields.py,sha256=jvxu2BBJT5qVHrhSbdmJmeYdQbPQ_LBFtoHjlC7fkU4,269
@@ -701,16 +701,16 @@
 tournamentcontrol/competition/managers.py,sha256=F8XO8Mk8hTI2nL-Sn5J6J0PSYQFxeOiuEZIyzG3L2Ok,467
 tournamentcontrol/competition/merge.py,sha256=WopN_fsAxsR6EFxF52rxP16BAFf-pNNjldOcbLOshOk,4705
 tournamentcontrol/competition/mixins.py,sha256=ktlQo57ijBOdfSHYKOiVErxLRfa1rywtp6LhM-7gyM8,1517
 tournamentcontrol/competition/models.py,sha256=67l6NFRQonya-UoKHFY-WnqCYXONXMTPbHS2AdT0ywA,70999
 tournamentcontrol/competition/query.py,sha256=qmwXGRd5wr9d8yfrPIqf1bGO8mxA8DyBIMh6agDJVvk,5029
 tournamentcontrol/competition/rank.py,sha256=PkdXw37-4dU0e9GVks2-eIvNAf0BKNCD9yzCg1hCl0I,12590
 tournamentcontrol/competition/sites.py,sha256=s0lqR3voEmno1VVTyo0-767fGFtlAEyu2jWee1sef68,43575
-tournamentcontrol/competition/tasks.py,sha256=MlvxmHdOGNWK6rN7SpVHzxFPVbfkGi0lIzilgtm4DxA,1179
-tournamentcontrol/competition/utils.py,sha256=hQFWdTxAV95z3fcZeJOl0IVQ8MpNIFCa1LIQMElUWp0,17381
+tournamentcontrol/competition/tasks.py,sha256=cpLpCuhIjHK1eDv9HKZiTu_Dca0P0aZx0M8RbTqcuzI,1269
+tournamentcontrol/competition/utils.py,sha256=bhHWli2RiCIDsQkGoa9BNw9NEJBF0BU6rfCLqOBL2Ao,17461
 tournamentcontrol/competition/validators.py,sha256=lS4Kyu2heNBcu3wyrBnrKG4RcI3nByeqW8FZdISWdCU,227
 tournamentcontrol/competition/wizards.py,sha256=1qH4lQ-M_Crh4E29Io-M5Tm53Kt8GSefyjL0DMu8pK8,8084
 tournamentcontrol/competition/locale/de/LC_MESSAGES/django.mo,sha256=SczEO1gvt51z2BvZd_Y5MtPc-yxAhl8L7NyO7TC6Fk8,421
 tournamentcontrol/competition/locale/de/LC_MESSAGES/django.po,sha256=RYU42Dc6LM1wGrWoTUPAFgnbARzvNGcCUKEKOO67TlE,63237
 tournamentcontrol/competition/locale/en-AU/LC_MESSAGES/django.mo,sha256=kPj05rISURKCsDY6tLqkT2vantNt6kcOHBqPxKmP2jg,429
 tournamentcontrol/competition/locale/en-AU/LC_MESSAGES/django.po,sha256=AnVoD_YBfn8fOg1qbHY_c5o01g20y37DWXgB8kcGWjo,63245
 tournamentcontrol/competition/locale/fr/LC_MESSAGES/django.mo,sha256=H_rgBuJg7aY_MC4YXMp4N3DX4fRPXW_Enx6LbR0iSAY,420
@@ -959,12 +959,12 @@
 tournamentcontrol/competition/tests/test_dashboard.py,sha256=SrkihAqiIsVGzqfhxwRUbDmjQ2Cp1aDIRJ9YNEop-gQ,1837
 tournamentcontrol/competition/tests/test_draw.py,sha256=c5V5Xg-9_hhxkhJMyeKbCKx4ej7r3SjHvUiSF4EYd40,2299
 tournamentcontrol/competition/tests/test_formsets.py,sha256=-Tuhf3rXQvjDgMhDjXiLdoJ27_slXLjywY15-uicKDY,7104
 tournamentcontrol/competition/tests/test_rank.py,sha256=F4sufcksF0tk8rhWK_cqaQa3Cz0JzFfFjjiMmBAYSrM,4308
 tournamentcontrol/competition/tests/test_signals.py,sha256=Q6FWckv9YJ2AuKnL6CXIjiK2O_xw2RFzLX733DbJ6jQ,1925
 tournamentcontrol/competition/tests/test_utils.py,sha256=zTTHcQsbYRRSYwL6OgejaPIi95s0NYj8o0wecg0RpaY,1240
 tournamentcontrol/competition/tests/urls.py,sha256=Yjvtda9XI_bsgMQkJMY9HjMWwLHt21Rg6TpMQytwW6M,339
-vitriolic-3.2.0.dist-info/LICENSE,sha256=Np-ji6hKE5J6mhfFdJ9Ql9O3LLx2jnyooJJfTUOV1Lw,1524
-vitriolic-3.2.0.dist-info/METADATA,sha256=5CGrHBx403RRzr2qoFMrds5yS7AoPVEE_d3IaXAeEyo,5079
-vitriolic-3.2.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-vitriolic-3.2.0.dist-info/top_level.txt,sha256=1JEz19hAABkOzzD1kHGP4Z4_w1E9UI0azSWwUsWE8ms,34
-vitriolic-3.2.0.dist-info/RECORD,,
+vitriolic-3.2.1.dist-info/LICENSE,sha256=Np-ji6hKE5J6mhfFdJ9Ql9O3LLx2jnyooJJfTUOV1Lw,1524
+vitriolic-3.2.1.dist-info/METADATA,sha256=rzEmAS8cQIz6Zm-a5t8stW4VYuUg3VJdBXsBdfqrPSo,5079
+vitriolic-3.2.1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+vitriolic-3.2.1.dist-info/top_level.txt,sha256=1JEz19hAABkOzzD1kHGP4Z4_w1E9UI0azSWwUsWE8ms,34
+vitriolic-3.2.1.dist-info/RECORD,,
```

